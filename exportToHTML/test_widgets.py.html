<html>
<head>
<title>test_widgets.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_widgets.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">functools</span>
<span class="s0">import </span><span class="s1">io</span>
<span class="s0">from </span><span class="s1">unittest </span><span class="s0">import </span><span class="s1">mock</span>

<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">backend_bases </span><span class="s0">import </span><span class="s1">MouseEvent</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">colors </span><span class="s0">as </span><span class="s1">mcolors</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">widgets </span><span class="s0">as </span><span class="s1">widgets</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">check_figures_equal</span><span class="s2">, </span><span class="s1">image_comparison</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">widgets </span><span class="s0">import </span><span class="s2">(</span><span class="s1">click_and_drag</span><span class="s2">, </span><span class="s1">do_event</span><span class="s2">, </span><span class="s1">get_ax</span><span class="s2">,</span>
                                        <span class="s1">mock_event</span><span class="s2">, </span><span class="s1">noop</span><span class="s2">)</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">assert_allclose</span>

<span class="s0">import </span><span class="s1">pytest</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
<span class="s0">def </span><span class="s1">ax</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s1">get_ax</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_save_blitted_widget_as_pdf</span><span class="s2">():</span>
    <span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">widgets </span><span class="s0">import </span><span class="s1">CheckButtons</span><span class="s2">, </span><span class="s1">RadioButtons</span>
    <span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">cbook </span><span class="s0">import </span><span class="s1">_get_running_interactive_framework</span>
    <span class="s0">if </span><span class="s1">_get_running_interactive_framework</span><span class="s2">() </span><span class="s0">not in </span><span class="s2">[</span><span class="s3">'headless'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">]:</span>
        <span class="s1">pytest</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s3">&quot;Callback exceptions are not raised otherwise.&quot;</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span>
        <span class="s1">nrows</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">ncols</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">width_ratios</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s1">default_rb </span><span class="s2">= </span><span class="s1">RadioButtons</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s3">'Apples'</span><span class="s2">, </span><span class="s3">'Oranges'</span><span class="s2">])</span>
    <span class="s1">styled_rb </span><span class="s2">= </span><span class="s1">RadioButtons</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s3">'Apples'</span><span class="s2">, </span><span class="s3">'Oranges'</span><span class="s2">],</span>
        <span class="s1">label_props</span><span class="s2">={</span><span class="s3">'color'</span><span class="s2">: [</span><span class="s3">'red'</span><span class="s2">, </span><span class="s3">'orange'</span><span class="s2">],</span>
                     <span class="s3">'fontsize'</span><span class="s2">: [</span><span class="s4">16</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]},</span>
        <span class="s1">radio_props</span><span class="s2">={</span><span class="s3">'edgecolor'</span><span class="s2">: [</span><span class="s3">'red'</span><span class="s2">, </span><span class="s3">'orange'</span><span class="s2">],</span>
                     <span class="s3">'facecolor'</span><span class="s2">: [</span><span class="s3">'mistyrose'</span><span class="s2">, </span><span class="s3">'peachpuff'</span><span class="s2">]}</span>
    <span class="s2">)</span>

    <span class="s1">default_cb </span><span class="s2">= </span><span class="s1">CheckButtons</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s3">'Apples'</span><span class="s2">, </span><span class="s3">'Oranges'</span><span class="s2">],</span>
                              <span class="s1">actives</span><span class="s2">=[</span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
    <span class="s1">styled_cb </span><span class="s2">= </span><span class="s1">CheckButtons</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s3">'Apples'</span><span class="s2">, </span><span class="s3">'Oranges'</span><span class="s2">],</span>
        <span class="s1">actives</span><span class="s2">=[</span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">],</span>
        <span class="s1">label_props</span><span class="s2">={</span><span class="s3">'color'</span><span class="s2">: [</span><span class="s3">'red'</span><span class="s2">, </span><span class="s3">'orange'</span><span class="s2">],</span>
                     <span class="s3">'fontsize'</span><span class="s2">: [</span><span class="s4">16</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]},</span>
        <span class="s1">frame_props</span><span class="s2">={</span><span class="s3">'edgecolor'</span><span class="s2">: [</span><span class="s3">'red'</span><span class="s2">, </span><span class="s3">'orange'</span><span class="s2">],</span>
                     <span class="s3">'facecolor'</span><span class="s2">: [</span><span class="s3">'mistyrose'</span><span class="s2">, </span><span class="s3">'peachpuff'</span><span class="s2">]},</span>
        <span class="s1">check_props</span><span class="s2">={</span><span class="s3">'color'</span><span class="s2">: [</span><span class="s3">'darkred'</span><span class="s2">, </span><span class="s3">'darkorange'</span><span class="s2">]}</span>
    <span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">].</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">'Default'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">].</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">'Stylized'</span><span class="s2">)</span>
    <span class="s5"># force an Agg render</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s5"># force a pdf save</span>
    <span class="s0">with </span><span class="s1">io</span><span class="s2">.</span><span class="s1">BytesIO</span><span class="s2">() </span><span class="s0">as </span><span class="s1">result_after</span><span class="s2">:</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">result_after</span><span class="s2">, </span><span class="s1">format</span><span class="s2">=</span><span class="s3">'pdf'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'kwargs'</span><span class="s2">, [</span>
    <span class="s1">dict</span><span class="s2">(),</span>
    <span class="s1">dict</span><span class="s2">(</span><span class="s1">useblit</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">),</span>
    <span class="s1">dict</span><span class="s2">(</span><span class="s1">minspanx</span><span class="s2">=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">minspany</span><span class="s2">=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">spancoords</span><span class="s2">=</span><span class="s3">'pixels'</span><span class="s2">),</span>
    <span class="s1">dict</span><span class="s2">(</span><span class="s1">props</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">fill</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)),</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_selector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s1">onselect </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">199</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">199</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>

    <span class="s5"># purposely drag outside of axis for release</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'release'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">250</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">250</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">kwargs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">'drawtype'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">) </span><span class="s0">not in </span><span class="s2">[</span><span class="s3">'line'</span><span class="s2">, </span><span class="s3">'none'</span><span class="s2">]:</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">geometry</span><span class="s2">,</span>
                        <span class="s2">[[</span><span class="s4">100.</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">199</span><span class="s2">, </span><span class="s4">199</span><span class="s2">, </span><span class="s4">100</span><span class="s2">],</span>
                         <span class="s2">[</span><span class="s4">100</span><span class="s2">, </span><span class="s4">199</span><span class="s2">, </span><span class="s4">199</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">]],</span>
                        <span class="s1">err_msg</span><span class="s2">=</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">geometry</span><span class="s2">)</span>

    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>
    <span class="s2">(</span><span class="s1">epress</span><span class="s2">, </span><span class="s1">erelease</span><span class="s2">), </span><span class="s1">kwargs </span><span class="s2">= </span><span class="s1">onselect</span><span class="s2">.</span><span class="s1">call_args</span>
    <span class="s0">assert </span><span class="s1">epress</span><span class="s2">.</span><span class="s1">xdata </span><span class="s2">== </span><span class="s4">100</span>
    <span class="s0">assert </span><span class="s1">epress</span><span class="s2">.</span><span class="s1">ydata </span><span class="s2">== </span><span class="s4">100</span>
    <span class="s0">assert </span><span class="s1">erelease</span><span class="s2">.</span><span class="s1">xdata </span><span class="s2">== </span><span class="s4">199</span>
    <span class="s0">assert </span><span class="s1">erelease</span><span class="s2">.</span><span class="s1">ydata </span><span class="s2">== </span><span class="s4">199</span>
    <span class="s0">assert </span><span class="s1">kwargs </span><span class="s2">== {}</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'spancoords'</span><span class="s2">, [</span><span class="s3">'data'</span><span class="s2">, </span><span class="s3">'pixels'</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'minspanx, x1'</span><span class="s2">, [[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10.5</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">11</span><span class="s2">]])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'minspany, y1'</span><span class="s2">, [[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10.5</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">11</span><span class="s2">]])</span>
<span class="s0">def </span><span class="s1">test_rectangle_minspan</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">spancoords</span><span class="s2">, </span><span class="s1">minspanx</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">, </span><span class="s1">minspany</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">):</span>

    <span class="s1">onselect </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">x0</span><span class="s2">, </span><span class="s1">y0 </span><span class="s2">= (</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">spancoords </span><span class="s2">== </span><span class="s3">'pixels'</span><span class="s2">:</span>
        <span class="s1">minspanx</span><span class="s2">, </span><span class="s1">minspany </span><span class="s2">= (</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">((</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">)) -</span>
                              <span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">((</span><span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">)))</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                     <span class="s1">spancoords</span><span class="s2">=</span><span class="s1">spancoords</span><span class="s2">,</span>
                                     <span class="s1">minspanx</span><span class="s2">=</span><span class="s1">minspanx</span><span class="s2">, </span><span class="s1">minspany</span><span class="s2">=</span><span class="s1">minspany</span><span class="s2">)</span>
    <span class="s5"># Too small to create a selector</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">x0</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">y0</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">))</span>
    <span class="s0">assert not </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_completed</span>
    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_not_called</span><span class="s2">()</span>

    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">20</span><span class="s2">, </span><span class="s4">20</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">30</span><span class="s2">, </span><span class="s4">30</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_completed</span>
    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>

    <span class="s5"># Too small to create a selector. Should clear existing selector, and</span>
    <span class="s5"># trigger onselect because there was a preexisting selector</span>
    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">reset_mock</span><span class="s2">()</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">))</span>
    <span class="s0">assert not </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_completed</span>
    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>
    <span class="s2">(</span><span class="s1">epress</span><span class="s2">, </span><span class="s1">erelease</span><span class="s2">), </span><span class="s1">kwargs </span><span class="s2">= </span><span class="s1">onselect</span><span class="s2">.</span><span class="s1">call_args</span>
    <span class="s0">assert </span><span class="s1">epress</span><span class="s2">.</span><span class="s1">xdata </span><span class="s2">== </span><span class="s1">x0</span>
    <span class="s0">assert </span><span class="s1">epress</span><span class="s2">.</span><span class="s1">ydata </span><span class="s2">== </span><span class="s1">y0</span>
    <span class="s0">assert </span><span class="s1">erelease</span><span class="s2">.</span><span class="s1">xdata </span><span class="s2">== </span><span class="s1">x1</span>
    <span class="s0">assert </span><span class="s1">erelease</span><span class="s2">.</span><span class="s1">ydata </span><span class="s2">== </span><span class="s1">y1</span>
    <span class="s0">assert </span><span class="s1">kwargs </span><span class="s2">== {}</span>


<span class="s0">def </span><span class="s1">test_deprecation_selector_visible_attribute</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s0">lambda </span><span class="s2">*</span><span class="s1">args</span><span class="s2">: </span><span class="s0">None</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">,</span>
                      <span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;was deprecated in Matplotlib 3.8&quot;</span><span class="s2">):</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">visible</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'drag_from_anywhere, new_center'</span><span class="s2">,</span>
                         <span class="s2">[[</span><span class="s0">True</span><span class="s2">, (</span><span class="s4">60</span><span class="s2">, </span><span class="s4">75</span><span class="s2">)],</span>
                          <span class="s2">[</span><span class="s0">False</span><span class="s2">, (</span><span class="s4">30</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)]])</span>
<span class="s0">def </span><span class="s1">test_rectangle_drag</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">drag_from_anywhere</span><span class="s2">, </span><span class="s1">new_center</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                     <span class="s1">drag_from_anywhere</span><span class="s2">=</span><span class="s1">drag_from_anywhere</span><span class="s2">)</span>
    <span class="s5"># Create rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">center </span><span class="s2">== (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">65</span><span class="s2">)</span>
    <span class="s5"># Drag inside rectangle, but away from centre handle</span>
    <span class="s5">#</span>
    <span class="s5"># If drag_from_anywhere == True, this will move the rectangle by (10, 10),</span>
    <span class="s5"># giving it a new center of (60, 75)</span>
    <span class="s5">#</span>
    <span class="s5"># If drag_from_anywhere == False, this will create a new rectangle with</span>
    <span class="s5"># center (30, 20)</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">25</span><span class="s2">, </span><span class="s4">15</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">35</span><span class="s2">, </span><span class="s4">25</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">center </span><span class="s2">== </span><span class="s1">new_center</span>
    <span class="s5"># Check that in both cases, dragging outside the rectangle draws a new</span>
    <span class="s5"># rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">175</span><span class="s2">, </span><span class="s4">185</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">185</span><span class="s2">, </span><span class="s4">195</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">center </span><span class="s2">== (</span><span class="s4">180</span><span class="s2">, </span><span class="s4">190</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_rectangle_selector_set_props_handle_props</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                     <span class="s1">props</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">facecolor</span><span class="s2">=</span><span class="s3">'b'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.2</span><span class="s2">),</span>
                                     <span class="s1">handle_props</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">))</span>
    <span class="s5"># Create rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>

    <span class="s1">artist </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_artist</span>
    <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">() == </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s3">'b'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.2</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">set_props</span><span class="s2">(</span><span class="s1">facecolor</span><span class="s2">=</span><span class="s3">'r'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">() == </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s3">'r'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_handles_artists</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_markeredgecolor</span><span class="s2">() == </span><span class="s3">'black'</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">0.5</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">set_handle_props</span><span class="s2">(</span><span class="s1">markeredgecolor</span><span class="s2">=</span><span class="s3">'r'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_handles_artists</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_markeredgecolor</span><span class="s2">() == </span><span class="s3">'r'</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">0.3</span>


<span class="s0">def </span><span class="s1">test_rectangle_resize</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s5"># Create rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">100.0</span><span class="s2">, </span><span class="s4">10.0</span><span class="s2">, </span><span class="s4">120.0</span><span class="s2">)</span>

    <span class="s5"># resize NE handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s4">10</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">+ </span><span class="s4">5</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">ydata_new</span><span class="s2">)</span>

    <span class="s5"># resize E handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s4">10</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">])</span>

    <span class="s5"># resize W handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s4">15</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">])</span>

    <span class="s5"># resize SW handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s4">20</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">+ </span><span class="s4">25</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">ydata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_rectangle_add_state</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s5"># Create rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">70</span><span class="s2">, </span><span class="s4">65</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">125</span><span class="s2">, </span><span class="s4">130</span><span class="s2">))</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'unsupported_state'</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'clear'</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'move'</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'square'</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'center'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'add_state'</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_resize_center</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">add_state</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s5"># Create rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">70</span><span class="s2">, </span><span class="s4">65</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">125</span><span class="s2">, </span><span class="s4">130</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">70.0</span><span class="s2">, </span><span class="s4">125.0</span><span class="s2">, </span><span class="s4">65.0</span><span class="s2">, </span><span class="s4">130.0</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">add_state</span><span class="s2">:</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'center'</span><span class="s2">)</span>
        <span class="s1">use_key </span><span class="s2">= </span><span class="s0">None</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">use_key </span><span class="s2">= </span><span class="s3">'control'</span>

    <span class="s5"># resize NE handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]</span>
    <span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydiff </span><span class="s2">= </span><span class="s4">10</span><span class="s2">, </span><span class="s4">5</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">+ </span><span class="s1">ydiff</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">),</span>
                   <span class="s1">key</span><span class="s2">=</span><span class="s1">use_key</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">xdata_new</span><span class="s2">,</span>
                            <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] - </span><span class="s1">ydiff</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">)</span>

    <span class="s5"># resize E handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdiff </span><span class="s2">= </span><span class="s4">10</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">),</span>
                   <span class="s1">key</span><span class="s2">=</span><span class="s1">use_key</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">xdata_new</span><span class="s2">,</span>
                            <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">])</span>

    <span class="s5"># resize E handle negative diff</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdiff </span><span class="s2">= -</span><span class="s4">20</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">),</span>
                   <span class="s1">key</span><span class="s2">=</span><span class="s1">use_key</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">xdata_new</span><span class="s2">,</span>
                            <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">])</span>

    <span class="s5"># resize W handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdiff </span><span class="s2">= </span><span class="s4">15</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">),</span>
                   <span class="s1">key</span><span class="s2">=</span><span class="s1">use_key</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">,</span>
                            <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">])</span>

    <span class="s5"># resize W handle negative diff</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdiff </span><span class="s2">= -</span><span class="s4">25</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">),</span>
                   <span class="s1">key</span><span class="s2">=</span><span class="s1">use_key</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">,</span>
                            <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">])</span>

    <span class="s5"># resize SW handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]</span>
    <span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydiff </span><span class="s2">= </span><span class="s4">20</span><span class="s2">, </span><span class="s4">25</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">+ </span><span class="s1">ydiff</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">),</span>
                   <span class="s1">key</span><span class="s2">=</span><span class="s1">use_key</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">,</span>
                            <span class="s1">ydata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">ydiff</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'add_state'</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_resize_square</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">add_state</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s5"># Create rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">70</span><span class="s2">, </span><span class="s4">65</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">120</span><span class="s2">, </span><span class="s4">115</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">70.0</span><span class="s2">, </span><span class="s4">120.0</span><span class="s2">, </span><span class="s4">65.0</span><span class="s2">, </span><span class="s4">115.0</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">add_state</span><span class="s2">:</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'square'</span><span class="s2">)</span>
        <span class="s1">use_key </span><span class="s2">= </span><span class="s0">None</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">use_key </span><span class="s2">= </span><span class="s3">'shift'</span>

    <span class="s5"># resize NE handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]</span>
    <span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydiff </span><span class="s2">= </span><span class="s4">10</span><span class="s2">, </span><span class="s4">5</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">+ </span><span class="s1">ydiff</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">),</span>
                   <span class="s1">key</span><span class="s2">=</span><span class="s1">use_key</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">xdata_new</span><span class="s2">,</span>
                            <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] + </span><span class="s1">xdiff</span><span class="s2">)</span>

    <span class="s5"># resize E handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdiff </span><span class="s2">= </span><span class="s4">10</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">),</span>
                   <span class="s1">key</span><span class="s2">=</span><span class="s1">use_key</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">xdata_new</span><span class="s2">,</span>
                            <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] + </span><span class="s1">xdiff</span><span class="s2">)</span>

    <span class="s5"># resize E handle negative diff</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdiff </span><span class="s2">= -</span><span class="s4">20</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">),</span>
                   <span class="s1">key</span><span class="s2">=</span><span class="s1">use_key</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">xdata_new</span><span class="s2">,</span>
                            <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] + </span><span class="s1">xdiff</span><span class="s2">)</span>

    <span class="s5"># resize W handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdiff </span><span class="s2">= </span><span class="s4">15</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">),</span>
                   <span class="s1">key</span><span class="s2">=</span><span class="s1">use_key</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">],</span>
                            <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">)</span>

    <span class="s5"># resize W handle negative diff</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdiff </span><span class="s2">= -</span><span class="s4">25</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">),</span>
                   <span class="s1">key</span><span class="s2">=</span><span class="s1">use_key</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">],</span>
                            <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">)</span>

    <span class="s5"># resize SW handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]</span>
    <span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydiff </span><span class="s2">= </span><span class="s4">20</span><span class="s2">, </span><span class="s4">25</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">+ </span><span class="s1">ydiff</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">),</span>
                   <span class="s1">key</span><span class="s2">=</span><span class="s1">use_key</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] + </span><span class="s1">ydiff</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">],</span>
                            <span class="s1">ydata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_rectangle_resize_square_center</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s5"># Create rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">70</span><span class="s2">, </span><span class="s4">65</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">120</span><span class="s2">, </span><span class="s4">115</span><span class="s2">))</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'square'</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'center'</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, (</span><span class="s4">70.0</span><span class="s2">, </span><span class="s4">120.0</span><span class="s2">, </span><span class="s4">65.0</span><span class="s2">, </span><span class="s4">115.0</span><span class="s2">))</span>

    <span class="s5"># resize NE handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]</span>
    <span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydiff </span><span class="s2">= </span><span class="s4">10</span><span class="s2">, </span><span class="s4">5</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">+ </span><span class="s1">ydiff</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">xdata_new</span><span class="s2">,</span>
                                   <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] + </span><span class="s1">xdiff</span><span class="s2">))</span>

    <span class="s5"># resize E handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdiff </span><span class="s2">= </span><span class="s4">10</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">xdata_new</span><span class="s2">,</span>
                                   <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] + </span><span class="s1">xdiff</span><span class="s2">))</span>

    <span class="s5"># resize E handle negative diff</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdiff </span><span class="s2">= -</span><span class="s4">20</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">xdata_new</span><span class="s2">,</span>
                                   <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] + </span><span class="s1">xdiff</span><span class="s2">))</span>

    <span class="s5"># resize W handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdiff </span><span class="s2">= </span><span class="s4">5</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, (</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">,</span>
                                   <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">))</span>

    <span class="s5"># resize W handle negative diff</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
    <span class="s1">xdiff </span><span class="s2">= -</span><span class="s4">25</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, (</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">,</span>
                                   <span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">))</span>

    <span class="s5"># resize SW handle</span>
    <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
    <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]</span>
    <span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydiff </span><span class="s2">= </span><span class="s4">20</span><span class="s2">, </span><span class="s4">25</span>
    <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">+ </span><span class="s1">ydiff</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] + </span><span class="s1">ydiff</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] - </span><span class="s1">ydiff</span><span class="s2">,</span>
                                   <span class="s1">ydata_new</span><span class="s2">, </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">ydiff</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'selector_class'</span><span class="s2">,</span>
                         <span class="s2">[</span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">, </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">EllipseSelector</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_rotate</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">selector_class</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">selector_class</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s5"># Draw rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">130</span><span class="s2">, </span><span class="s4">140</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">130</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">140</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">) == </span><span class="s4">0</span>

    <span class="s5"># Rotate anticlockwise using top-right corner</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'on_key_press'</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s3">'r'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_state </span><span class="s2">== {</span><span class="s3">'rotate'</span><span class="s2">}</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">) == </span><span class="s4">1</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">130</span><span class="s2">, </span><span class="s4">140</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">120</span><span class="s2">, </span><span class="s4">145</span><span class="s2">))</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'on_key_press'</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s3">'r'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">) == </span><span class="s4">0</span>
    <span class="s5"># Extents shouldn't change (as shape of rectangle hasn't changed)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">130</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">140</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">rotation</span><span class="s2">, </span><span class="s4">25.56</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">0.01</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">rotation </span><span class="s2">= </span><span class="s4">45</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">rotation </span><span class="s2">== </span><span class="s4">45</span>
    <span class="s5"># Corners should move</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">corners</span><span class="s2">,</span>
                    <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s4">118.53</span><span class="s2">, </span><span class="s4">139.75</span><span class="s2">, </span><span class="s4">111.46</span><span class="s2">, </span><span class="s4">90.25</span><span class="s2">],</span>
                              <span class="s2">[</span><span class="s4">95.25</span><span class="s2">, </span><span class="s4">116.46</span><span class="s2">, </span><span class="s4">144.75</span><span class="s2">, </span><span class="s4">123.54</span><span class="s2">]]), </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">0.01</span><span class="s2">)</span>

    <span class="s5"># Scale using top-right corner</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">110</span><span class="s2">, </span><span class="s4">145</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">110</span><span class="s2">, </span><span class="s4">160</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">139.75</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">151.82</span><span class="s2">), </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">0.01</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">selector_class </span><span class="s2">== </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">:</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
            <span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_artist</span><span class="s2">.</span><span class="s1">rotation_point </span><span class="s2">= </span><span class="s3">'unvalid_value'</span>


<span class="s0">def </span><span class="s1">test_rectangle_add_remove_set</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s5"># Draw rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">130</span><span class="s2">, </span><span class="s4">140</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">130</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">140</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">) == </span><span class="s4">0</span>
    <span class="s0">for </span><span class="s1">state </span><span class="s0">in </span><span class="s2">[</span><span class="s3">'rotate'</span><span class="s2">, </span><span class="s3">'square'</span><span class="s2">, </span><span class="s3">'center'</span><span class="s2">]:</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s1">state</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">) == </span><span class="s4">1</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">remove_state</span><span class="s2">(</span><span class="s1">state</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">) == </span><span class="s4">0</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'use_data_coordinates'</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_resize_square_center_aspect</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">use_data_coordinates</span><span class="s2">):</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s4">0.8</span><span class="s2">)</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                     <span class="s1">use_data_coordinates</span><span class="s2">=</span><span class="s1">use_data_coordinates</span><span class="s2">)</span>
    <span class="s5"># Create rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">70</span><span class="s2">, </span><span class="s4">65</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">120</span><span class="s2">, </span><span class="s4">115</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">70.0</span><span class="s2">, </span><span class="s4">120.0</span><span class="s2">, </span><span class="s4">65.0</span><span class="s2">, </span><span class="s4">115.0</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'square'</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'center'</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">use_data_coordinates</span><span class="s2">:</span>
        <span class="s5"># resize E handle</span>
        <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
        <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">, </span><span class="s1">width </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ycenter </span><span class="s2">= </span><span class="s4">10</span><span class="s2">,  </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] + (</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] - </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) / </span><span class="s4">2</span>
        <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
        <span class="s1">ychange </span><span class="s2">= </span><span class="s1">width </span><span class="s2">/ </span><span class="s4">2 </span><span class="s2">+ </span><span class="s1">xdiff</span>
        <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, [</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">xdata_new</span><span class="s2">,</span>
                                       <span class="s1">ycenter </span><span class="s2">- </span><span class="s1">ychange</span><span class="s2">, </span><span class="s1">ycenter </span><span class="s2">+ </span><span class="s1">ychange</span><span class="s2">])</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s5"># resize E handle</span>
        <span class="s1">extents </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span>
        <span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata </span><span class="s2">= </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">extents</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]</span>
        <span class="s1">xdiff </span><span class="s2">= </span><span class="s4">10</span>
        <span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new </span><span class="s2">= </span><span class="s1">xdata </span><span class="s2">+ </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">ydata</span>
        <span class="s1">ychange </span><span class="s2">= </span><span class="s1">xdiff </span><span class="s2">* </span><span class="s4">1 </span><span class="s2">/ </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_aspect_ratio_correction</span>
        <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s1">xdata_new</span><span class="s2">, </span><span class="s1">ydata_new</span><span class="s2">))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, [</span><span class="s1">extents</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] - </span><span class="s1">xdiff</span><span class="s2">, </span><span class="s1">xdata_new</span><span class="s2">,</span>
                                       <span class="s4">46.25</span><span class="s2">, </span><span class="s4">133.75</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_ellipse</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;For ellipse, test out the key modifiers&quot;&quot;&quot;</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">EllipseSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">,</span>
                                   <span class="s1">grab_range</span><span class="s2">=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">= (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">150</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)</span>

    <span class="s5"># drag the rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">125</span><span class="s2">, </span><span class="s4">125</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">145</span><span class="s2">, </span><span class="s4">145</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">120</span><span class="s2">, </span><span class="s4">170</span><span class="s2">, </span><span class="s4">120</span><span class="s2">, </span><span class="s4">170</span><span class="s2">)</span>

    <span class="s5"># create from center</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">125</span><span class="s2">, </span><span class="s4">125</span><span class="s2">), </span><span class="s1">key</span><span class="s2">=</span><span class="s3">'control'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">75</span><span class="s2">, </span><span class="s4">125</span><span class="s2">, </span><span class="s4">75</span><span class="s2">, </span><span class="s4">125</span><span class="s2">)</span>

    <span class="s5"># create a square</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">35</span><span class="s2">, </span><span class="s4">30</span><span class="s2">), </span><span class="s1">key</span><span class="s2">=</span><span class="s3">'shift'</span><span class="s2">)</span>
    <span class="s1">extents </span><span class="s2">= [</span><span class="s1">int</span><span class="s2">(</span><span class="s1">e</span><span class="s2">) </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">extents </span><span class="s2">== [</span><span class="s4">10</span><span class="s2">, </span><span class="s4">35</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">35</span><span class="s2">]</span>

    <span class="s5"># create a square from center</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">125</span><span class="s2">, </span><span class="s4">130</span><span class="s2">), </span><span class="s1">key</span><span class="s2">=</span><span class="s3">'ctrl+shift'</span><span class="s2">)</span>
    <span class="s1">extents </span><span class="s2">= [</span><span class="s1">int</span><span class="s2">(</span><span class="s1">e</span><span class="s2">) </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">extents </span><span class="s2">== [</span><span class="s4">70</span><span class="s2">, </span><span class="s4">130</span><span class="s2">, </span><span class="s4">70</span><span class="s2">, </span><span class="s4">130</span><span class="s2">]</span>

    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">geometry</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">73</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">geometry</span><span class="s2">[:, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">70.</span><span class="s2">, </span><span class="s4">100</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_rectangle_handles</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">,</span>
                                     <span class="s1">grab_range</span><span class="s2">=</span><span class="s4">10</span><span class="s2">,</span>
                                     <span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                     <span class="s1">handle_props</span><span class="s2">={</span><span class="s3">'markerfacecolor'</span><span class="s2">: </span><span class="s3">'r'</span><span class="s2">,</span>
                                                   <span class="s3">'markeredgecolor'</span><span class="s2">: </span><span class="s3">'b'</span><span class="s2">})</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">= (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">150</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)</span>

    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">corners</span><span class="s2">, ((</span><span class="s4">100</span><span class="s2">, </span><span class="s4">150</span><span class="s2">, </span><span class="s4">150</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">150</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">150</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">.</span><span class="s1">edge_centers</span><span class="s2">,</span>
                    <span class="s2">((</span><span class="s4">100</span><span class="s2">, </span><span class="s4">125.0</span><span class="s2">, </span><span class="s4">150</span><span class="s2">, </span><span class="s4">125.0</span><span class="s2">), (</span><span class="s4">125.0</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">125.0</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">150</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)</span>

    <span class="s5"># grab a corner and move it</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">120</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">120</span><span class="s2">, </span><span class="s4">150</span><span class="s2">, </span><span class="s4">120</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)</span>

    <span class="s5"># grab the center and move it</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">132</span><span class="s2">, </span><span class="s4">132</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">120</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">108</span><span class="s2">, </span><span class="s4">138</span><span class="s2">, </span><span class="s4">108</span><span class="s2">, </span><span class="s4">138</span><span class="s2">)</span>

    <span class="s5"># create a new rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">10</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">100</span><span class="s2">)</span>

    <span class="s5"># Check that marker_props worked.</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">_corner_handles</span><span class="s2">.</span><span class="s1">artists</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">get_markerfacecolor</span><span class="s2">(), </span><span class="s3">'r'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">_corner_handles</span><span class="s2">.</span><span class="s1">artists</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">get_markeredgecolor</span><span class="s2">(), </span><span class="s3">'b'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'interactive'</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_selector_onselect</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">):</span>
    <span class="s5"># check when press and release events take place at the same position</span>
    <span class="s1">onselect </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s1">interactive</span><span class="s2">)</span>
    <span class="s5"># move outside of axis</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">110</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>

    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">100.0</span><span class="s2">, </span><span class="s4">150.0</span><span class="s2">, </span><span class="s4">110.0</span><span class="s2">, </span><span class="s4">120.0</span><span class="s2">)</span>

    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">reset_mock</span><span class="s2">()</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">100</span><span class="s2">))</span>
    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'ignore_event_outside'</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_selector_ignore_outside</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">ignore_event_outside</span><span class="s2">):</span>
    <span class="s1">onselect </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">,</span>
                                     <span class="s1">ignore_event_outside</span><span class="s2">=</span><span class="s1">ignore_event_outside</span><span class="s2">)</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">110</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>
    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">100.0</span><span class="s2">, </span><span class="s4">150.0</span><span class="s2">, </span><span class="s4">110.0</span><span class="s2">, </span><span class="s4">120.0</span><span class="s2">)</span>

    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">reset_mock</span><span class="s2">()</span>
    <span class="s5"># Trigger event outside of span</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">150</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">160</span><span class="s2">, </span><span class="s4">160</span><span class="s2">))</span>
    <span class="s0">if </span><span class="s1">ignore_event_outside</span><span class="s2">:</span>
        <span class="s5"># event have been ignored and span haven't changed.</span>
        <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_not_called</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">100.0</span><span class="s2">, </span><span class="s4">150.0</span><span class="s2">, </span><span class="s4">110.0</span><span class="s2">, </span><span class="s4">120.0</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s5"># A new shape is created</span>
        <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">150.0</span><span class="s2">, </span><span class="s4">160.0</span><span class="s2">, </span><span class="s4">150.0</span><span class="s2">, </span><span class="s4">160.0</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'orientation, onmove_callback, kwargs'</span><span class="s2">, [</span>
    <span class="s2">(</span><span class="s3">'horizontal'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">minspan</span><span class="s2">=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">useblit</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)),</span>
    <span class="s2">(</span><span class="s3">'vertical'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)),</span>
    <span class="s2">(</span><span class="s3">'horizontal'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">props</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">fill</span><span class="s2">=</span><span class="s0">True</span><span class="s2">))),</span>
    <span class="s2">(</span><span class="s3">'horizontal'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)),</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_span_selector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">, </span><span class="s1">onmove_callback</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s1">onselect </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">onmove </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">onmove_callback</span><span class="s2">:</span>
        <span class="s1">kwargs</span><span class="s2">[</span><span class="s3">'onmove_callback'</span><span class="s2">] = </span><span class="s1">onmove</span>

    <span class="s5"># While at it, also test that span selectors work in the presence of twin axes on</span>
    <span class="s5"># top of the axes that contain the selector.  Note that we need to unforce the axes</span>
    <span class="s5"># aspect here, otherwise the twin axes forces the original axes' limits (to respect</span>
    <span class="s5"># aspect=1) which makes some of the values below go out of bounds.</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s3">&quot;auto&quot;</span><span class="s2">)</span>
    <span class="s1">tax </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s5"># move outside of axis</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">199</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">199</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'release'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">250</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">250</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>

    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once_with</span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">199</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">onmove_callback</span><span class="s2">:</span>
        <span class="s1">onmove</span><span class="s2">.</span><span class="s1">assert_called_once_with</span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">199</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'interactive'</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_span_selector_onselect</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">):</span>
    <span class="s1">onselect </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">, </span><span class="s3">'horizontal'</span><span class="s2">,</span>
                                <span class="s1">interactive</span><span class="s2">=</span><span class="s1">interactive</span><span class="s2">)</span>
    <span class="s5"># move outside of axis</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">100</span><span class="s2">))</span>
    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)</span>

    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">reset_mock</span><span class="s2">()</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">100</span><span class="s2">))</span>
    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'ignore_event_outside'</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_span_selector_ignore_outside</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">ignore_event_outside</span><span class="s2">):</span>
    <span class="s1">onselect </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">onmove </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">, </span><span class="s3">'horizontal'</span><span class="s2">,</span>
                                <span class="s1">onmove_callback</span><span class="s2">=</span><span class="s1">onmove</span><span class="s2">,</span>
                                <span class="s1">ignore_event_outside</span><span class="s2">=</span><span class="s1">ignore_event_outside</span><span class="s2">)</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">125</span><span class="s2">, </span><span class="s4">125</span><span class="s2">))</span>
    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>
    <span class="s1">onmove</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">125</span><span class="s2">)</span>

    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">reset_mock</span><span class="s2">()</span>
    <span class="s1">onmove</span><span class="s2">.</span><span class="s1">reset_mock</span><span class="s2">()</span>
    <span class="s5"># Trigger event outside of span</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">150</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">160</span><span class="s2">, </span><span class="s4">160</span><span class="s2">))</span>
    <span class="s0">if </span><span class="s1">ignore_event_outside</span><span class="s2">:</span>
        <span class="s5"># event have been ignored and span haven't changed.</span>
        <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_not_called</span><span class="s2">()</span>
        <span class="s1">onmove</span><span class="s2">.</span><span class="s1">assert_not_called</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">125</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s5"># A new shape is created</span>
        <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>
        <span class="s1">onmove</span><span class="s2">.</span><span class="s1">assert_called_once</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">150</span><span class="s2">, </span><span class="s4">160</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'drag_from_anywhere'</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_span_selector_drag</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">drag_from_anywhere</span><span class="s2">):</span>
    <span class="s5"># Create span</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">=</span><span class="s3">'horizontal'</span><span class="s2">,</span>
                                <span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                <span class="s1">drag_from_anywhere</span><span class="s2">=</span><span class="s1">drag_from_anywhere</span><span class="s2">)</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">10</span><span class="s2">, </span><span class="s4">100</span><span class="s2">)</span>
    <span class="s5"># Drag inside span</span>
    <span class="s5">#</span>
    <span class="s5"># If drag_from_anywhere == True, this will move the span by 10,</span>
    <span class="s5"># giving new value extents = 20, 110</span>
    <span class="s5">#</span>
    <span class="s5"># If drag_from_anywhere == False, this will create a new span with</span>
    <span class="s5"># value extents = 25, 35</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">25</span><span class="s2">, </span><span class="s4">15</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">35</span><span class="s2">, </span><span class="s4">25</span><span class="s2">))</span>
    <span class="s0">if </span><span class="s1">drag_from_anywhere</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">20</span><span class="s2">, </span><span class="s4">110</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">25</span><span class="s2">, </span><span class="s4">35</span><span class="s2">)</span>

    <span class="s5"># Check that in both cases, dragging outside the span draws a new span</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">175</span><span class="s2">, </span><span class="s4">185</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">185</span><span class="s2">, </span><span class="s4">195</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">175</span><span class="s2">, </span><span class="s4">185</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_span_selector_direction</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">=</span><span class="s3">'horizontal'</span><span class="s2">,</span>
                                <span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'horizontal'</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_edge_handles</span><span class="s2">.</span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'horizontal'</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">,</span>
                                    <span class="s1">direction</span><span class="s2">=</span><span class="s3">'invalid_direction'</span><span class="s2">)</span>

    <span class="s1">tool</span><span class="s2">.</span><span class="s1">direction </span><span class="s2">= </span><span class="s3">'vertical'</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'vertical'</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_edge_handles</span><span class="s2">.</span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'vertical'</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">direction </span><span class="s2">= </span><span class="s3">'invalid_string'</span>


<span class="s0">def </span><span class="s1">test_span_selector_set_props_handle_props</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">=</span><span class="s3">'horizontal'</span><span class="s2">,</span>
                                <span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                <span class="s1">props</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">facecolor</span><span class="s2">=</span><span class="s3">'b'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.2</span><span class="s2">),</span>
                                <span class="s1">handle_props</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">))</span>
    <span class="s5"># Create rectangle</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>

    <span class="s1">artist </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_artist</span>
    <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">() == </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s3">'b'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.2</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">set_props</span><span class="s2">(</span><span class="s1">facecolor</span><span class="s2">=</span><span class="s3">'r'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">() == </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s3">'r'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_handles_artists</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s3">'b'</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">0.5</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">set_handle_props</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">'r'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_handles_artists</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s3">'r'</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">0.3</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'selector'</span><span class="s2">, [</span><span class="s3">'span'</span><span class="s2">, </span><span class="s3">'rectangle'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_selector_clear</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">selector</span><span class="s2">):</span>
    <span class="s1">kwargs </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">selector </span><span class="s2">== </span><span class="s3">'span'</span><span class="s2">:</span>
        <span class="s1">Selector </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span>
        <span class="s1">kwargs</span><span class="s2">[</span><span class="s3">'direction'</span><span class="s2">] = </span><span class="s3">'horizontal'</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">Selector </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">Selector</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>

    <span class="s5"># press-release event outside the selector to clear the selector</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">130</span><span class="s2">, </span><span class="s4">130</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">130</span><span class="s2">, </span><span class="s4">130</span><span class="s2">))</span>
    <span class="s0">assert not </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_completed</span>

    <span class="s1">kwargs</span><span class="s2">[</span><span class="s3">'ignore_event_outside'</span><span class="s2">] = </span><span class="s0">True</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">Selector</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">ignore_event_outside</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>

    <span class="s5"># press-release event outside the selector ignored</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">130</span><span class="s2">, </span><span class="s4">130</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">130</span><span class="s2">, </span><span class="s4">130</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_completed</span>

    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'on_key_press'</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s3">'escape'</span><span class="s2">)</span>
    <span class="s0">assert not </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_completed</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'selector'</span><span class="s2">, [</span><span class="s3">'span'</span><span class="s2">, </span><span class="s3">'rectangle'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_selector_clear_method</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">selector</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">selector </span><span class="s2">== </span><span class="s3">'span'</span><span class="s2">:</span>
        <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">=</span><span class="s3">'horizontal'</span><span class="s2">,</span>
                                    <span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                    <span class="s1">ignore_event_outside</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_completed</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s0">if </span><span class="s1">selector </span><span class="s2">== </span><span class="s3">'span'</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">10</span><span class="s2">, </span><span class="s4">100</span><span class="s2">)</span>

    <span class="s1">tool</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_completed</span>
    <span class="s0">assert not </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>

    <span class="s5"># Do another cycle of events to make sure we can</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">end</span><span class="s2">=(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">120</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_completed</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s0">if </span><span class="s1">selector </span><span class="s2">== </span><span class="s3">'span'</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">10</span><span class="s2">, </span><span class="s4">50</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_span_selector_add_state</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">noop</span><span class="s2">, </span><span class="s3">'horizontal'</span><span class="s2">,</span>
                                <span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'unsupported_state'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'center'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'square'</span><span class="s2">)</span>

    <span class="s1">tool</span><span class="s2">.</span><span class="s1">add_state</span><span class="s2">(</span><span class="s3">'move'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_tool_line_handle</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">positions </span><span class="s2">= [</span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">50</span><span class="s2">]</span>
    <span class="s1">tool_line_handle </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">ToolLineHandles</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">, </span><span class="s3">'horizontal'</span><span class="s2">,</span>
                                               <span class="s1">useblit</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool_line_handle</span><span class="s2">.</span><span class="s1">artists</span><span class="s2">:</span>
        <span class="s0">assert not </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_animated</span><span class="s2">()</span>
        <span class="s0">assert not </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>

    <span class="s1">tool_line_handle</span><span class="s2">.</span><span class="s1">set_visible</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">tool_line_handle</span><span class="s2">.</span><span class="s1">set_animated</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool_line_handle</span><span class="s2">.</span><span class="s1">artists</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_animated</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">tool_line_handle</span><span class="s2">.</span><span class="s1">positions </span><span class="s2">== </span><span class="s1">positions</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'direction'</span><span class="s2">, (</span><span class="s3">&quot;horizontal&quot;</span><span class="s2">, </span><span class="s3">&quot;vertical&quot;</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_span_selector_bound</span><span class="s2">(</span><span class="s1">direction</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">], [</span><span class="s4">10</span><span class="s2">, </span><span class="s4">30</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">x_bound </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xbound</span><span class="s2">()</span>
    <span class="s1">y_bound </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ybound</span><span class="s2">()</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">print</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">, </span><span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xbound</span><span class="s2">() == </span><span class="s1">x_bound</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ybound</span><span class="s2">() == </span><span class="s1">y_bound</span>

    <span class="s1">bound </span><span class="s2">= </span><span class="s1">x_bound </span><span class="s0">if </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'horizontal' </span><span class="s0">else </span><span class="s1">y_bound</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_edge_handles</span><span class="s2">.</span><span class="s1">positions </span><span class="s2">== </span><span class="s1">list</span><span class="s2">(</span><span class="s1">bound</span><span class="s2">)</span>

    <span class="s1">press_data </span><span class="s2">= (</span><span class="s4">10.5</span><span class="s2">, </span><span class="s4">11.5</span><span class="s2">)</span>
    <span class="s1">move_data </span><span class="s2">= (</span><span class="s4">11</span><span class="s2">, </span><span class="s4">13</span><span class="s2">)  </span><span class="s5"># Updating selector is done in onmove</span>
    <span class="s1">release_data </span><span class="s2">= </span><span class="s1">move_data</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s1">press_data</span><span class="s2">, </span><span class="s1">end</span><span class="s2">=</span><span class="s1">move_data</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xbound</span><span class="s2">() == </span><span class="s1">x_bound</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ybound</span><span class="s2">() == </span><span class="s1">y_bound</span>

    <span class="s1">index </span><span class="s2">= </span><span class="s4">0 </span><span class="s0">if </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'horizontal' </span><span class="s0">else </span><span class="s4">1</span>
    <span class="s1">handle_positions </span><span class="s2">= [</span><span class="s1">press_data</span><span class="s2">[</span><span class="s1">index</span><span class="s2">], </span><span class="s1">release_data</span><span class="s2">[</span><span class="s1">index</span><span class="s2">]]</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_edge_handles</span><span class="s2">.</span><span class="s1">positions </span><span class="s2">== </span><span class="s1">handle_positions</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">backend</span><span class="s2">(</span><span class="s3">'QtAgg'</span><span class="s2">, </span><span class="s1">skip_on_importerror</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_span_selector_animated_artists_callback</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Check that the animated artists changed in callbacks are updated.&quot;&quot;&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s4">100</span><span class="s2">)</span>
    <span class="s1">values </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ln</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">values</span><span class="s2">, </span><span class="s1">animated</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ln2</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([], </span><span class="s1">animated</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s5"># spin the event loop to let the backend process any pending operations</span>
    <span class="s5"># before drawing artists</span>
    <span class="s5"># See blitting tutorial</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pause</span><span class="s2">(</span><span class="s4">0.1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">draw_artist</span><span class="s2">(</span><span class="s1">ln</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">blit</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">bbox</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">mean</span><span class="s2">(</span><span class="s1">vmin</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">):</span>
        <span class="s5"># Return mean of values in x between *vmin* and *vmax*</span>
        <span class="s1">indmin</span><span class="s2">, </span><span class="s1">indmax </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">searchsorted</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, (</span><span class="s1">vmin</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">))</span>
        <span class="s1">v </span><span class="s2">= </span><span class="s1">values</span><span class="s2">[</span><span class="s1">indmin</span><span class="s2">:</span><span class="s1">indmax</span><span class="s2">].</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">ln2</span><span class="s2">.</span><span class="s1">set_data</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full_like</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">v</span><span class="s2">))</span>

    <span class="s1">span </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">mean</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">=</span><span class="s3">'horizontal'</span><span class="s2">,</span>
                                <span class="s1">onmove_callback</span><span class="s2">=</span><span class="s1">mean</span><span class="s2">,</span>
                                <span class="s1">interactive</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                <span class="s1">drag_from_anywhere</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                <span class="s1">useblit</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s5"># Add span selector and check that the line is draw after it was updated</span>
    <span class="s5"># by the callback</span>
    <span class="s1">press_data </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]</span>
    <span class="s1">move_data </span><span class="s2">= [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">span</span><span class="s2">, </span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s1">press_data</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">ydata</span><span class="s2">=</span><span class="s1">press_data</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">span</span><span class="s2">, </span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s1">move_data</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">ydata</span><span class="s2">=</span><span class="s1">move_data</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">span</span><span class="s2">.</span><span class="s1">_get_animated_artists</span><span class="s2">() == (</span><span class="s1">ln</span><span class="s2">, </span><span class="s1">ln2</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ln</span><span class="s2">.</span><span class="s1">stale </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">ln2</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ln2</span><span class="s2">.</span><span class="s1">get_ydata</span><span class="s2">(), </span><span class="s4">0.9547335049088455</span><span class="s2">)</span>
    <span class="s1">span</span><span class="s2">.</span><span class="s1">update</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ln2</span><span class="s2">.</span><span class="s1">stale </span><span class="s0">is False</span>

    <span class="s5"># Change span selector and check that the line is drawn/updated after its</span>
    <span class="s5"># value was updated by the callback</span>
    <span class="s1">press_data </span><span class="s2">= [</span><span class="s4">4</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
    <span class="s1">move_data </span><span class="s2">= [</span><span class="s4">5</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]</span>
    <span class="s1">release_data </span><span class="s2">= [</span><span class="s4">5</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">span</span><span class="s2">, </span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s1">press_data</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">ydata</span><span class="s2">=</span><span class="s1">press_data</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">span</span><span class="s2">, </span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s1">move_data</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">ydata</span><span class="s2">=</span><span class="s1">move_data</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ln</span><span class="s2">.</span><span class="s1">stale </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">ln2</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ln2</span><span class="s2">.</span><span class="s1">get_ydata</span><span class="s2">(), -</span><span class="s4">0.9424150707548072</span><span class="s2">)</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">span</span><span class="s2">, </span><span class="s3">'release'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s1">release_data</span><span class="s2">[</span><span class="s4">0</span><span class="s2">],</span>
             <span class="s1">ydata</span><span class="s2">=</span><span class="s1">release_data</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ln2</span><span class="s2">.</span><span class="s1">stale </span><span class="s0">is False</span>


<span class="s0">def </span><span class="s1">test_snapping_values_span_selector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">onselect</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s0">pass</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">=</span><span class="s3">'horizontal'</span><span class="s2">,)</span>
    <span class="s1">snap_function </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_snap</span>

    <span class="s1">snap_values </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">11</span><span class="s2">)</span>
    <span class="s1">values </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">0.7</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">4.76</span><span class="s2">, </span><span class="s4">5.0</span><span class="s2">, </span><span class="s4">5.5</span><span class="s2">])</span>
    <span class="s1">expect </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">00.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">5.00</span><span class="s2">, </span><span class="s4">5.0</span><span class="s2">, </span><span class="s4">5.0</span><span class="s2">])</span>
    <span class="s1">values </span><span class="s2">= </span><span class="s1">snap_function</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s1">snap_values</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s1">expect</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_span_selector_snap</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">onselect</span><span class="s2">(</span><span class="s1">vmin</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">_got_onselect </span><span class="s2">= </span><span class="s0">True</span>

    <span class="s1">snap_values </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">50</span><span class="s2">) * </span><span class="s4">4</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">=</span><span class="s3">'horizontal'</span><span class="s2">,</span>
                                <span class="s1">snap_values</span><span class="s2">=</span><span class="s1">snap_values</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">= (</span><span class="s4">17</span><span class="s2">, </span><span class="s4">35</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">16</span><span class="s2">, </span><span class="s4">36</span><span class="s2">)</span>

    <span class="s1">tool</span><span class="s2">.</span><span class="s1">snap_values </span><span class="s2">= </span><span class="s0">None</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">snap_values </span><span class="s0">is None</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">= (</span><span class="s4">17</span><span class="s2">, </span><span class="s4">35</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">17</span><span class="s2">, </span><span class="s4">35</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_span_selector_extents</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">SpanSelector</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">: </span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;horizontal&quot;</span><span class="s2">, </span><span class="s1">ignore_event_outside</span><span class="s2">=</span><span class="s0">True</span>
        <span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">= (</span><span class="s4">5</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">5</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_completed</span>

    <span class="s5"># Since `ignore_event_outside=True`, this event should be ignored</span>
    <span class="s1">press_data </span><span class="s2">= (</span><span class="s4">12</span><span class="s2">, </span><span class="s4">14</span><span class="s2">)</span>
    <span class="s1">release_data </span><span class="s2">= (</span><span class="s4">20</span><span class="s2">, </span><span class="s4">14</span><span class="s2">)</span>
    <span class="s1">click_and_drag</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s1">press_data</span><span class="s2">, </span><span class="s1">end</span><span class="s2">=</span><span class="s1">release_data</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">== (</span><span class="s4">5</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'kwargs'</span><span class="s2">, [</span>
    <span class="s1">dict</span><span class="s2">(),</span>
    <span class="s1">dict</span><span class="s2">(</span><span class="s1">useblit</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">props</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">'red'</span><span class="s2">)),</span>
    <span class="s1">dict</span><span class="s2">(</span><span class="s1">useblit</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">),</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_lasso_selector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s1">onselect </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">LassoSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'release'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">150</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">150</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>

    <span class="s1">onselect</span><span class="s2">.</span><span class="s1">assert_called_once_with</span><span class="s2">([(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), (</span><span class="s4">125</span><span class="s2">, </span><span class="s4">125</span><span class="s2">), (</span><span class="s4">150</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)])</span>


<span class="s0">def </span><span class="s1">test_lasso_selector_set_props</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">onselect </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">LassoSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">, </span><span class="s1">props</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">'b'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.2</span><span class="s2">))</span>

    <span class="s1">artist </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_artist</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s3">'b'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">0.2</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">set_props</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">'r'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s3">'r'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">0.3</span>


<span class="s0">def </span><span class="s1">test_lasso_set_props</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">onselect </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">Lasso</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), </span><span class="s1">onselect</span><span class="s2">)</span>
    <span class="s1">line </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">line</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s3">'black'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_linestyle</span><span class="s2">() == </span><span class="s3">'-'</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_lw</span><span class="s2">() == </span><span class="s4">2</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">Lasso</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">), </span><span class="s1">onselect</span><span class="s2">, </span><span class="s1">props</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span>
        <span class="s1">linestyle</span><span class="s2">=</span><span class="s3">'-'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s3">'darkblue'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.2</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s4">1</span><span class="s2">))</span>

    <span class="s1">line </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">line</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s3">'darkblue'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">0.2</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_lw</span><span class="s2">() == </span><span class="s4">1</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_linestyle</span><span class="s2">() == </span><span class="s3">'-'</span>
    <span class="s1">line</span><span class="s2">.</span><span class="s1">set_color</span><span class="s2">(</span><span class="s3">'r'</span><span class="s2">)</span>
    <span class="s1">line</span><span class="s2">.</span><span class="s1">set_alpha</span><span class="s2">(</span><span class="s4">0.3</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s3">'r'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">0.3</span>


<span class="s0">def </span><span class="s1">test_CheckButtons</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">labels </span><span class="s2">= (</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s3">'c'</span><span class="s2">)</span>
    <span class="s1">check </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">CheckButtons</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">, (</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">check</span><span class="s2">.</span><span class="s1">get_status</span><span class="s2">() == [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">]</span>
    <span class="s1">check</span><span class="s2">.</span><span class="s1">set_active</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">check</span><span class="s2">.</span><span class="s1">get_status</span><span class="s2">() == [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">check</span><span class="s2">.</span><span class="s1">get_checked_labels</span><span class="s2">() == [</span><span class="s3">'c'</span><span class="s2">]</span>
    <span class="s1">check</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">check</span><span class="s2">.</span><span class="s1">get_status</span><span class="s2">() == [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">check</span><span class="s2">.</span><span class="s1">get_checked_labels</span><span class="s2">() == []</span>

    <span class="s0">for </span><span class="s1">invalid_index </span><span class="s0">in </span><span class="s2">[-</span><span class="s4">1</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">labels</span><span class="s2">), </span><span class="s1">len</span><span class="s2">(</span><span class="s1">labels</span><span class="s2">)+</span><span class="s4">5</span><span class="s2">]:</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
            <span class="s1">check</span><span class="s2">.</span><span class="s1">set_active</span><span class="s2">(</span><span class="s1">index</span><span class="s2">=</span><span class="s1">invalid_index</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">invalid_value </span><span class="s0">in </span><span class="s2">[</span><span class="s3">'invalid'</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">]:</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
            <span class="s1">check</span><span class="s2">.</span><span class="s1">set_active</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">state</span><span class="s2">=</span><span class="s1">invalid_value</span><span class="s2">)</span>

    <span class="s1">cid </span><span class="s2">= </span><span class="s1">check</span><span class="s2">.</span><span class="s1">on_clicked</span><span class="s2">(</span><span class="s0">lambda</span><span class="s2">: </span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">check</span><span class="s2">.</span><span class="s1">disconnect</span><span class="s2">(</span><span class="s1">cid</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;toolbar&quot;</span><span class="s2">, [</span><span class="s3">&quot;none&quot;</span><span class="s2">, </span><span class="s3">&quot;toolbar2&quot;</span><span class="s2">, </span><span class="s3">&quot;toolmanager&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_TextBox</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">toolbar</span><span class="s2">):</span>
    <span class="s5"># Avoid &quot;toolmanager is provisional&quot; warning.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">.</span><span class="s1">_set</span><span class="s2">(</span><span class="s3">&quot;toolbar&quot;</span><span class="s2">, </span><span class="s1">toolbar</span><span class="s2">)</span>

    <span class="s1">submit_event </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">text_change_event </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">TextBox</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s3">''</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">on_submit</span><span class="s2">(</span><span class="s1">submit_event</span><span class="s2">)</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">on_text_change</span><span class="s2">(</span><span class="s1">text_change_event</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">text </span><span class="s2">== </span><span class="s3">''</span>

    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'_click'</span><span class="s2">)</span>

    <span class="s1">tool</span><span class="s2">.</span><span class="s1">set_val</span><span class="s2">(</span><span class="s3">'x**2'</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">text </span><span class="s2">== </span><span class="s3">'x**2'</span>
    <span class="s0">assert </span><span class="s1">text_change_event</span><span class="s2">.</span><span class="s1">call_count </span><span class="s2">== </span><span class="s4">1</span>

    <span class="s1">tool</span><span class="s2">.</span><span class="s1">begin_typing</span><span class="s2">()</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">stop_typing</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">submit_event</span><span class="s2">.</span><span class="s1">call_count </span><span class="s2">== </span><span class="s4">2</span>

    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'_click'</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">.5</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">.5</span><span class="s2">)  </span><span class="s5"># Ensure the click is in the axes.</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'_keypress'</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s3">'+'</span><span class="s2">)</span>
    <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s3">'_keypress'</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s3">'5'</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">text_change_event</span><span class="s2">.</span><span class="s1">call_count </span><span class="s2">== </span><span class="s4">3</span>


<span class="s0">def </span><span class="s1">test_RadioButtons</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">radio </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RadioButtons</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, (</span><span class="s3">'Radio 1'</span><span class="s2">, </span><span class="s3">'Radio 2'</span><span class="s2">, </span><span class="s3">'Radio 3'</span><span class="s2">))</span>
    <span class="s1">radio</span><span class="s2">.</span><span class="s1">set_active</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">radio</span><span class="s2">.</span><span class="s1">value_selected </span><span class="s2">== </span><span class="s3">'Radio 2'</span>
    <span class="s0">assert </span><span class="s1">radio</span><span class="s2">.</span><span class="s1">index_selected </span><span class="s2">== </span><span class="s4">1</span>
    <span class="s1">radio</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">radio</span><span class="s2">.</span><span class="s1">value_selected </span><span class="s2">== </span><span class="s3">'Radio 1'</span>
    <span class="s0">assert </span><span class="s1">radio</span><span class="s2">.</span><span class="s1">index_selected </span><span class="s2">== </span><span class="s4">0</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'check_radio_buttons.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s3">'mpl20'</span><span class="s2">, </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_check_radio_buttons_image</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">get_ax</span><span class="s2">()</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">figure</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">left</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>

    <span class="s1">rax1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">((</span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.7</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.15</span><span class="s2">))</span>
    <span class="s1">rb1 </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RadioButtons</span><span class="s2">(</span><span class="s1">rax1</span><span class="s2">, (</span><span class="s3">'Radio 1'</span><span class="s2">, </span><span class="s3">'Radio 2'</span><span class="s2">, </span><span class="s3">'Radio 3'</span><span class="s2">))</span>

    <span class="s1">rax2 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">((</span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.15</span><span class="s2">))</span>
    <span class="s1">cb1 </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">CheckButtons</span><span class="s2">(</span><span class="s1">rax2</span><span class="s2">, (</span><span class="s3">'Check 1'</span><span class="s2">, </span><span class="s3">'Check 2'</span><span class="s2">, </span><span class="s3">'Check 3'</span><span class="s2">),</span>
                               <span class="s2">(</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">))</span>

    <span class="s1">rax3 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">((</span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.15</span><span class="s2">))</span>
    <span class="s1">rb3 </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RadioButtons</span><span class="s2">(</span>
        <span class="s1">rax3</span><span class="s2">, (</span><span class="s3">'Radio 1'</span><span class="s2">, </span><span class="s3">'Radio 2'</span><span class="s2">, </span><span class="s3">'Radio 3'</span><span class="s2">),</span>
        <span class="s1">label_props</span><span class="s2">={</span><span class="s3">'fontsize'</span><span class="s2">: [</span><span class="s4">8</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">16</span><span class="s2">],</span>
                     <span class="s3">'color'</span><span class="s2">: [</span><span class="s3">'red'</span><span class="s2">, </span><span class="s3">'green'</span><span class="s2">, </span><span class="s3">'blue'</span><span class="s2">]},</span>
        <span class="s1">radio_props</span><span class="s2">={</span><span class="s3">'edgecolor'</span><span class="s2">: [</span><span class="s3">'red'</span><span class="s2">, </span><span class="s3">'green'</span><span class="s2">, </span><span class="s3">'blue'</span><span class="s2">],</span>
                     <span class="s3">'facecolor'</span><span class="s2">: [</span><span class="s3">'mistyrose'</span><span class="s2">, </span><span class="s3">'palegreen'</span><span class="s2">, </span><span class="s3">'lightblue'</span><span class="s2">]})</span>

    <span class="s1">rax4 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">((</span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.15</span><span class="s2">))</span>
    <span class="s1">cb4 </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">CheckButtons</span><span class="s2">(</span>
        <span class="s1">rax4</span><span class="s2">, (</span><span class="s3">'Check 1'</span><span class="s2">, </span><span class="s3">'Check 2'</span><span class="s2">, </span><span class="s3">'Check 3'</span><span class="s2">), (</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">),</span>
        <span class="s1">label_props</span><span class="s2">={</span><span class="s3">'fontsize'</span><span class="s2">: [</span><span class="s4">8</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">16</span><span class="s2">],</span>
                     <span class="s3">'color'</span><span class="s2">: [</span><span class="s3">'red'</span><span class="s2">, </span><span class="s3">'green'</span><span class="s2">, </span><span class="s3">'blue'</span><span class="s2">]},</span>
        <span class="s1">frame_props</span><span class="s2">={</span><span class="s3">'edgecolor'</span><span class="s2">: [</span><span class="s3">'red'</span><span class="s2">, </span><span class="s3">'green'</span><span class="s2">, </span><span class="s3">'blue'</span><span class="s2">],</span>
                     <span class="s3">'facecolor'</span><span class="s2">: [</span><span class="s3">'mistyrose'</span><span class="s2">, </span><span class="s3">'palegreen'</span><span class="s2">, </span><span class="s3">'lightblue'</span><span class="s2">]},</span>
        <span class="s1">check_props</span><span class="s2">={</span><span class="s3">'color'</span><span class="s2">: [</span><span class="s3">'red'</span><span class="s2">, </span><span class="s3">'green'</span><span class="s2">, </span><span class="s3">'blue'</span><span class="s2">]})</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s3">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_radio_buttons</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">widgets</span><span class="s2">.</span><span class="s1">RadioButtons</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(), [</span><span class="s3">&quot;tea&quot;</span><span class="s2">, </span><span class="s3">&quot;coffee&quot;</span><span class="s2">])</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">xticks</span><span class="s2">=[], </span><span class="s1">yticks</span><span class="s2">=[])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s4">.15</span><span class="s2">, </span><span class="s4">.15</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">/</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">/</span><span class="s4">3</span><span class="s2">], </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">,</span>
               <span class="s1">s</span><span class="s2">=(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;font.size&quot;</span><span class="s2">] / </span><span class="s4">2</span><span class="s2">) ** </span><span class="s4">2</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=[</span><span class="s3">&quot;C0&quot;</span><span class="s2">, </span><span class="s3">&quot;none&quot;</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.25</span><span class="s2">, </span><span class="s4">2</span><span class="s2">/</span><span class="s4">3</span><span class="s2">, </span><span class="s3">&quot;tea&quot;</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s3">&quot;center&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.25</span><span class="s2">, </span><span class="s4">1</span><span class="s2">/</span><span class="s4">3</span><span class="s2">, </span><span class="s3">&quot;coffee&quot;</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s3">&quot;center&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s3">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_radio_buttons_props</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">label_props </span><span class="s2">= {</span><span class="s3">'color'</span><span class="s2">: [</span><span class="s3">'red'</span><span class="s2">], </span><span class="s3">'fontsize'</span><span class="s2">: [</span><span class="s4">24</span><span class="s2">]}</span>
    <span class="s1">radio_props </span><span class="s2">= {</span><span class="s3">'facecolor'</span><span class="s2">: </span><span class="s3">'green'</span><span class="s2">, </span><span class="s3">'edgecolor'</span><span class="s2">: </span><span class="s3">'blue'</span><span class="s2">, </span><span class="s3">'linewidth'</span><span class="s2">: </span><span class="s4">2</span><span class="s2">}</span>

    <span class="s1">widgets</span><span class="s2">.</span><span class="s1">RadioButtons</span><span class="s2">(</span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(), [</span><span class="s3">'tea'</span><span class="s2">, </span><span class="s3">'coffee'</span><span class="s2">],</span>
                         <span class="s1">label_props</span><span class="s2">=</span><span class="s1">label_props</span><span class="s2">, </span><span class="s1">radio_props</span><span class="s2">=</span><span class="s1">radio_props</span><span class="s2">)</span>

    <span class="s1">cb </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RadioButtons</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(), [</span><span class="s3">'tea'</span><span class="s2">, </span><span class="s3">'coffee'</span><span class="s2">])</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">set_label_props</span><span class="s2">(</span><span class="s1">label_props</span><span class="s2">)</span>
    <span class="s5"># Setting the label size automatically increases default marker size, so we</span>
    <span class="s5"># need to do that here as well.</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">set_radio_props</span><span class="s2">({**</span><span class="s1">radio_props</span><span class="s2">, </span><span class="s3">'s'</span><span class="s2">: (</span><span class="s4">24 </span><span class="s2">/ </span><span class="s4">2</span><span class="s2">)**</span><span class="s4">2</span><span class="s2">})</span>


<span class="s0">def </span><span class="s1">test_radio_button_active_conflict</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">,</span>
                      <span class="s1">match</span><span class="s2">=</span><span class="s3">r'Both the \*activecolor\* parameter'</span><span class="s2">):</span>
        <span class="s1">rb </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RadioButtons</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, [</span><span class="s3">'tea'</span><span class="s2">, </span><span class="s3">'coffee'</span><span class="s2">], </span><span class="s1">activecolor</span><span class="s2">=</span><span class="s3">'red'</span><span class="s2">,</span>
                                  <span class="s1">radio_props</span><span class="s2">={</span><span class="s3">'facecolor'</span><span class="s2">: </span><span class="s3">'green'</span><span class="s2">})</span>
    <span class="s5"># *radio_props*' facecolor wins over *activecolor*</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">rb</span><span class="s2">.</span><span class="s1">_buttons</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">(), [</span><span class="s3">'green'</span><span class="s2">, </span><span class="s3">'none'</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s3">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_radio_buttons_activecolor_change</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">widgets</span><span class="s2">.</span><span class="s1">RadioButtons</span><span class="s2">(</span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(), [</span><span class="s3">'tea'</span><span class="s2">, </span><span class="s3">'coffee'</span><span class="s2">],</span>
                         <span class="s1">activecolor</span><span class="s2">=</span><span class="s3">'green'</span><span class="s2">)</span>

    <span class="s5"># Test property setter.</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RadioButtons</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(), [</span><span class="s3">'tea'</span><span class="s2">, </span><span class="s3">'coffee'</span><span class="s2">],</span>
                              <span class="s1">activecolor</span><span class="s2">=</span><span class="s3">'red'</span><span class="s2">)</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">activecolor </span><span class="s2">= </span><span class="s3">'green'</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s3">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_check_buttons</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">widgets</span><span class="s2">.</span><span class="s1">CheckButtons</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(), [</span><span class="s3">&quot;tea&quot;</span><span class="s2">, </span><span class="s3">&quot;coffee&quot;</span><span class="s2">], [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">xticks</span><span class="s2">=[], </span><span class="s1">yticks</span><span class="s2">=[])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s4">.15</span><span class="s2">, </span><span class="s4">.15</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">/</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">/</span><span class="s4">3</span><span class="s2">], </span><span class="s1">marker</span><span class="s2">=</span><span class="s3">'s'</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">,</span>
               <span class="s1">s</span><span class="s2">=(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;font.size&quot;</span><span class="s2">] / </span><span class="s4">2</span><span class="s2">) ** </span><span class="s4">2</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=[</span><span class="s3">&quot;none&quot;</span><span class="s2">, </span><span class="s3">&quot;none&quot;</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s4">.15</span><span class="s2">, </span><span class="s4">.15</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">/</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">/</span><span class="s4">3</span><span class="s2">], </span><span class="s1">marker</span><span class="s2">=</span><span class="s3">'x'</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">,</span>
               <span class="s1">s</span><span class="s2">=(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;font.size&quot;</span><span class="s2">] / </span><span class="s4">2</span><span class="s2">) ** </span><span class="s4">2</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=[</span><span class="s3">&quot;k&quot;</span><span class="s2">, </span><span class="s3">&quot;k&quot;</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.25</span><span class="s2">, </span><span class="s4">2</span><span class="s2">/</span><span class="s4">3</span><span class="s2">, </span><span class="s3">&quot;tea&quot;</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s3">&quot;center&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.25</span><span class="s2">, </span><span class="s4">1</span><span class="s2">/</span><span class="s4">3</span><span class="s2">, </span><span class="s3">&quot;coffee&quot;</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s3">&quot;center&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s3">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_check_button_props</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">label_props </span><span class="s2">= {</span><span class="s3">'color'</span><span class="s2">: [</span><span class="s3">'red'</span><span class="s2">], </span><span class="s3">'fontsize'</span><span class="s2">: [</span><span class="s4">24</span><span class="s2">]}</span>
    <span class="s1">frame_props </span><span class="s2">= {</span><span class="s3">'facecolor'</span><span class="s2">: </span><span class="s3">'green'</span><span class="s2">, </span><span class="s3">'edgecolor'</span><span class="s2">: </span><span class="s3">'blue'</span><span class="s2">, </span><span class="s3">'linewidth'</span><span class="s2">: </span><span class="s4">2</span><span class="s2">}</span>
    <span class="s1">check_props </span><span class="s2">= {</span><span class="s3">'facecolor'</span><span class="s2">: </span><span class="s3">'red'</span><span class="s2">, </span><span class="s3">'linewidth'</span><span class="s2">: </span><span class="s4">2</span><span class="s2">}</span>

    <span class="s1">widgets</span><span class="s2">.</span><span class="s1">CheckButtons</span><span class="s2">(</span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(), [</span><span class="s3">'tea'</span><span class="s2">, </span><span class="s3">'coffee'</span><span class="s2">], [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">],</span>
                         <span class="s1">label_props</span><span class="s2">=</span><span class="s1">label_props</span><span class="s2">, </span><span class="s1">frame_props</span><span class="s2">=</span><span class="s1">frame_props</span><span class="s2">,</span>
                         <span class="s1">check_props</span><span class="s2">=</span><span class="s1">check_props</span><span class="s2">)</span>

    <span class="s1">cb </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">CheckButtons</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(), [</span><span class="s3">'tea'</span><span class="s2">, </span><span class="s3">'coffee'</span><span class="s2">],</span>
                              <span class="s2">[</span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">set_label_props</span><span class="s2">(</span><span class="s1">label_props</span><span class="s2">)</span>
    <span class="s5"># Setting the label size automatically increases default marker size, so we</span>
    <span class="s5"># need to do that here as well.</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">set_frame_props</span><span class="s2">({**</span><span class="s1">frame_props</span><span class="s2">, </span><span class="s3">'s'</span><span class="s2">: (</span><span class="s4">24 </span><span class="s2">/ </span><span class="s4">2</span><span class="s2">)**</span><span class="s4">2</span><span class="s2">})</span>
    <span class="s5"># FIXME: Axes.scatter promotes facecolor to edgecolor on unfilled markers,</span>
    <span class="s5"># but Collection.update doesn't do that (it forgot the marker already).</span>
    <span class="s5"># This means we cannot pass facecolor to both setters directly.</span>
    <span class="s1">check_props</span><span class="s2">[</span><span class="s3">'edgecolor'</span><span class="s2">] = </span><span class="s1">check_props</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s3">'facecolor'</span><span class="s2">)</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">set_check_props</span><span class="s2">({**</span><span class="s1">check_props</span><span class="s2">, </span><span class="s3">'s'</span><span class="s2">: (</span><span class="s4">24 </span><span class="s2">/ </span><span class="s4">2</span><span class="s2">)**</span><span class="s4">2</span><span class="s2">})</span>


<span class="s0">def </span><span class="s1">test_slider_slidermin_slidermax_invalid</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s5"># test min/max with floats</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">widgets</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">''</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">24.0</span><span class="s2">,</span>
                       <span class="s1">slidermin</span><span class="s2">=</span><span class="s4">10.0</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">widgets</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">''</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">24.0</span><span class="s2">,</span>
                       <span class="s1">slidermax</span><span class="s2">=</span><span class="s4">10.0</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_slider_slidermin_slidermax</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">slider_ </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">''</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">24.0</span><span class="s2">,</span>
                             <span class="s1">valinit</span><span class="s2">=</span><span class="s4">5.0</span><span class="s2">)</span>

    <span class="s1">slider </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">''</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">24.0</span><span class="s2">,</span>
                            <span class="s1">valinit</span><span class="s2">=</span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">slidermin</span><span class="s2">=</span><span class="s1">slider_</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val </span><span class="s2">== </span><span class="s1">slider_</span><span class="s2">.</span><span class="s1">val</span>

    <span class="s1">slider </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">''</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">24.0</span><span class="s2">,</span>
                            <span class="s1">valinit</span><span class="s2">=</span><span class="s4">10.0</span><span class="s2">, </span><span class="s1">slidermax</span><span class="s2">=</span><span class="s1">slider_</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val </span><span class="s2">== </span><span class="s1">slider_</span><span class="s2">.</span><span class="s1">val</span>


<span class="s0">def </span><span class="s1">test_slider_valmin_valmax</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">slider </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">''</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">24.0</span><span class="s2">,</span>
                            <span class="s1">valinit</span><span class="s2">=-</span><span class="s4">10.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val </span><span class="s2">== </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">valmin</span>

    <span class="s1">slider </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">''</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">24.0</span><span class="s2">,</span>
                            <span class="s1">valinit</span><span class="s2">=</span><span class="s4">25.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val </span><span class="s2">== </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">valmax</span>


<span class="s0">def </span><span class="s1">test_slider_valstep_snapping</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">slider </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">''</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">24.0</span><span class="s2">,</span>
                            <span class="s1">valinit</span><span class="s2">=</span><span class="s4">11.4</span><span class="s2">, </span><span class="s1">valstep</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val </span><span class="s2">== </span><span class="s4">11</span>

    <span class="s1">slider </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">''</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">24.0</span><span class="s2">,</span>
                            <span class="s1">valinit</span><span class="s2">=</span><span class="s4">11.4</span><span class="s2">, </span><span class="s1">valstep</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5.5</span><span class="s2">, </span><span class="s4">19.7</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val </span><span class="s2">== </span><span class="s4">5.5</span>


<span class="s0">def </span><span class="s1">test_slider_horizontal_vertical</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">slider </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">''</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">24</span><span class="s2">,</span>
                            <span class="s1">valinit</span><span class="s2">=</span><span class="s4">12</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s3">'horizontal'</span><span class="s2">)</span>
    <span class="s1">slider</span><span class="s2">.</span><span class="s1">set_val</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val </span><span class="s2">== </span><span class="s4">10</span>
    <span class="s5"># check the dimension of the slider patch in axes units</span>
    <span class="s1">box </span><span class="s2">= </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">poly</span><span class="s2">.</span><span class="s1">get_extents</span><span class="s2">().</span><span class="s1">transformed</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">.</span><span class="s1">inverted</span><span class="s2">())</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">box</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">.25</span><span class="s2">, </span><span class="s4">10</span><span class="s2">/</span><span class="s4">24</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">])</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">slider </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">''</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">24</span><span class="s2">,</span>
                            <span class="s1">valinit</span><span class="s2">=</span><span class="s4">12</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s3">'vertical'</span><span class="s2">)</span>
    <span class="s1">slider</span><span class="s2">.</span><span class="s1">set_val</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val </span><span class="s2">== </span><span class="s4">10</span>
    <span class="s5"># check the dimension of the slider patch in axes units</span>
    <span class="s1">box </span><span class="s2">= </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">poly</span><span class="s2">.</span><span class="s1">get_extents</span><span class="s2">().</span><span class="s1">transformed</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">.</span><span class="s1">inverted</span><span class="s2">())</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">box</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, [</span><span class="s4">.25</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">10</span><span class="s2">/</span><span class="s4">24</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_slider_reset</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">slider </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">''</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">valinit</span><span class="s2">=</span><span class="s4">.5</span><span class="s2">)</span>
    <span class="s1">slider</span><span class="s2">.</span><span class="s1">set_val</span><span class="s2">(</span><span class="s4">0.75</span><span class="s2">)</span>
    <span class="s1">slider</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val </span><span class="s2">== </span><span class="s4">0.5</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;orientation&quot;</span><span class="s2">, [</span><span class="s3">&quot;horizontal&quot;</span><span class="s2">, </span><span class="s3">&quot;vertical&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_range_slider</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">orientation </span><span class="s2">== </span><span class="s3">&quot;vertical&quot;</span><span class="s2">:</span>
        <span class="s1">idx </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">idx </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">slider </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RangeSlider</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s1">orientation</span><span class="s2">,</span>
        <span class="s1">valinit</span><span class="s2">=[</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.34</span><span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s1">box </span><span class="s2">= </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">poly</span><span class="s2">.</span><span class="s1">get_extents</span><span class="s2">().</span><span class="s1">transformed</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">.</span><span class="s1">inverted</span><span class="s2">())</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">box</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">().</span><span class="s1">flatten</span><span class="s2">()[</span><span class="s1">idx</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.34</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">])</span>

    <span class="s5"># Check initial value is set correctly</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val</span><span class="s2">, (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.34</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">handle_positions</span><span class="s2">(</span><span class="s1">slider</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">orientation </span><span class="s2">== </span><span class="s3">&quot;vertical&quot;</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s2">[</span><span class="s1">h</span><span class="s2">.</span><span class="s1">get_ydata</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">] </span><span class="s0">for </span><span class="s1">h </span><span class="s0">in </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">_handles</span><span class="s2">]</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s2">[</span><span class="s1">h</span><span class="s2">.</span><span class="s1">get_xdata</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">] </span><span class="s0">for </span><span class="s1">h </span><span class="s0">in </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">_handles</span><span class="s2">]</span>

    <span class="s1">slider</span><span class="s2">.</span><span class="s1">set_val</span><span class="s2">((</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val</span><span class="s2">, (</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">handle_positions</span><span class="s2">(</span><span class="s1">slider</span><span class="s2">), (</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">))</span>

    <span class="s1">box </span><span class="s2">= </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">poly</span><span class="s2">.</span><span class="s1">get_extents</span><span class="s2">().</span><span class="s1">transformed</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">.</span><span class="s1">inverted</span><span class="s2">())</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">box</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">().</span><span class="s1">flatten</span><span class="s2">()[</span><span class="s1">idx</span><span class="s2">], [</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">.25</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">.75</span><span class="s2">])</span>

    <span class="s1">slider</span><span class="s2">.</span><span class="s1">set_val</span><span class="s2">((</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val</span><span class="s2">, (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">handle_positions</span><span class="s2">(</span><span class="s1">slider</span><span class="s2">), (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">))</span>

    <span class="s1">slider</span><span class="s2">.</span><span class="s1">set_val</span><span class="s2">((-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val</span><span class="s2">, (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">handle_positions</span><span class="s2">(</span><span class="s1">slider</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>

    <span class="s1">slider</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">slider</span><span class="s2">.</span><span class="s1">val</span><span class="s2">, (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.34</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">handle_positions</span><span class="s2">(</span><span class="s1">slider</span><span class="s2">), (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.34</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;orientation&quot;</span><span class="s2">, [</span><span class="s3">&quot;horizontal&quot;</span><span class="s2">, </span><span class="s3">&quot;vertical&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_range_slider_same_init_values</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">orientation </span><span class="s2">== </span><span class="s3">&quot;vertical&quot;</span><span class="s2">:</span>
        <span class="s1">idx </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">idx </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">slider </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RangeSlider</span><span class="s2">(</span>
         <span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s1">valmin</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">valmax</span><span class="s2">=</span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s1">orientation</span><span class="s2">,</span>
         <span class="s1">valinit</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
     <span class="s2">)</span>
    <span class="s1">box </span><span class="s2">= </span><span class="s1">slider</span><span class="s2">.</span><span class="s1">poly</span><span class="s2">.</span><span class="s1">get_extents</span><span class="s2">().</span><span class="s1">transformed</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">.</span><span class="s1">inverted</span><span class="s2">())</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">box</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">().</span><span class="s1">flatten</span><span class="s2">()[</span><span class="s1">idx</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">check_polygon_selector</span><span class="s2">(</span><span class="s1">event_sequence</span><span class="s2">, </span><span class="s1">expected_result</span><span class="s2">, </span><span class="s1">selections_count</span><span class="s2">,</span>
                           <span class="s2">**</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot; 
    Helper function to test Polygon Selector. 
 
    Parameters 
    ---------- 
    event_sequence : list of tuples (etype, dict()) 
        A sequence of events to perform. The sequence is a list of tuples 
        where the first element of the tuple is an etype (e.g., 'onmove', 
        'press', etc.), and the second element of the tuple is a dictionary of 
         the arguments for the event (e.g., xdata=5, key='shift', etc.). 
    expected_result : list of vertices (xdata, ydata) 
        The list of vertices that are expected to result from the event 
        sequence. 
    selections_count : int 
        Wait for the tool to call its `onselect` function `selections_count` 
        times, before comparing the result to the `expected_result` 
    **kwargs 
        Keyword arguments are passed to PolygonSelector. 
    &quot;&quot;&quot;</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">get_ax</span><span class="s2">()</span>

    <span class="s1">onselect </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">PolygonSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s2">(</span><span class="s1">etype</span><span class="s2">, </span><span class="s1">event_args</span><span class="s2">) </span><span class="s0">in </span><span class="s1">event_sequence</span><span class="s2">:</span>
        <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">etype</span><span class="s2">, **</span><span class="s1">event_args</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">onselect</span><span class="s2">.</span><span class="s1">call_count </span><span class="s2">== </span><span class="s1">selections_count</span>
    <span class="s0">assert </span><span class="s1">onselect</span><span class="s2">.</span><span class="s1">call_args </span><span class="s2">== ((</span><span class="s1">expected_result</span><span class="s2">, ), {})</span>


<span class="s0">def </span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s2">[(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s1">ydata</span><span class="s2">)),</span>
            <span class="s2">(</span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s1">ydata</span><span class="s2">)),</span>
            <span class="s2">(</span><span class="s3">'release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s1">ydata</span><span class="s2">))]</span>


<span class="s0">def </span><span class="s1">polygon_remove_vertex</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s2">[(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s1">ydata</span><span class="s2">)),</span>
            <span class="s2">(</span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s1">ydata</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">3</span><span class="s2">)),</span>
            <span class="s2">(</span><span class="s3">'release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s1">ydata</span><span class="s2">, </span><span class="s1">button</span><span class="s2">=</span><span class="s4">3</span><span class="s2">))]</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'draw_bounding_box'</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_polygon_selector</span><span class="s2">(</span><span class="s1">draw_bounding_box</span><span class="s2">):</span>
    <span class="s1">check_selector </span><span class="s2">= </span><span class="s1">functools</span><span class="s2">.</span><span class="s1">partial</span><span class="s2">(</span>
        <span class="s1">check_polygon_selector</span><span class="s2">, </span><span class="s1">draw_bounding_box</span><span class="s2">=</span><span class="s1">draw_bounding_box</span><span class="s2">)</span>

    <span class="s5"># Simple polygon</span>
    <span class="s1">expected_result </span><span class="s2">= [(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)]</span>
    <span class="s1">event_sequence </span><span class="s2">= [</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
    <span class="s2">]</span>
    <span class="s1">check_selector</span><span class="s2">(</span><span class="s1">event_sequence</span><span class="s2">, </span><span class="s1">expected_result</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>

    <span class="s5"># Move first vertex before completing the polygon.</span>
    <span class="s1">expected_result </span><span class="s2">= [(</span><span class="s4">75</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)]</span>
    <span class="s1">event_sequence </span><span class="s2">= [</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">'on_key_press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s3">'control'</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">50</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">50</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">50</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">50</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">75</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">50</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">75</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">50</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'on_key_release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s3">'control'</span><span class="s2">)),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">75</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
    <span class="s2">]</span>
    <span class="s1">check_selector</span><span class="s2">(</span><span class="s1">event_sequence</span><span class="s2">, </span><span class="s1">expected_result</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>

    <span class="s5"># Move first two vertices at once before completing the polygon.</span>
    <span class="s1">expected_result </span><span class="s2">= [(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">75</span><span class="s2">), (</span><span class="s4">150</span><span class="s2">, </span><span class="s4">75</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)]</span>
    <span class="s1">event_sequence </span><span class="s2">= [</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">'on_key_press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s3">'shift'</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'on_key_release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s3">'shift'</span><span class="s2">)),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">75</span><span class="s2">),</span>
    <span class="s2">]</span>
    <span class="s1">check_selector</span><span class="s2">(</span><span class="s1">event_sequence</span><span class="s2">, </span><span class="s1">expected_result</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>

    <span class="s5"># Move first vertex after completing the polygon.</span>
    <span class="s1">expected_result </span><span class="s2">= [(</span><span class="s4">75</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)]</span>
    <span class="s1">event_sequence </span><span class="s2">= [</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">50</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">50</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">50</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">50</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">75</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">50</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">75</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">50</span><span class="s2">)),</span>
    <span class="s2">]</span>
    <span class="s1">check_selector</span><span class="s2">(</span><span class="s1">event_sequence</span><span class="s2">, </span><span class="s1">expected_result</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>

    <span class="s5"># Move all vertices after completing the polygon.</span>
    <span class="s1">expected_result </span><span class="s2">= [(</span><span class="s4">75</span><span class="s2">, </span><span class="s4">75</span><span class="s2">), (</span><span class="s4">175</span><span class="s2">, </span><span class="s4">75</span><span class="s2">), (</span><span class="s4">75</span><span class="s2">, </span><span class="s4">175</span><span class="s2">)]</span>
    <span class="s1">event_sequence </span><span class="s2">= [</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">'on_key_press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s3">'shift'</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'on_key_release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s3">'shift'</span><span class="s2">)),</span>
    <span class="s2">]</span>
    <span class="s1">check_selector</span><span class="s2">(</span><span class="s1">event_sequence</span><span class="s2">, </span><span class="s1">expected_result</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>

    <span class="s5"># Try to move a vertex and move all before placing any vertices.</span>
    <span class="s1">expected_result </span><span class="s2">= [(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)]</span>
    <span class="s1">event_sequence </span><span class="s2">= [</span>
        <span class="s2">(</span><span class="s3">'on_key_press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s3">'control'</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'on_key_release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s3">'control'</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'on_key_press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s3">'shift'</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'onmove'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">125</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'on_key_release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s3">'shift'</span><span class="s2">)),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
    <span class="s2">]</span>
    <span class="s1">check_selector</span><span class="s2">(</span><span class="s1">event_sequence</span><span class="s2">, </span><span class="s1">expected_result</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>

    <span class="s5"># Try to place vertex out-of-bounds, then reset, and start a new polygon.</span>
    <span class="s1">expected_result </span><span class="s2">= [(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)]</span>
    <span class="s1">event_sequence </span><span class="s2">= [</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">250</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">'on_key_press'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s3">'escape'</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s3">'on_key_release'</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s3">'escape'</span><span class="s2">)),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
    <span class="s2">]</span>
    <span class="s1">check_selector</span><span class="s2">(</span><span class="s1">event_sequence</span><span class="s2">, </span><span class="s1">expected_result</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'draw_bounding_box'</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_polygon_selector_set_props_handle_props</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">draw_bounding_box</span><span class="s2">):</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">PolygonSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">,</span>
                                   <span class="s1">props</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">'b'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.2</span><span class="s2">),</span>
                                   <span class="s1">handle_props</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">),</span>
                                   <span class="s1">draw_bounding_box</span><span class="s2">=</span><span class="s1">draw_bounding_box</span><span class="s2">)</span>

    <span class="s1">event_sequence </span><span class="s2">= [</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">),</span>
    <span class="s2">]</span>

    <span class="s0">for </span><span class="s2">(</span><span class="s1">etype</span><span class="s2">, </span><span class="s1">event_args</span><span class="s2">) </span><span class="s0">in </span><span class="s1">event_sequence</span><span class="s2">:</span>
        <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">etype</span><span class="s2">, **</span><span class="s1">event_args</span><span class="s2">)</span>

    <span class="s1">artist </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_artist</span>
    <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s3">'b'</span>
    <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">0.2</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">set_props</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">'r'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s3">'r'</span>
    <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">0.3</span>

    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_handles_artists</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s3">'b'</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">0.5</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">set_handle_props</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">'r'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_handles_artists</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s3">'r'</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">0.3</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_rect_visibility</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s5"># Check that requesting an invisible selector makes it invisible</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">_ </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">RectangleSelector</span><span class="s2">(</span><span class="s1">ax_test</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">,</span>
                                     <span class="s1">props</span><span class="s2">={</span><span class="s3">'visible'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">})</span>
    <span class="s1">tool</span><span class="s2">.</span><span class="s1">extents </span><span class="s2">= (</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.8</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.7</span><span class="s2">)</span>


<span class="s5"># Change the order that the extra point is inserted in</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'idx'</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'draw_bounding_box'</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_polygon_selector_remove</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">draw_bounding_box</span><span class="s2">):</span>
    <span class="s1">verts </span><span class="s2">= [(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)]</span>
    <span class="s1">event_sequence </span><span class="s2">= [</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]),</span>
                      <span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]),</span>
                      <span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]),</span>
                      <span class="s5"># Finish the polygon</span>
                      <span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">0</span><span class="s2">])]</span>
    <span class="s5"># Add an extra point</span>
    <span class="s1">event_sequence</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s4">200</span><span class="s2">, </span><span class="s4">200</span><span class="s2">))</span>
    <span class="s5"># Remove the extra point</span>
    <span class="s1">event_sequence</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">polygon_remove_vertex</span><span class="s2">(</span><span class="s4">200</span><span class="s2">, </span><span class="s4">200</span><span class="s2">))</span>
    <span class="s5"># Flatten list of lists</span>
    <span class="s1">event_sequence </span><span class="s2">= </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">event_sequence</span><span class="s2">, [])</span>
    <span class="s1">check_polygon_selector</span><span class="s2">(</span><span class="s1">event_sequence</span><span class="s2">, </span><span class="s1">verts</span><span class="s2">, </span><span class="s4">2</span><span class="s2">,</span>
                           <span class="s1">draw_bounding_box</span><span class="s2">=</span><span class="s1">draw_bounding_box</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'draw_bounding_box'</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_polygon_selector_remove_first_point</span><span class="s2">(</span><span class="s1">draw_bounding_box</span><span class="s2">):</span>
    <span class="s1">verts </span><span class="s2">= [(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)]</span>
    <span class="s1">event_sequence </span><span class="s2">= [</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_remove_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]),</span>
    <span class="s2">]</span>
    <span class="s1">check_polygon_selector</span><span class="s2">(</span><span class="s1">event_sequence</span><span class="s2">, </span><span class="s1">verts</span><span class="s2">[</span><span class="s4">1</span><span class="s2">:], </span><span class="s4">2</span><span class="s2">,</span>
                           <span class="s1">draw_bounding_box</span><span class="s2">=</span><span class="s1">draw_bounding_box</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'draw_bounding_box'</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_polygon_selector_redraw</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">draw_bounding_box</span><span class="s2">):</span>
    <span class="s1">verts </span><span class="s2">= [(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)]</span>
    <span class="s1">event_sequence </span><span class="s2">= [</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]),</span>
        <span class="s5"># Polygon completed, now remove first two verts.</span>
        <span class="s2">*</span><span class="s1">polygon_remove_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_remove_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]),</span>
        <span class="s5"># At this point the tool should be reset so we can add more vertices.</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]),</span>
    <span class="s2">]</span>

    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">PolygonSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">,</span>
                                   <span class="s1">draw_bounding_box</span><span class="s2">=</span><span class="s1">draw_bounding_box</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s2">(</span><span class="s1">etype</span><span class="s2">, </span><span class="s1">event_args</span><span class="s2">) </span><span class="s0">in </span><span class="s1">event_sequence</span><span class="s2">:</span>
        <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">etype</span><span class="s2">, **</span><span class="s1">event_args</span><span class="s2">)</span>
    <span class="s5"># After removing two verts, only one remains, and the</span>
    <span class="s5"># selector should be automatically resete</span>
    <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">verts </span><span class="s2">== </span><span class="s1">verts</span><span class="s2">[</span><span class="s4">0</span><span class="s2">:</span><span class="s4">2</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'draw_bounding_box'</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s3">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_polygon_selector_verts_setter</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">draw_bounding_box</span><span class="s2">):</span>
    <span class="s1">verts </span><span class="s2">= [(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">), (</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">), (</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">)]</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>

    <span class="s1">tool_test </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">PolygonSelector</span><span class="s2">(</span>
        <span class="s1">ax_test</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">draw_bounding_box</span><span class="s2">=</span><span class="s1">draw_bounding_box</span><span class="s2">)</span>
    <span class="s1">tool_test</span><span class="s2">.</span><span class="s1">verts </span><span class="s2">= </span><span class="s1">verts</span>
    <span class="s0">assert </span><span class="s1">tool_test</span><span class="s2">.</span><span class="s1">verts </span><span class="s2">== </span><span class="s1">verts</span>

    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">tool_ref </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">PolygonSelector</span><span class="s2">(</span>
        <span class="s1">ax_ref</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">draw_bounding_box</span><span class="s2">=</span><span class="s1">draw_bounding_box</span><span class="s2">)</span>
    <span class="s1">event_sequence </span><span class="s2">= [</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]),</span>
    <span class="s2">]</span>
    <span class="s0">for </span><span class="s2">(</span><span class="s1">etype</span><span class="s2">, </span><span class="s1">event_args</span><span class="s2">) </span><span class="s0">in </span><span class="s1">event_sequence</span><span class="s2">:</span>
        <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool_ref</span><span class="s2">, </span><span class="s1">etype</span><span class="s2">, **</span><span class="s1">event_args</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_polygon_selector_box</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s5"># Create a diamond (adjusting axes lims s.t. the diamond lies within axes limits).</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(-</span><span class="s4">10</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(-</span><span class="s4">10</span><span class="s2">, </span><span class="s4">50</span><span class="s2">))</span>
    <span class="s1">verts </span><span class="s2">= [(</span><span class="s4">20</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">20</span><span class="s2">), (</span><span class="s4">20</span><span class="s2">, </span><span class="s4">40</span><span class="s2">), (</span><span class="s4">40</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)]</span>
    <span class="s1">event_sequence </span><span class="s2">= [</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]),</span>
        <span class="s2">*</span><span class="s1">polygon_place_vertex</span><span class="s2">(*</span><span class="s1">verts</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]),</span>
    <span class="s2">]</span>

    <span class="s5"># Create selector</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">PolygonSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">draw_bounding_box</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s2">(</span><span class="s1">etype</span><span class="s2">, </span><span class="s1">event_args</span><span class="s2">) </span><span class="s0">in </span><span class="s1">event_sequence</span><span class="s2">:</span>
        <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">etype</span><span class="s2">, **</span><span class="s1">event_args</span><span class="s2">)</span>

    <span class="s5"># In order to trigger the correct callbacks, trigger events on the canvas</span>
    <span class="s5"># instead of the individual tools</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span>
    <span class="s1">canvas </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">.</span><span class="s1">canvas</span>

    <span class="s5"># Scale to half size using the top right corner of the bounding box</span>
    <span class="s1">MouseEvent</span><span class="s2">(</span>
        <span class="s3">&quot;button_press_event&quot;</span><span class="s2">, </span><span class="s1">canvas</span><span class="s2">, *</span><span class="s1">t</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">((</span><span class="s4">40</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)), </span><span class="s4">1</span><span class="s2">).</span><span class="s1">_process</span><span class="s2">()</span>
    <span class="s1">MouseEvent</span><span class="s2">(</span>
        <span class="s3">&quot;motion_notify_event&quot;</span><span class="s2">, </span><span class="s1">canvas</span><span class="s2">, *</span><span class="s1">t</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">((</span><span class="s4">20</span><span class="s2">, </span><span class="s4">20</span><span class="s2">))).</span><span class="s1">_process</span><span class="s2">()</span>
    <span class="s1">MouseEvent</span><span class="s2">(</span>
        <span class="s3">&quot;button_release_event&quot;</span><span class="s2">, </span><span class="s1">canvas</span><span class="s2">, *</span><span class="s1">t</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">((</span><span class="s4">20</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)), </span><span class="s4">1</span><span class="s2">).</span><span class="s1">_process</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">verts</span><span class="s2">, [(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), (</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">), (</span><span class="s4">20</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)])</span>

    <span class="s5"># Move using the center of the bounding box</span>
    <span class="s1">MouseEvent</span><span class="s2">(</span>
        <span class="s3">&quot;button_press_event&quot;</span><span class="s2">, </span><span class="s1">canvas</span><span class="s2">, *</span><span class="s1">t</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">((</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)), </span><span class="s4">1</span><span class="s2">).</span><span class="s1">_process</span><span class="s2">()</span>
    <span class="s1">MouseEvent</span><span class="s2">(</span>
        <span class="s3">&quot;motion_notify_event&quot;</span><span class="s2">, </span><span class="s1">canvas</span><span class="s2">, *</span><span class="s1">t</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">((</span><span class="s4">30</span><span class="s2">, </span><span class="s4">30</span><span class="s2">))).</span><span class="s1">_process</span><span class="s2">()</span>
    <span class="s1">MouseEvent</span><span class="s2">(</span>
        <span class="s3">&quot;button_release_event&quot;</span><span class="s2">, </span><span class="s1">canvas</span><span class="s2">, *</span><span class="s1">t</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">((</span><span class="s4">30</span><span class="s2">, </span><span class="s4">30</span><span class="s2">)), </span><span class="s4">1</span><span class="s2">).</span><span class="s1">_process</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">verts</span><span class="s2">, [(</span><span class="s4">30</span><span class="s2">, </span><span class="s4">20</span><span class="s2">), (</span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s2">), (</span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s2">), (</span><span class="s4">40</span><span class="s2">, </span><span class="s4">30</span><span class="s2">)])</span>

    <span class="s5"># Remove a point from the polygon and check that the box extents update</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">_box</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, (</span><span class="s4">20.0</span><span class="s2">, </span><span class="s4">40.0</span><span class="s2">, </span><span class="s4">20.0</span><span class="s2">, </span><span class="s4">40.0</span><span class="s2">))</span>

    <span class="s1">MouseEvent</span><span class="s2">(</span>
        <span class="s3">&quot;button_press_event&quot;</span><span class="s2">, </span><span class="s1">canvas</span><span class="s2">, *</span><span class="s1">t</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">((</span><span class="s4">30</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)), </span><span class="s4">3</span><span class="s2">).</span><span class="s1">_process</span><span class="s2">()</span>
    <span class="s1">MouseEvent</span><span class="s2">(</span>
        <span class="s3">&quot;button_release_event&quot;</span><span class="s2">, </span><span class="s1">canvas</span><span class="s2">, *</span><span class="s1">t</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">((</span><span class="s4">30</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)), </span><span class="s4">3</span><span class="s2">).</span><span class="s1">_process</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">verts</span><span class="s2">, [(</span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s2">), (</span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s2">), (</span><span class="s4">40</span><span class="s2">, </span><span class="s4">30</span><span class="s2">)])</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span>
        <span class="s1">tool</span><span class="s2">.</span><span class="s1">_box</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, (</span><span class="s4">20.0</span><span class="s2">, </span><span class="s4">40.0</span><span class="s2">, </span><span class="s4">30.0</span><span class="s2">, </span><span class="s4">40.0</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_polygon_selector_clear_method</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s1">onselect </span><span class="s2">= </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">Mock</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">=</span><span class="s1">noop</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">tool </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">PolygonSelector</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">onselect</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">result </span><span class="s0">in </span><span class="s2">([(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">150</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">)],</span>
                   <span class="s2">[(</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">100</span><span class="s2">, </span><span class="s4">50</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">150</span><span class="s2">), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">)]):</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">result</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">etype</span><span class="s2">, </span><span class="s1">event_args </span><span class="s0">in </span><span class="s1">polygon_place_vertex</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
                <span class="s1">do_event</span><span class="s2">(</span><span class="s1">tool</span><span class="s2">, </span><span class="s1">etype</span><span class="s2">, **</span><span class="s1">event_args</span><span class="s2">)</span>

        <span class="s1">artist </span><span class="s2">= </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_artist</span>

        <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_completed</span>
        <span class="s0">assert </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_xydata</span><span class="s2">(), </span><span class="s1">result</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">onselect</span><span class="s2">.</span><span class="s1">call_args </span><span class="s2">== ((</span><span class="s1">result</span><span class="s2">[:-</span><span class="s4">1</span><span class="s2">],), {})</span>

        <span class="s1">tool</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">()</span>
        <span class="s0">assert not </span><span class="s1">tool</span><span class="s2">.</span><span class="s1">_selection_completed</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">artist</span><span class="s2">.</span><span class="s1">get_xydata</span><span class="s2">(), [(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)])</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;horizOn&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;vertOn&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_MultiCursor</span><span class="s2">(</span><span class="s1">horizOn</span><span class="s2">, </span><span class="s1">vertOn</span><span class="s2">):</span>
    <span class="s2">(</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax3</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s5"># useblit=false to avoid having to draw the figure to cache the renderer</span>
    <span class="s1">multi </span><span class="s2">= </span><span class="s1">widgets</span><span class="s2">.</span><span class="s1">MultiCursor</span><span class="s2">(</span>
        <span class="s0">None</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">), </span><span class="s1">useblit</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">horizOn</span><span class="s2">=</span><span class="s1">horizOn</span><span class="s2">, </span><span class="s1">vertOn</span><span class="s2">=</span><span class="s1">vertOn</span>
    <span class="s2">)</span>

    <span class="s5"># Only two of the axes should have a line drawn on them.</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">multi</span><span class="s2">.</span><span class="s1">vlines</span><span class="s2">) == </span><span class="s4">2</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">multi</span><span class="s2">.</span><span class="s1">hlines</span><span class="s2">) == </span><span class="s4">2</span>

    <span class="s5"># mock a motion_notify_event</span>
    <span class="s5"># Can't use `do_event` as that helper requires the widget</span>
    <span class="s5"># to have a single .ax attribute.</span>
    <span class="s1">event </span><span class="s2">= </span><span class="s1">mock_event</span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">.5</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">.25</span><span class="s2">)</span>
    <span class="s1">multi</span><span class="s2">.</span><span class="s1">onmove</span><span class="s2">(</span><span class="s1">event</span><span class="s2">)</span>
    <span class="s5"># force a draw + draw event to exercise clear</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s5"># the lines in the first two ax should both move</span>
    <span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">multi</span><span class="s2">.</span><span class="s1">vlines</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">l</span><span class="s2">.</span><span class="s1">get_xdata</span><span class="s2">() == (</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">multi</span><span class="s2">.</span><span class="s1">hlines</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">l</span><span class="s2">.</span><span class="s1">get_ydata</span><span class="s2">() == (</span><span class="s4">.25</span><span class="s2">, </span><span class="s4">.25</span><span class="s2">)</span>
    <span class="s5"># The relevant lines get turned on after move.</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">([</span><span class="s1">line </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">multi</span><span class="s2">.</span><span class="s1">vlines </span><span class="s0">if </span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()]) == (</span>
        <span class="s4">2 </span><span class="s0">if </span><span class="s1">vertOn </span><span class="s0">else </span><span class="s4">0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">([</span><span class="s1">line </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">multi</span><span class="s2">.</span><span class="s1">hlines </span><span class="s0">if </span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()]) == (</span>
        <span class="s4">2 </span><span class="s0">if </span><span class="s1">horizOn </span><span class="s0">else </span><span class="s4">0</span><span class="s2">)</span>

    <span class="s5"># After toggling settings, the opposite lines should be visible after move.</span>
    <span class="s1">multi</span><span class="s2">.</span><span class="s1">horizOn </span><span class="s2">= </span><span class="s0">not </span><span class="s1">multi</span><span class="s2">.</span><span class="s1">horizOn</span>
    <span class="s1">multi</span><span class="s2">.</span><span class="s1">vertOn </span><span class="s2">= </span><span class="s0">not </span><span class="s1">multi</span><span class="s2">.</span><span class="s1">vertOn</span>
    <span class="s1">event </span><span class="s2">= </span><span class="s1">mock_event</span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">.5</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">.25</span><span class="s2">)</span>
    <span class="s1">multi</span><span class="s2">.</span><span class="s1">onmove</span><span class="s2">(</span><span class="s1">event</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">([</span><span class="s1">line </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">multi</span><span class="s2">.</span><span class="s1">vlines </span><span class="s0">if </span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()]) == (</span>
        <span class="s4">0 </span><span class="s0">if </span><span class="s1">vertOn </span><span class="s0">else </span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">([</span><span class="s1">line </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">multi</span><span class="s2">.</span><span class="s1">hlines </span><span class="s0">if </span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()]) == (</span>
        <span class="s4">0 </span><span class="s0">if </span><span class="s1">horizOn </span><span class="s0">else </span><span class="s4">2</span><span class="s2">)</span>

    <span class="s5"># test a move event in an Axes not part of the MultiCursor</span>
    <span class="s5"># the lines in ax1 and ax2 should not have moved.</span>
    <span class="s1">event </span><span class="s2">= </span><span class="s1">mock_event</span><span class="s2">(</span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">=</span><span class="s4">.75</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">=</span><span class="s4">.75</span><span class="s2">)</span>
    <span class="s1">multi</span><span class="s2">.</span><span class="s1">onmove</span><span class="s2">(</span><span class="s1">event</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">multi</span><span class="s2">.</span><span class="s1">vlines</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">l</span><span class="s2">.</span><span class="s1">get_xdata</span><span class="s2">() == (</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">multi</span><span class="s2">.</span><span class="s1">hlines</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">l</span><span class="s2">.</span><span class="s1">get_ydata</span><span class="s2">() == (</span><span class="s4">.25</span><span class="s2">, </span><span class="s4">.25</span><span class="s2">)</span>
</pre>
</body>
</html>