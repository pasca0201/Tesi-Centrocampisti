<html>
<head>
<title>test_to_latex.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_to_latex.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">textwrap </span><span class="s0">import </span><span class="s1">dedent</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">DataFrame</span><span class="s2">,</span>
    <span class="s1">MultiIndex</span><span class="s2">,</span>
    <span class="s1">Series</span><span class="s2">,</span>
    <span class="s1">option_context</span><span class="s2">,</span>
<span class="s2">)</span>

<span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s3">&quot;jinja2&quot;</span><span class="s2">)</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">io</span><span class="s2">.</span><span class="s1">formats</span><span class="s2">.</span><span class="s1">style </span><span class="s0">import </span><span class="s1">Styler</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">io</span><span class="s2">.</span><span class="s1">formats</span><span class="s2">.</span><span class="s1">style_render </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">_parse_latex_cell_styles</span><span class="s2">,</span>
    <span class="s1">_parse_latex_css_conversion</span><span class="s2">,</span>
    <span class="s1">_parse_latex_header_span</span><span class="s2">,</span>
    <span class="s1">_parse_latex_table_styles</span><span class="s2">,</span>
    <span class="s1">_parse_latex_table_wrapping</span><span class="s2">,</span>
<span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
<span class="s0">def </span><span class="s1">df</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">{</span><span class="s3">&quot;A&quot;</span><span class="s2">: [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s3">&quot;B&quot;</span><span class="s2">: [-</span><span class="s4">0.61</span><span class="s2">, -</span><span class="s4">1.22</span><span class="s2">], </span><span class="s3">&quot;C&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s3">&quot;ab&quot;</span><span class="s2">, </span><span class="s3">&quot;cd&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">)}</span>
    <span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
<span class="s0">def </span><span class="s1">df_ext</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">{</span><span class="s3">&quot;A&quot;</span><span class="s2">: [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], </span><span class="s3">&quot;B&quot;</span><span class="s2">: [-</span><span class="s4">0.61</span><span class="s2">, -</span><span class="s4">1.22</span><span class="s2">, -</span><span class="s4">2.22</span><span class="s2">], </span><span class="s3">&quot;C&quot;</span><span class="s2">: [</span><span class="s3">&quot;ab&quot;</span><span class="s2">, </span><span class="s3">&quot;cd&quot;</span><span class="s2">, </span><span class="s3">&quot;de&quot;</span><span class="s2">]}</span>
    <span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
<span class="s0">def </span><span class="s1">styler</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">Styler</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">uuid_len</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">precision</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_minimal_latex_tabular</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{lrrl} 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s3">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">() == </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_tabular_hrules</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{lrrl} 
        </span><span class="s0">\\</span><span class="s3">toprule 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">midrule 
        0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">bottomrule 
        </span><span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">hrules</span><span class="s2">=</span><span class="s0">True</span><span class="s2">) == </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_tabular_custom_hrules</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">set_table_styles</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;toprule&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:hline&quot;</span><span class="s2">},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;bottomrule&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:otherline&quot;</span><span class="s2">},</span>
        <span class="s2">]</span>
    <span class="s2">)  </span><span class="s5"># no midrule</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{lrrl} 
        </span><span class="s0">\\</span><span class="s3">hline 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s3">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">otherline 
        </span><span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">() == </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_column_format</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s5"># default setting is already tested in `test_latex_minimal_tabular`</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">set_table_styles</span><span class="s2">([{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;column_format&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:cccc&quot;</span><span class="s2">}])</span>

    <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">begin{tabular}{rrrr}&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">column_format</span><span class="s2">=</span><span class="s3">&quot;rrrr&quot;</span><span class="s2">)</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">set_table_styles</span><span class="s2">([{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;column_format&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:r|r|cc&quot;</span><span class="s2">}])</span>
    <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">begin{tabular}{r|r|cc}&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_siunitx_cols</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{lSSl} 
        {} &amp; {A} &amp; {B} &amp; {C} </span><span class="s0">\\\\</span>
        <span class="s3">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">siunitx</span><span class="s2">=</span><span class="s0">True</span><span class="s2">) == </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_position</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">begin{table}[h!]&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">position</span><span class="s2">=</span><span class="s3">&quot;h!&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">end{table}&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">position</span><span class="s2">=</span><span class="s3">&quot;h!&quot;</span><span class="s2">)</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">set_table_styles</span><span class="s2">([{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;position&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:b!&quot;</span><span class="s2">}])</span>
    <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">begin{table}[b!]&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">end{table}&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;env&quot;</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;longtable&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_label</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">, </span><span class="s1">env</span><span class="s2">):</span>
    <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\n\\</span><span class="s3">label{text}&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;text&quot;</span><span class="s2">, </span><span class="s1">environment</span><span class="s2">=</span><span class="s1">env</span><span class="s2">)</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">set_table_styles</span><span class="s2">([{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;label&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:{more §text}&quot;</span><span class="s2">}])</span>
    <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\n\\</span><span class="s3">label{more :text}&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">environment</span><span class="s2">=</span><span class="s1">env</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_position_float_raises</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;`position_float` should be one of 'raggedright', 'raggedleft', 'centering',&quot;</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">position_float</span><span class="s2">=</span><span class="s3">&quot;bad_string&quot;</span><span class="s2">)</span>

    <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;`position_float` cannot be used in 'longtable' `environment`&quot;</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">position_float</span><span class="s2">=</span><span class="s3">&quot;centering&quot;</span><span class="s2">, </span><span class="s1">environment</span><span class="s2">=</span><span class="s3">&quot;longtable&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;label&quot;</span><span class="s2">, [(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">), (</span><span class="s3">&quot;text&quot;</span><span class="s2">, </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">label{text}&quot;</span><span class="s2">)])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;position&quot;</span><span class="s2">, [(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">), (</span><span class="s3">&quot;h!&quot;</span><span class="s2">, </span><span class="s3">&quot;{table}[h!]&quot;</span><span class="s2">)])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;caption&quot;</span><span class="s2">, [(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">), (</span><span class="s3">&quot;text&quot;</span><span class="s2">, </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">caption{text}&quot;</span><span class="s2">)])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;column_format&quot;</span><span class="s2">, [(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">), (</span><span class="s3">&quot;rcrl&quot;</span><span class="s2">, </span><span class="s3">&quot;{tabular}{rcrl}&quot;</span><span class="s2">)])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;position_float&quot;</span><span class="s2">, [(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">), (</span><span class="s3">&quot;centering&quot;</span><span class="s2">, </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">centering&quot;</span><span class="s2">)])</span>
<span class="s0">def </span><span class="s1">test_kwargs_combinations</span><span class="s2">(</span>
    <span class="s1">styler</span><span class="s2">, </span><span class="s1">label</span><span class="s2">, </span><span class="s1">position</span><span class="s2">, </span><span class="s1">caption</span><span class="s2">, </span><span class="s1">column_format</span><span class="s2">, </span><span class="s1">position_float</span>
<span class="s2">):</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span>
        <span class="s1">label</span><span class="s2">=</span><span class="s1">label</span><span class="s2">[</span><span class="s4">0</span><span class="s2">],</span>
        <span class="s1">position</span><span class="s2">=</span><span class="s1">position</span><span class="s2">[</span><span class="s4">0</span><span class="s2">],</span>
        <span class="s1">caption</span><span class="s2">=</span><span class="s1">caption</span><span class="s2">[</span><span class="s4">0</span><span class="s2">],</span>
        <span class="s1">column_format</span><span class="s2">=</span><span class="s1">column_format</span><span class="s2">[</span><span class="s4">0</span><span class="s2">],</span>
        <span class="s1">position_float</span><span class="s2">=</span><span class="s1">position_float</span><span class="s2">[</span><span class="s4">0</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">label</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] </span><span class="s0">in </span><span class="s1">result</span>
    <span class="s0">assert </span><span class="s1">position</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] </span><span class="s0">in </span><span class="s1">result</span>
    <span class="s0">assert </span><span class="s1">caption</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] </span><span class="s0">in </span><span class="s1">result</span>
    <span class="s0">assert </span><span class="s1">column_format</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] </span><span class="s0">in </span><span class="s1">result</span>
    <span class="s0">assert </span><span class="s1">position_float</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] </span><span class="s0">in </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">test_custom_table_styles</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">set_table_styles</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;mycommand&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:{myoptions}&quot;</span><span class="s2">},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;mycommand2&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:{myoptions2}&quot;</span><span class="s2">},</span>
        <span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{table} 
        </span><span class="s0">\\</span><span class="s3">mycommand{myoptions} 
        </span><span class="s0">\\</span><span class="s3">mycommand2{myoptions2} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_cell_styling</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">highlight_max</span><span class="s2">(</span><span class="s1">props</span><span class="s2">=</span><span class="s3">&quot;itshape:;Huge:--wrap;&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{lrrl} 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s3">0 &amp; 0 &amp; </span><span class="s0">\\</span><span class="s3">itshape {</span><span class="s0">\\</span><span class="s3">Huge -0.61} &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">1 &amp; </span><span class="s0">\\</span><span class="s3">itshape {</span><span class="s0">\\</span><span class="s3">Huge 1} &amp; -1.22 &amp; </span><span class="s0">\\</span><span class="s3">itshape {</span><span class="s0">\\</span><span class="s3">Huge cd} </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s2">== </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_multiindex_columns</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
    <span class="s1">cidx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">df</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">cidx</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{lrrl} 
         &amp; </span><span class="s0">\\</span><span class="s3">multicolumn{2}{r}{A} &amp; B </span><span class="s0">\\\\</span>
         <span class="s3">&amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
        <span class="s3">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s2">== </span><span class="s1">s</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>

    <span class="s5"># non-sparse</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{lrrl} 
         &amp; A &amp; A &amp; B </span><span class="s0">\\\\</span>
         <span class="s3">&amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
        <span class="s3">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s2">== </span><span class="s1">s</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">sparse_columns</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_multiindex_row</span><span class="s2">(</span><span class="s1">df_ext</span><span class="s2">):</span>
    <span class="s1">ridx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">df_ext</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">ridx</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{llrrl} 
         &amp;  &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">multirow[c]{2}{*}{A} &amp; a &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
         <span class="s3">&amp; b &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s3">B &amp; c &amp; 2 &amp; -2.22 &amp; de </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s1">styler </span><span class="s2">= </span><span class="s1">df_ext</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s2">== </span><span class="s1">result</span>

    <span class="s5"># non-sparse</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{llrrl} 
         &amp;  &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s3">A &amp; a &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">A &amp; b &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s3">B &amp; c &amp; 2 &amp; -2.22 &amp; de </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">sparse_index</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s2">== </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">test_multirow_naive</span><span class="s2">(</span><span class="s1">df_ext</span><span class="s2">):</span>
    <span class="s1">ridx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;X&quot;</span><span class="s2">, </span><span class="s3">&quot;x&quot;</span><span class="s2">), (</span><span class="s3">&quot;X&quot;</span><span class="s2">, </span><span class="s3">&quot;y&quot;</span><span class="s2">), (</span><span class="s3">&quot;Y&quot;</span><span class="s2">, </span><span class="s3">&quot;z&quot;</span><span class="s2">)])</span>
    <span class="s1">df_ext</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">ridx</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{llrrl} 
         &amp;  &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s3">X &amp; x &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
         <span class="s3">&amp; y &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s3">Y &amp; z &amp; 2 &amp; -2.22 &amp; de </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s1">styler </span><span class="s2">= </span><span class="s1">df_ext</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">multirow_align</span><span class="s2">=</span><span class="s3">&quot;naive&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s2">== </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">test_multiindex_row_and_col</span><span class="s2">(</span><span class="s1">df_ext</span><span class="s2">):</span>
    <span class="s1">cidx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;Z&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;Z&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;Y&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">ridx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">df_ext</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">df_ext</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">ridx</span><span class="s2">, </span><span class="s1">cidx</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{llrrl} 
         &amp;  &amp; </span><span class="s0">\\</span><span class="s3">multicolumn{2}{l}{Z} &amp; Y </span><span class="s0">\\\\</span>
         <span class="s3">&amp;  &amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">multirow[b]{2}{*}{A} &amp; a &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
         <span class="s3">&amp; b &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s3">B &amp; c &amp; 2 &amp; -2.22 &amp; de </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s1">styler </span><span class="s2">= </span><span class="s1">df_ext</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">multirow_align</span><span class="s2">=</span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s1">multicol_align</span><span class="s2">=</span><span class="s3">&quot;l&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s5"># non-sparse</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{llrrl} 
         &amp;  &amp; Z &amp; Z &amp; Y </span><span class="s0">\\\\</span>
         <span class="s3">&amp;  &amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
        <span class="s3">A &amp; a &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">A &amp; b &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s3">B &amp; c &amp; 2 &amp; -2.22 &amp; de </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">sparse_index</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">sparse_columns</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;multicol_align, siunitx, header&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s3">&quot;naive-l&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s3">&quot; &amp; A &amp; &amp;&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;naive-r&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s3">&quot; &amp; &amp; &amp; A&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;naive-l&quot;</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s3">&quot;{} &amp; {A} &amp; {} &amp; {}&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;naive-r&quot;</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s3">&quot;{} &amp; {} &amp; {} &amp; {A}&quot;</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_multicol_naive</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">multicol_align</span><span class="s2">, </span><span class="s1">siunitx</span><span class="s2">, </span><span class="s1">header</span><span class="s2">):</span>
    <span class="s1">ridx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">df</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">ridx</span>
    <span class="s1">level1 </span><span class="s2">= </span><span class="s3">&quot; &amp; a &amp; b &amp; c&quot; </span><span class="s0">if not </span><span class="s1">siunitx </span><span class="s0">else </span><span class="s3">&quot;{} &amp; {a} &amp; {b} &amp; {c}&quot;</span>
    <span class="s1">col_format </span><span class="s2">= </span><span class="s3">&quot;lrrl&quot; </span><span class="s0">if not </span><span class="s1">siunitx </span><span class="s0">else </span><span class="s3">&quot;lSSl&quot;</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">f&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin</span><span class="s0">{{</span><span class="s3">tabular</span><span class="s0">}}{{{</span><span class="s1">col_format</span><span class="s0">}}}</span>
        <span class="s0">{</span><span class="s1">header</span><span class="s0">} \\\\</span>
        <span class="s0">{</span><span class="s1">level1</span><span class="s0">} \\\\</span>
        <span class="s3">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end</span><span class="s0">{{</span><span class="s3">tabular</span><span class="s0">}}</span>
        <span class="s3">&quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s1">styler </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">multicol_align</span><span class="s2">=</span><span class="s1">multicol_align</span><span class="s2">, </span><span class="s1">siunitx</span><span class="s2">=</span><span class="s1">siunitx</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s2">== </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">test_multi_options</span><span class="s2">(</span><span class="s1">df_ext</span><span class="s2">):</span>
    <span class="s1">cidx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;Z&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;Z&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;Y&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">ridx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">df_ext</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">df_ext</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">ridx</span><span class="s2">, </span><span class="s1">cidx</span>
    <span class="s1">styler </span><span class="s2">= </span><span class="s1">df_ext</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
     </span><span class="s3">&amp;  &amp; </span><span class="s0">\\</span><span class="s3">multicolumn{2}{r}{Z} &amp; Y </span><span class="s0">\\\\</span>
     <span class="s3">&amp;  &amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
    <span class="s0">\\</span><span class="s3">multirow[c]{2}{*}{A} &amp; a &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
    <span class="s3">&quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">result</span>

    <span class="s0">with </span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">&quot;styler.latex.multicol_align&quot;</span><span class="s2">, </span><span class="s3">&quot;l&quot;</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s3">&quot; &amp;  &amp; </span><span class="s0">\\</span><span class="s3">multicolumn{2}{l}{Z} &amp; Y </span><span class="s0">\\\\</span><span class="s3">&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>

    <span class="s0">with </span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">&quot;styler.latex.multirow_align&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">multirow[b]{2}{*}{A} &amp; a &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span><span class="s3">&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_multiindex_columns_hidden</span><span class="s2">():</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]])</span>
    <span class="s1">df</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), (</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)])</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">style</span>
    <span class="s0">assert </span><span class="s3">&quot;{tabular}{lrrrr}&quot; </span><span class="s0">in </span><span class="s1">s</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>
    <span class="s1">s</span><span class="s2">.</span><span class="s1">set_table_styles</span><span class="s2">([])  </span><span class="s5"># reset the position command</span>
    <span class="s1">s</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)], </span><span class="s1">axis</span><span class="s2">=</span><span class="s3">&quot;columns&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s3">&quot;{tabular}{lrrr}&quot; </span><span class="s0">in </span><span class="s1">s</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;option, value&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s3">&quot;styler.sparse.index&quot;</span><span class="s2">, </span><span class="s0">True</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;styler.sparse.index&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;styler.sparse.columns&quot;</span><span class="s2">, </span><span class="s0">True</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;styler.sparse.columns&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_sparse_options</span><span class="s2">(</span><span class="s1">df_ext</span><span class="s2">, </span><span class="s1">option</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
    <span class="s1">cidx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;Z&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;Z&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;Y&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">ridx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">df_ext</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">df_ext</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">ridx</span><span class="s2">, </span><span class="s1">cidx</span>
    <span class="s1">styler </span><span class="s2">= </span><span class="s1">df_ext</span><span class="s2">.</span><span class="s1">style</span>

    <span class="s1">latex1 </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">option_context</span><span class="s2">(</span><span class="s1">option</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">latex2 </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">latex1 </span><span class="s2">== </span><span class="s1">latex2</span><span class="s2">) </span><span class="s0">is </span><span class="s1">value</span>


<span class="s0">def </span><span class="s1">test_hidden_index</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s3">&quot;index&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{rrl} 
        A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s3">0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">() == </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;environment&quot;</span><span class="s2">, [</span><span class="s3">&quot;table&quot;</span><span class="s2">, </span><span class="s3">&quot;figure*&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_comprehensive</span><span class="s2">(</span><span class="s1">df_ext</span><span class="s2">, </span><span class="s1">environment</span><span class="s2">):</span>
    <span class="s5"># test as many low level features simultaneously as possible</span>
    <span class="s1">cidx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;Z&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;Z&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;Y&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">ridx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">df_ext</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">df_ext</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">ridx</span><span class="s2">, </span><span class="s1">cidx</span>
    <span class="s1">stlr </span><span class="s2">= </span><span class="s1">df_ext</span><span class="s2">.</span><span class="s1">style</span>
    <span class="s1">stlr</span><span class="s2">.</span><span class="s1">set_caption</span><span class="s2">(</span><span class="s3">&quot;mycap&quot;</span><span class="s2">)</span>
    <span class="s1">stlr</span><span class="s2">.</span><span class="s1">set_table_styles</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;label&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:{fig§item}&quot;</span><span class="s2">},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;position&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:h!&quot;</span><span class="s2">},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;position_float&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:centering&quot;</span><span class="s2">},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;column_format&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:rlrlr&quot;</span><span class="s2">},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;toprule&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:toprule&quot;</span><span class="s2">},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;midrule&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:midrule&quot;</span><span class="s2">},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;bottomrule&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:bottomrule&quot;</span><span class="s2">},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;rowcolors&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:{3}{pink}{}&quot;</span><span class="s2">},  </span><span class="s5"># custom command</span>
        <span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s1">stlr</span><span class="s2">.</span><span class="s1">highlight_max</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">props</span><span class="s2">=</span><span class="s3">&quot;textbf:--rwrap;cellcolor:[rgb]{1,1,0.6}--rwrap&quot;</span><span class="s2">)</span>
    <span class="s1">stlr</span><span class="s2">.</span><span class="s1">highlight_max</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">props</span><span class="s2">=</span><span class="s3">&quot;Huge:--wrap;&quot;</span><span class="s2">, </span><span class="s1">subset</span><span class="s2">=[(</span><span class="s3">&quot;Z&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;Z&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">)])</span>

    <span class="s1">expected </span><span class="s2">= (</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
\\</span><span class="s3">begin{table}[h!] 
</span><span class="s0">\\</span><span class="s3">centering 
</span><span class="s0">\\</span><span class="s3">caption{mycap} 
</span><span class="s0">\\</span><span class="s3">label{fig:item} 
</span><span class="s0">\\</span><span class="s3">rowcolors{3}{pink}{} 
</span><span class="s0">\\</span><span class="s3">begin{tabular}{rlrlr} 
</span><span class="s0">\\</span><span class="s3">toprule 
 &amp;  &amp; </span><span class="s0">\\</span><span class="s3">multicolumn{2}{r}{Z} &amp; Y </span><span class="s0">\\\\</span>
 <span class="s3">&amp;  &amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
<span class="s0">\\</span><span class="s3">midrule 
</span><span class="s0">\\</span><span class="s3">multirow[c]{2}{*}{A} &amp; a &amp; 0 &amp; </span><span class="s0">\\</span><span class="s3">textbf{</span><span class="s0">\\</span><span class="s3">cellcolor[rgb]{1,1,0.6}{-0.61}} &amp; ab </span><span class="s0">\\\\</span>
 <span class="s3">&amp; b &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
<span class="s3">B &amp; c &amp; </span><span class="s0">\\</span><span class="s3">textbf{</span><span class="s0">\\</span><span class="s3">cellcolor[rgb]{1,1,0.6}{{</span><span class="s0">\\</span><span class="s3">Huge 2}}} &amp; -2.22 &amp; &quot;&quot;&quot;</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
\\</span><span class="s3">textbf{</span><span class="s0">\\</span><span class="s3">cellcolor[rgb]{1,1,0.6}{de}} </span><span class="s0">\\\\</span>
<span class="s0">\\</span><span class="s3">bottomrule 
</span><span class="s0">\\</span><span class="s3">end{tabular} 
</span><span class="s0">\\</span><span class="s3">end{table} 
&quot;&quot;&quot;</span>
    <span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">&quot;table&quot;</span><span class="s2">, </span><span class="s1">environment </span><span class="s0">if </span><span class="s1">environment </span><span class="s0">else </span><span class="s3">&quot;table&quot;</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">stlr</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s4">2</span><span class="s2">).</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">environment</span><span class="s2">=</span><span class="s1">environment</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_environment_option</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">&quot;styler.latex.environment&quot;</span><span class="s2">, </span><span class="s3">&quot;bar-env&quot;</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">begin{bar-env}&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">begin{foo-env}&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">environment</span><span class="s2">=</span><span class="s3">&quot;foo-env&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_parse_latex_table_styles</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">set_table_styles</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: [(</span><span class="s3">&quot;attr&quot;</span><span class="s2">, </span><span class="s3">&quot;value&quot;</span><span class="s2">)]},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: [(</span><span class="s3">&quot;attr&quot;</span><span class="s2">, </span><span class="s3">&quot;overwritten&quot;</span><span class="s2">)]},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: [(</span><span class="s3">&quot;attr&quot;</span><span class="s2">, </span><span class="s3">&quot;baz&quot;</span><span class="s2">), (</span><span class="s3">&quot;attr2&quot;</span><span class="s2">, </span><span class="s3">&quot;ignored&quot;</span><span class="s2">)]},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;label&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: [(</span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s3">&quot;{fig§item}&quot;</span><span class="s2">)]},</span>
        <span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_table_styles</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">.</span><span class="s1">table_styles</span><span class="s2">, </span><span class="s3">&quot;bar&quot;</span><span class="s2">) == </span><span class="s3">&quot;baz&quot;</span>

    <span class="s5"># test '§' replaced by ':' [for CSS compatibility]</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_table_styles</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">.</span><span class="s1">table_styles</span><span class="s2">, </span><span class="s3">&quot;label&quot;</span><span class="s2">) == </span><span class="s3">&quot;{fig:item}&quot;</span>


<span class="s0">def </span><span class="s1">test_parse_latex_cell_styles_basic</span><span class="s2">():  </span><span class="s5"># test nesting</span>
    <span class="s1">cell_style </span><span class="s2">= [(</span><span class="s3">&quot;itshape&quot;</span><span class="s2">, </span><span class="s3">&quot;--rwrap&quot;</span><span class="s2">), (</span><span class="s3">&quot;cellcolor&quot;</span><span class="s2">, </span><span class="s3">&quot;[rgb]{0,1,1}--rwrap&quot;</span><span class="s2">)]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">itshape{</span><span class="s0">\\</span><span class="s3">cellcolor[rgb]{0,1,1}{text}}&quot;</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_cell_styles</span><span class="s2">(</span><span class="s1">cell_style</span><span class="s2">, </span><span class="s3">&quot;text&quot;</span><span class="s2">) == </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;wrap_arg, expected&quot;</span><span class="s2">,</span>
    <span class="s2">[  </span><span class="s5"># test wrapping</span>
        <span class="s2">(</span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">&lt;command&gt;&lt;options&gt; &lt;display_value&gt;&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;--wrap&quot;</span><span class="s2">, </span><span class="s3">&quot;{</span><span class="s0">\\</span><span class="s3">&lt;command&gt;&lt;options&gt; &lt;display_value&gt;}&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;--nowrap&quot;</span><span class="s2">, </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">&lt;command&gt;&lt;options&gt; &lt;display_value&gt;&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;--lwrap&quot;</span><span class="s2">, </span><span class="s3">&quot;{</span><span class="s0">\\</span><span class="s3">&lt;command&gt;&lt;options&gt;} &lt;display_value&gt;&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;--dwrap&quot;</span><span class="s2">, </span><span class="s3">&quot;{</span><span class="s0">\\</span><span class="s3">&lt;command&gt;&lt;options&gt;}{&lt;display_value&gt;}&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;--rwrap&quot;</span><span class="s2">, </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">&lt;command&gt;&lt;options&gt;{&lt;display_value&gt;}&quot;</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_parse_latex_cell_styles_braces</span><span class="s2">(</span><span class="s1">wrap_arg</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s1">cell_style </span><span class="s2">= [(</span><span class="s3">&quot;&lt;command&gt;&quot;</span><span class="s2">, </span><span class="s3">f&quot;&lt;options&gt;</span><span class="s0">{</span><span class="s1">wrap_arg</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">)]</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_cell_styles</span><span class="s2">(</span><span class="s1">cell_style</span><span class="s2">, </span><span class="s3">&quot;&lt;display_value&gt;&quot;</span><span class="s2">) == </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_parse_latex_header_span</span><span class="s2">():</span>
    <span class="s1">cell </span><span class="s2">= {</span><span class="s3">&quot;attributes&quot;</span><span class="s2">: </span><span class="s3">'colspan=&quot;3&quot;'</span><span class="s2">, </span><span class="s3">&quot;display_value&quot;</span><span class="s2">: </span><span class="s3">&quot;text&quot;</span><span class="s2">, </span><span class="s3">&quot;cellstyle&quot;</span><span class="s2">: []}</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">multicolumn{3}{Y}{text}&quot;</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_header_span</span><span class="s2">(</span><span class="s1">cell</span><span class="s2">, </span><span class="s3">&quot;X&quot;</span><span class="s2">, </span><span class="s3">&quot;Y&quot;</span><span class="s2">) == </span><span class="s1">expected</span>

    <span class="s1">cell </span><span class="s2">= {</span><span class="s3">&quot;attributes&quot;</span><span class="s2">: </span><span class="s3">'rowspan=&quot;5&quot;'</span><span class="s2">, </span><span class="s3">&quot;display_value&quot;</span><span class="s2">: </span><span class="s3">&quot;text&quot;</span><span class="s2">, </span><span class="s3">&quot;cellstyle&quot;</span><span class="s2">: []}</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">multirow[X]{5}{*}{text}&quot;</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_header_span</span><span class="s2">(</span><span class="s1">cell</span><span class="s2">, </span><span class="s3">&quot;X&quot;</span><span class="s2">, </span><span class="s3">&quot;Y&quot;</span><span class="s2">) == </span><span class="s1">expected</span>

    <span class="s1">cell </span><span class="s2">= {</span><span class="s3">&quot;display_value&quot;</span><span class="s2">: </span><span class="s3">&quot;text&quot;</span><span class="s2">, </span><span class="s3">&quot;cellstyle&quot;</span><span class="s2">: []}</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_header_span</span><span class="s2">(</span><span class="s1">cell</span><span class="s2">, </span><span class="s3">&quot;X&quot;</span><span class="s2">, </span><span class="s3">&quot;Y&quot;</span><span class="s2">) == </span><span class="s3">&quot;text&quot;</span>

    <span class="s1">cell </span><span class="s2">= {</span><span class="s3">&quot;display_value&quot;</span><span class="s2">: </span><span class="s3">&quot;text&quot;</span><span class="s2">, </span><span class="s3">&quot;cellstyle&quot;</span><span class="s2">: [(</span><span class="s3">&quot;bfseries&quot;</span><span class="s2">, </span><span class="s3">&quot;--rwrap&quot;</span><span class="s2">)]}</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_header_span</span><span class="s2">(</span><span class="s1">cell</span><span class="s2">, </span><span class="s3">&quot;X&quot;</span><span class="s2">, </span><span class="s3">&quot;Y&quot;</span><span class="s2">) == </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">bfseries{text}&quot;</span>


<span class="s0">def </span><span class="s1">test_parse_latex_table_wrapping</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">set_table_styles</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;toprule&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:value&quot;</span><span class="s2">},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;bottomrule&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:value&quot;</span><span class="s2">},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;midrule&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:value&quot;</span><span class="s2">},</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;column_format&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:value&quot;</span><span class="s2">},</span>
        <span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_table_wrapping</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">.</span><span class="s1">table_styles</span><span class="s2">, </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">caption</span><span class="s2">) </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_table_wrapping</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">.</span><span class="s1">table_styles</span><span class="s2">, </span><span class="s3">&quot;some caption&quot;</span><span class="s2">) </span><span class="s0">is True</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">set_table_styles</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s2">{</span><span class="s3">&quot;selector&quot;</span><span class="s2">: </span><span class="s3">&quot;not-ignored&quot;</span><span class="s2">, </span><span class="s3">&quot;props&quot;</span><span class="s2">: </span><span class="s3">&quot;:value&quot;</span><span class="s2">},</span>
        <span class="s2">],</span>
        <span class="s1">overwrite</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_table_wrapping</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">.</span><span class="s1">table_styles</span><span class="s2">, </span><span class="s0">None</span><span class="s2">) </span><span class="s0">is True</span>


<span class="s0">def </span><span class="s1">test_short_caption</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">caption</span><span class="s2">=(</span><span class="s3">&quot;full cap&quot;</span><span class="s2">, </span><span class="s3">&quot;short cap&quot;</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">caption[short cap]{full cap}&quot; </span><span class="s0">in </span><span class="s1">result</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;css, expected&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">([(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;red&quot;</span><span class="s2">)], [(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;{red}&quot;</span><span class="s2">)]),  </span><span class="s5"># test color and input format types</span>
        <span class="s2">(</span>
            <span class="s2">[(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;rgb(128, 128, 128 )&quot;</span><span class="s2">)],</span>
            <span class="s2">[(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;[rgb]{0.502, 0.502, 0.502}&quot;</span><span class="s2">)],</span>
        <span class="s2">),</span>
        <span class="s2">(</span>
            <span class="s2">[(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;rgb(128, 50%, 25% )&quot;</span><span class="s2">)],</span>
            <span class="s2">[(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;[rgb]{0.502, 0.500, 0.250}&quot;</span><span class="s2">)],</span>
        <span class="s2">),</span>
        <span class="s2">(</span>
            <span class="s2">[(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;rgba(128,128,128,1)&quot;</span><span class="s2">)],</span>
            <span class="s2">[(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;[rgb]{0.502, 0.502, 0.502}&quot;</span><span class="s2">)],</span>
        <span class="s2">),</span>
        <span class="s2">([(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;#FF00FF&quot;</span><span class="s2">)], [(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;[HTML]{FF00FF}&quot;</span><span class="s2">)]),</span>
        <span class="s2">([(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;#F0F&quot;</span><span class="s2">)], [(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;[HTML]{FF00FF}&quot;</span><span class="s2">)]),</span>
        <span class="s2">([(</span><span class="s3">&quot;font-weight&quot;</span><span class="s2">, </span><span class="s3">&quot;bold&quot;</span><span class="s2">)], [(</span><span class="s3">&quot;bfseries&quot;</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">)]),  </span><span class="s5"># test font-weight and types</span>
        <span class="s2">([(</span><span class="s3">&quot;font-weight&quot;</span><span class="s2">, </span><span class="s3">&quot;bolder&quot;</span><span class="s2">)], [(</span><span class="s3">&quot;bfseries&quot;</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">)]),</span>
        <span class="s2">([(</span><span class="s3">&quot;font-weight&quot;</span><span class="s2">, </span><span class="s3">&quot;normal&quot;</span><span class="s2">)], []),</span>
        <span class="s2">([(</span><span class="s3">&quot;background-color&quot;</span><span class="s2">, </span><span class="s3">&quot;red&quot;</span><span class="s2">)], [(</span><span class="s3">&quot;cellcolor&quot;</span><span class="s2">, </span><span class="s3">&quot;{red}--lwrap&quot;</span><span class="s2">)]),</span>
        <span class="s2">(</span>
            <span class="s2">[(</span><span class="s3">&quot;background-color&quot;</span><span class="s2">, </span><span class="s3">&quot;#FF00FF&quot;</span><span class="s2">)],  </span><span class="s5"># test background-color command and wrap</span>
            <span class="s2">[(</span><span class="s3">&quot;cellcolor&quot;</span><span class="s2">, </span><span class="s3">&quot;[HTML]{FF00FF}--lwrap&quot;</span><span class="s2">)],</span>
        <span class="s2">),</span>
        <span class="s2">([(</span><span class="s3">&quot;font-style&quot;</span><span class="s2">, </span><span class="s3">&quot;italic&quot;</span><span class="s2">)], [(</span><span class="s3">&quot;itshape&quot;</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">)]),  </span><span class="s5"># test font-style and types</span>
        <span class="s2">([(</span><span class="s3">&quot;font-style&quot;</span><span class="s2">, </span><span class="s3">&quot;oblique&quot;</span><span class="s2">)], [(</span><span class="s3">&quot;slshape&quot;</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">)]),</span>
        <span class="s2">([(</span><span class="s3">&quot;font-style&quot;</span><span class="s2">, </span><span class="s3">&quot;normal&quot;</span><span class="s2">)], []),</span>
        <span class="s2">([(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;red /*--dwrap*/&quot;</span><span class="s2">)], [(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">&quot;{red}--dwrap&quot;</span><span class="s2">)]),  </span><span class="s5"># css comments</span>
        <span class="s2">([(</span><span class="s3">&quot;background-color&quot;</span><span class="s2">, </span><span class="s3">&quot;red /* --dwrap */&quot;</span><span class="s2">)], [(</span><span class="s3">&quot;cellcolor&quot;</span><span class="s2">, </span><span class="s3">&quot;{red}--dwrap&quot;</span><span class="s2">)]),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_parse_latex_css_conversion</span><span class="s2">(</span><span class="s1">css</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">_parse_latex_css_conversion</span><span class="s2">(</span><span class="s1">css</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;env, inner_env&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;tabular&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;table&quot;</span><span class="s2">, </span><span class="s3">&quot;tabular&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;longtable&quot;</span><span class="s2">, </span><span class="s3">&quot;longtable&quot;</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;convert, exp&quot;</span><span class="s2">, [(</span><span class="s0">True</span><span class="s2">, </span><span class="s3">&quot;bfseries&quot;</span><span class="s2">), (</span><span class="s0">False</span><span class="s2">, </span><span class="s3">&quot;font-weightbold&quot;</span><span class="s2">)]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_parse_latex_css_convert_minimal</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">, </span><span class="s1">env</span><span class="s2">, </span><span class="s1">inner_env</span><span class="s2">, </span><span class="s1">convert</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">):</span>
    <span class="s5"># parameters ensure longtable template is also tested</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">highlight_max</span><span class="s2">(</span><span class="s1">props</span><span class="s2">=</span><span class="s3">&quot;font-weight:bold;&quot;</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">convert_css</span><span class="s2">=</span><span class="s1">convert</span><span class="s2">, </span><span class="s1">environment</span><span class="s2">=</span><span class="s1">env</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">f&quot;&quot;&quot;</span><span class="s0">\ 
        </span><span class="s3">0 &amp; 0 &amp; </span><span class="s0">\\{</span><span class="s1">exp</span><span class="s0">} </span><span class="s3">-0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">1 &amp; </span><span class="s0">\\{</span><span class="s1">exp</span><span class="s0">} </span><span class="s3">1 &amp; -1.22 &amp; </span><span class="s0">\\{</span><span class="s1">exp</span><span class="s0">} </span><span class="s3">cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end</span><span class="s0">{{{</span><span class="s1">inner_env</span><span class="s0">}}}</span>
    <span class="s3">&quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">test_parse_latex_css_conversion_option</span><span class="s2">():</span>
    <span class="s1">css </span><span class="s2">= [(</span><span class="s3">&quot;command&quot;</span><span class="s2">, </span><span class="s3">&quot;option--latex--wrap&quot;</span><span class="s2">)]</span>
    <span class="s1">expected </span><span class="s2">= [(</span><span class="s3">&quot;command&quot;</span><span class="s2">, </span><span class="s3">&quot;option--wrap&quot;</span><span class="s2">)]</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">_parse_latex_css_conversion</span><span class="s2">(</span><span class="s1">css</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_styler_object_after_render</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s5"># GH 42320</span>
    <span class="s1">pre_render </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">_copy</span><span class="s2">(</span><span class="s1">deepcopy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span>
        <span class="s1">column_format</span><span class="s2">=</span><span class="s3">&quot;rllr&quot;</span><span class="s2">,</span>
        <span class="s1">position</span><span class="s2">=</span><span class="s3">&quot;h&quot;</span><span class="s2">,</span>
        <span class="s1">position_float</span><span class="s2">=</span><span class="s3">&quot;centering&quot;</span><span class="s2">,</span>
        <span class="s1">hrules</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
        <span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;my lab&quot;</span><span class="s2">,</span>
        <span class="s1">caption</span><span class="s2">=</span><span class="s3">&quot;my cap&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">pre_render</span><span class="s2">.</span><span class="s1">table_styles </span><span class="s2">== </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">table_styles</span>
    <span class="s0">assert </span><span class="s1">pre_render</span><span class="s2">.</span><span class="s1">caption </span><span class="s2">== </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">caption</span>


<span class="s0">def </span><span class="s1">test_longtable_comprehensive</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span>
        <span class="s1">environment</span><span class="s2">=</span><span class="s3">&quot;longtable&quot;</span><span class="s2">, </span><span class="s1">hrules</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;fig:A&quot;</span><span class="s2">, </span><span class="s1">caption</span><span class="s2">=(</span><span class="s3">&quot;full&quot;</span><span class="s2">, </span><span class="s3">&quot;short&quot;</span><span class="s2">)</span>
    <span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{longtable}{lrrl} 
        </span><span class="s0">\\</span><span class="s3">caption[short]{full} </span><span class="s0">\\</span><span class="s3">label{fig:A} </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">toprule 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">midrule 
        </span><span class="s0">\\</span><span class="s3">endfirsthead 
        </span><span class="s0">\\</span><span class="s3">caption[]{full} </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">toprule 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">midrule 
        </span><span class="s0">\\</span><span class="s3">endhead 
        </span><span class="s0">\\</span><span class="s3">midrule 
        </span><span class="s0">\\</span><span class="s3">multicolumn{4}{r}{Continued on next page} </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">midrule 
        </span><span class="s0">\\</span><span class="s3">endfoot 
        </span><span class="s0">\\</span><span class="s3">bottomrule 
        </span><span class="s0">\\</span><span class="s3">endlastfoot 
        0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{longtable} 
    &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_longtable_minimal</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">environment</span><span class="s2">=</span><span class="s3">&quot;longtable&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{longtable}{lrrl} 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">endfirsthead 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">endhead 
        </span><span class="s0">\\</span><span class="s3">multicolumn{4}{r}{Continued on next page} </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">endfoot 
        </span><span class="s0">\\</span><span class="s3">endlastfoot 
        0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s3">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{longtable} 
    &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;sparse, exp, siunitx&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s3">&quot;{} &amp; </span><span class="s0">\\</span><span class="s3">multicolumn{2}{r}{A} &amp; {B}&quot;</span><span class="s2">, </span><span class="s0">True</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s0">False</span><span class="s2">, </span><span class="s3">&quot;{} &amp; {A} &amp; {A} &amp; {B}&quot;</span><span class="s2">, </span><span class="s0">True</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s3">&quot; &amp; </span><span class="s0">\\</span><span class="s3">multicolumn{2}{r}{A} &amp; B&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s0">False</span><span class="s2">, </span><span class="s3">&quot; &amp; A &amp; A &amp; B&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_longtable_multiindex_columns</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">sparse</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">, </span><span class="s1">siunitx</span><span class="s2">):</span>
    <span class="s1">cidx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">df</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">cidx</span>
    <span class="s1">with_si </span><span class="s2">= </span><span class="s3">&quot;{} &amp; {a} &amp; {b} &amp; {c} </span><span class="s0">\\\\</span><span class="s3">&quot;</span>
    <span class="s1">without_si </span><span class="s2">= </span><span class="s3">&quot; &amp; a &amp; b &amp; c </span><span class="s0">\\\\</span><span class="s3">&quot;</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">f&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin</span><span class="s0">{{</span><span class="s3">longtable</span><span class="s0">}}{{</span><span class="s3">l</span><span class="s0">{</span><span class="s3">&quot;SS&quot; </span><span class="s0">if </span><span class="s1">siunitx </span><span class="s0">else </span><span class="s3">&quot;rr&quot;</span><span class="s0">}</span><span class="s3">l</span><span class="s0">}}</span>
        <span class="s0">{</span><span class="s1">exp</span><span class="s0">} \\\\</span>
        <span class="s0">{</span><span class="s1">with_si </span><span class="s0">if </span><span class="s1">siunitx </span><span class="s0">else </span><span class="s1">without_si</span><span class="s0">}</span>
        <span class="s0">\\</span><span class="s3">endfirsthead</span>
        <span class="s0">{</span><span class="s1">exp</span><span class="s0">} \\\\</span>
        <span class="s0">{</span><span class="s1">with_si </span><span class="s0">if </span><span class="s1">siunitx </span><span class="s0">else </span><span class="s1">without_si</span><span class="s0">}</span>
        <span class="s0">\\</span><span class="s3">endhead</span>
        <span class="s3">&quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span>
        <span class="s1">environment</span><span class="s2">=</span><span class="s3">&quot;longtable&quot;</span><span class="s2">, </span><span class="s1">sparse_columns</span><span class="s2">=</span><span class="s1">sparse</span><span class="s2">, </span><span class="s1">siunitx</span><span class="s2">=</span><span class="s1">siunitx</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">result</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;caption, cap_exp&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s3">&quot;full&quot;</span><span class="s2">, (</span><span class="s3">&quot;{full}&quot;</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">)),</span>
        <span class="s2">((</span><span class="s3">&quot;full&quot;</span><span class="s2">, </span><span class="s3">&quot;short&quot;</span><span class="s2">), (</span><span class="s3">&quot;{full}&quot;</span><span class="s2">, </span><span class="s3">&quot;[short]&quot;</span><span class="s2">)),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;label, lab_exp&quot;</span><span class="s2">, [(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">), (</span><span class="s3">&quot;tab:A&quot;</span><span class="s2">, </span><span class="s3">&quot; </span><span class="s0">\\</span><span class="s3">label{tab:A}&quot;</span><span class="s2">)])</span>
<span class="s0">def </span><span class="s1">test_longtable_caption_label</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">, </span><span class="s1">caption</span><span class="s2">, </span><span class="s1">cap_exp</span><span class="s2">, </span><span class="s1">label</span><span class="s2">, </span><span class="s1">lab_exp</span><span class="s2">):</span>
    <span class="s1">cap_exp1 </span><span class="s2">= </span><span class="s3">f&quot;</span><span class="s0">\\</span><span class="s3">caption</span><span class="s0">{</span><span class="s1">cap_exp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]</span><span class="s0">}{</span><span class="s1">cap_exp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span><span class="s0">}</span><span class="s3">&quot;</span>
    <span class="s1">cap_exp2 </span><span class="s2">= </span><span class="s3">f&quot;</span><span class="s0">\\</span><span class="s3">caption[]</span><span class="s0">{</span><span class="s1">cap_exp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span><span class="s0">}</span><span class="s3">&quot;</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">f&quot;&quot;&quot;</span><span class="s0">\ 
        {</span><span class="s1">cap_exp1</span><span class="s0">}{</span><span class="s1">lab_exp</span><span class="s0">} \\\\</span>
         <span class="s3">&amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">endfirsthead</span>
        <span class="s0">{</span><span class="s1">cap_exp2</span><span class="s0">} \\\\</span>
        <span class="s3">&quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span>
        <span class="s1">environment</span><span class="s2">=</span><span class="s3">&quot;longtable&quot;</span><span class="s2">, </span><span class="s1">caption</span><span class="s2">=</span><span class="s1">caption</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">label</span>
    <span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;index&quot;</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;columns, siunitx&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_apply_map_header_render_mi</span><span class="s2">(</span><span class="s1">df_ext</span><span class="s2">, </span><span class="s1">index</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">, </span><span class="s1">siunitx</span><span class="s2">):</span>
    <span class="s1">cidx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;Z&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;Z&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;Y&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">ridx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">), (</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">)])</span>
    <span class="s1">df_ext</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">df_ext</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">ridx</span><span class="s2">, </span><span class="s1">cidx</span>
    <span class="s1">styler </span><span class="s2">= </span><span class="s1">df_ext</span><span class="s2">.</span><span class="s1">style</span>

    <span class="s1">func </span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">v</span><span class="s2">: </span><span class="s3">&quot;bfseries: --rwrap&quot; </span><span class="s0">if </span><span class="s3">&quot;A&quot; </span><span class="s0">in </span><span class="s1">v </span><span class="s0">or </span><span class="s3">&quot;Z&quot; </span><span class="s0">in </span><span class="s1">v </span><span class="s0">or </span><span class="s3">&quot;c&quot; </span><span class="s0">in </span><span class="s1">v </span><span class="s0">else None</span>

    <span class="s0">if </span><span class="s1">index</span><span class="s2">:</span>
        <span class="s1">styler</span><span class="s2">.</span><span class="s1">map_index</span><span class="s2">(</span><span class="s1">func</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s3">&quot;index&quot;</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">columns</span><span class="s2">:</span>
        <span class="s1">styler</span><span class="s2">.</span><span class="s1">map_index</span><span class="s2">(</span><span class="s1">func</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s3">&quot;columns&quot;</span><span class="s2">)</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">siunitx</span><span class="s2">=</span><span class="s1">siunitx</span><span class="s2">)</span>

    <span class="s1">expected_index </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
    \\</span><span class="s3">multirow[c]{2}{*}{</span><span class="s0">\\</span><span class="s3">bfseries{A}} &amp; a &amp; 0 &amp; -0.610000 &amp; ab </span><span class="s0">\\\\</span>
    <span class="s0">\\</span><span class="s3">bfseries{} &amp; b &amp; 1 &amp; -1.220000 &amp; cd </span><span class="s0">\\\\</span>
    <span class="s3">B &amp; </span><span class="s0">\\</span><span class="s3">bfseries{c} &amp; 2 &amp; -2.220000 &amp; de </span><span class="s0">\\\\</span>
    <span class="s3">&quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">expected_index </span><span class="s0">in </span><span class="s1">result</span><span class="s2">) </span><span class="s0">is </span><span class="s1">index</span>

    <span class="s1">exp_cols_si </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
    </span><span class="s3">{} &amp; {} &amp; </span><span class="s0">\\</span><span class="s3">multicolumn{2}{r}{</span><span class="s0">\\</span><span class="s3">bfseries{Z}} &amp; {Y} </span><span class="s0">\\\\</span>
    <span class="s3">{} &amp; {} &amp; {a} &amp; {b} &amp; {</span><span class="s0">\\</span><span class="s3">bfseries{c}} </span><span class="s0">\\\\</span>
    <span class="s3">&quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s1">exp_cols_no_si </span><span class="s2">= </span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
 </span><span class="s3">&amp;  &amp; </span><span class="s0">\\</span><span class="s3">multicolumn{2}{r}{</span><span class="s0">\\</span><span class="s3">bfseries{Z}} &amp; Y </span><span class="s0">\\\\</span>
 <span class="s3">&amp;  &amp; a &amp; b &amp; </span><span class="s0">\\</span><span class="s3">bfseries{c} </span><span class="s0">\\\\</span>
<span class="s3">&quot;&quot;&quot;</span>
    <span class="s0">assert </span><span class="s2">((</span><span class="s1">exp_cols_si </span><span class="s0">if </span><span class="s1">siunitx </span><span class="s0">else </span><span class="s1">exp_cols_no_si</span><span class="s2">) </span><span class="s0">in </span><span class="s1">result</span><span class="s2">) </span><span class="s0">is </span><span class="s1">columns</span>


<span class="s0">def </span><span class="s1">test_repr_option</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s0">assert </span><span class="s3">&quot;&lt;style&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">_repr_html_</span><span class="s2">()[:</span><span class="s4">6</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">_repr_latex_</span><span class="s2">() </span><span class="s0">is None</span>
    <span class="s0">with </span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">&quot;styler.render.repr&quot;</span><span class="s2">, </span><span class="s3">&quot;latex&quot;</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">begin{tabular}&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">_repr_latex_</span><span class="s2">()[:</span><span class="s4">15</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">_repr_html_</span><span class="s2">() </span><span class="s0">is None</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;option&quot;</span><span class="s2">, [</span><span class="s3">&quot;hrules&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_bool_options</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">, </span><span class="s1">option</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">f&quot;styler.latex.</span><span class="s0">{</span><span class="s1">option</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">):</span>
        <span class="s1">latex_false </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">f&quot;styler.latex.</span><span class="s0">{</span><span class="s1">option</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s0">True</span><span class="s2">):</span>
        <span class="s1">latex_true </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">latex_false </span><span class="s2">!= </span><span class="s1">latex_true  </span><span class="s5"># options are reactive under to_latex(*no_args)</span>


<span class="s0">def </span><span class="s1">test_siunitx_basic_headers</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s0">assert </span><span class="s3">&quot;{} &amp; {A} &amp; {B} &amp; {C} </span><span class="s0">\\\\</span><span class="s3">&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">siunitx</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s3">&quot; &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span><span class="s3">&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()  </span><span class="s5"># default siunitx=False</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;axis&quot;</span><span class="s2">, [</span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s3">&quot;columns&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_css_convert_apply_index</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">):</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">map_index</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s3">&quot;font-weight: bold;&quot;</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s1">axis</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">label </span><span class="s0">in </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s3">f&quot;</span><span class="s0">\\</span><span class="s3">bfseries </span><span class="s0">{</span><span class="s1">label</span><span class="s0">}</span><span class="s3">&quot; </span><span class="s0">in </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">convert_css</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hide_index_latex</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s5"># GH 43637</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">([</span><span class="s4">0</span><span class="s2">], </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
    \\</span><span class="s3">begin{tabular}{lrrl} 
     &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
    <span class="s3">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
    <span class="s0">\\</span><span class="s3">end{tabular} 
    &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s2">== </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">test_latex_hiding_index_columns_multiindex_alignment</span><span class="s2">():</span>
    <span class="s5"># gh 43644</span>
    <span class="s1">midx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">(</span>
        <span class="s2">[[</span><span class="s3">&quot;i0&quot;</span><span class="s2">, </span><span class="s3">&quot;j0&quot;</span><span class="s2">], [</span><span class="s3">&quot;i1&quot;</span><span class="s2">], [</span><span class="s3">&quot;i2&quot;</span><span class="s2">, </span><span class="s3">&quot;j2&quot;</span><span class="s2">]], </span><span class="s1">names</span><span class="s2">=[</span><span class="s3">&quot;i-0&quot;</span><span class="s2">, </span><span class="s3">&quot;i-1&quot;</span><span class="s2">, </span><span class="s3">&quot;i-2&quot;</span><span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s1">cidx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">(</span>
        <span class="s2">[[</span><span class="s3">&quot;c0&quot;</span><span class="s2">], [</span><span class="s3">&quot;c1&quot;</span><span class="s2">, </span><span class="s3">&quot;d1&quot;</span><span class="s2">], [</span><span class="s3">&quot;c2&quot;</span><span class="s2">, </span><span class="s3">&quot;d2&quot;</span><span class="s2">]], </span><span class="s1">names</span><span class="s2">=[</span><span class="s3">&quot;c-0&quot;</span><span class="s2">, </span><span class="s3">&quot;c-1&quot;</span><span class="s2">, </span><span class="s3">&quot;c-2&quot;</span><span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">16</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">midx</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=</span><span class="s1">cidx</span><span class="s2">)</span>
    <span class="s1">styler </span><span class="s2">= </span><span class="s1">Styler</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">uuid_len</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">(</span><span class="s1">level</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">).</span><span class="s1">hide</span><span class="s2">(</span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">([(</span><span class="s3">&quot;i0&quot;</span><span class="s2">, </span><span class="s3">&quot;i1&quot;</span><span class="s2">, </span><span class="s3">&quot;i2&quot;</span><span class="s2">)], </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">([(</span><span class="s3">&quot;c0&quot;</span><span class="s2">, </span><span class="s3">&quot;c1&quot;</span><span class="s2">, </span><span class="s3">&quot;c2&quot;</span><span class="s2">)], </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s3">&quot;color:{red};&quot; </span><span class="s0">if </span><span class="s1">x </span><span class="s2">== </span><span class="s4">5 </span><span class="s0">else </span><span class="s3">&quot;&quot;</span><span class="s2">)</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">map_index</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s3">&quot;color:{blue};&quot; </span><span class="s0">if </span><span class="s3">&quot;j&quot; </span><span class="s0">in </span><span class="s1">x </span><span class="s0">else </span><span class="s3">&quot;&quot;</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">()</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{llrrr} 
         &amp; c-1 &amp; c1 &amp; </span><span class="s0">\\</span><span class="s3">multicolumn{2}{r}{d1} </span><span class="s0">\\\\</span>
         <span class="s3">&amp; c-2 &amp; d2 &amp; c2 &amp; d2 </span><span class="s0">\\\\</span>
        <span class="s3">i-0 &amp; i-2 &amp;  &amp;  &amp;  </span><span class="s0">\\\\</span>
        <span class="s3">i0 &amp; </span><span class="s0">\\</span><span class="s3">color{blue} j2 &amp; </span><span class="s0">\\</span><span class="s3">color{red} 5 &amp; 6 &amp; 7 </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">multirow[c]{2}{*}{</span><span class="s0">\\</span><span class="s3">color{blue} j0} &amp; i2 &amp; 9 &amp; 10 &amp; 11 </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">color{blue}  &amp; </span><span class="s0">\\</span><span class="s3">color{blue} j2 &amp; 13 &amp; 14 &amp; 15 </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_rendered_links</span><span class="s2">():</span>
    <span class="s5"># note the majority of testing is done in test_html.py: test_rendered_links</span>
    <span class="s5"># these test only the alternative latex format is functional</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([</span><span class="s3">&quot;text www.domain.com text&quot;</span><span class="s2">])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">hyperlinks</span><span class="s2">=</span><span class="s3">&quot;latex&quot;</span><span class="s2">).</span><span class="s1">to_latex</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s3">r&quot;text \href{www.domain.com}{www.domain.com} text&quot; </span><span class="s0">in </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">test_apply_index_hidden_levels</span><span class="s2">():</span>
    <span class="s5"># gh 45156</span>
    <span class="s1">styler </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">[[</span><span class="s4">1</span><span class="s2">]],</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)], </span><span class="s1">names</span><span class="s2">=[</span><span class="s3">&quot;l0&quot;</span><span class="s2">, </span><span class="s3">&quot;l1&quot;</span><span class="s2">]),</span>
        <span class="s1">columns</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)], </span><span class="s1">names</span><span class="s2">=[</span><span class="s3">&quot;c0&quot;</span><span class="s2">, </span><span class="s3">&quot;c1&quot;</span><span class="s2">]),</span>
    <span class="s2">).</span><span class="s1">style</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">(</span><span class="s1">level</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">map_index</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">v</span><span class="s2">: </span><span class="s3">&quot;color: red;&quot;</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">convert_css</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s3">begin{tabular}{lr} 
        c0 &amp; </span><span class="s0">\\</span><span class="s3">color{red} 0 </span><span class="s0">\\\\</span>
        <span class="s3">c1 &amp; 1 </span><span class="s0">\\\\</span>
        <span class="s3">l0 &amp;  </span><span class="s0">\\\\</span>
        <span class="s3">0 &amp; 1 </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s3">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;clines&quot;</span><span class="s2">, [</span><span class="s3">&quot;bad&quot;</span><span class="s2">, </span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s3">&quot;skip-last&quot;</span><span class="s2">, </span><span class="s3">&quot;all&quot;</span><span class="s2">, </span><span class="s3">&quot;data&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_clines_validation</span><span class="s2">(</span><span class="s1">clines</span><span class="s2">, </span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s3">f&quot;`clines` value of </span><span class="s0">{</span><span class="s1">clines</span><span class="s0">} </span><span class="s3">is invalid.&quot;</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">clines</span><span class="s2">=</span><span class="s1">clines</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;clines, exp&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s3">&quot;all;index&quot;</span><span class="s2">, </span><span class="s3">&quot;</span><span class="s0">\n\\</span><span class="s3">cline{1-1}&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;all;data&quot;</span><span class="s2">, </span><span class="s3">&quot;</span><span class="s0">\n\\</span><span class="s3">cline{1-2}&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;skip-last;index&quot;</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;skip-last;data&quot;</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;env&quot;</span><span class="s2">, [</span><span class="s3">&quot;table&quot;</span><span class="s2">, </span><span class="s3">&quot;longtable&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_clines_index</span><span class="s2">(</span><span class="s1">clines</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">, </span><span class="s1">env</span><span class="s2">):</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">], [</span><span class="s4">3</span><span class="s2">], [</span><span class="s4">4</span><span class="s2">]])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">clines</span><span class="s2">=</span><span class="s1">clines</span><span class="s2">, </span><span class="s1">environment</span><span class="s2">=</span><span class="s1">env</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s3">f&quot;&quot;&quot;</span><span class="s0">\ 
</span><span class="s3">0 &amp; 1 </span><span class="s0">\\\\{</span><span class="s1">exp</span><span class="s0">}</span>
<span class="s3">1 &amp; 2 </span><span class="s0">\\\\{</span><span class="s1">exp</span><span class="s0">}</span>
<span class="s3">2 &amp; 3 </span><span class="s0">\\\\{</span><span class="s1">exp</span><span class="s0">}</span>
<span class="s3">3 &amp; 4 </span><span class="s0">\\\\{</span><span class="s1">exp</span><span class="s0">}</span>
<span class="s3">&quot;&quot;&quot;</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">result</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;clines, expected&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span>
            <span class="s0">None</span><span class="s2">,</span>
            <span class="s1">dedent</span><span class="s2">(</span>
                <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            \\</span><span class="s3">multirow[c]{2}{*}{A} &amp; X &amp; 1 </span><span class="s0">\\\\</span>
             <span class="s3">&amp; Y &amp; 2 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">multirow[c]{2}{*}{B} &amp; X &amp; 3 </span><span class="s0">\\\\</span>
             <span class="s3">&amp; Y &amp; 4 </span><span class="s0">\\\\</span>
            <span class="s3">&quot;&quot;&quot;</span>
            <span class="s2">),</span>
        <span class="s2">),</span>
        <span class="s2">(</span>
            <span class="s3">&quot;skip-last;index&quot;</span><span class="s2">,</span>
            <span class="s1">dedent</span><span class="s2">(</span>
                <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            \\</span><span class="s3">multirow[c]{2}{*}{A} &amp; X &amp; 1 </span><span class="s0">\\\\</span>
             <span class="s3">&amp; Y &amp; 2 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">cline{1-2} 
            </span><span class="s0">\\</span><span class="s3">multirow[c]{2}{*}{B} &amp; X &amp; 3 </span><span class="s0">\\\\</span>
             <span class="s3">&amp; Y &amp; 4 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">cline{1-2} 
            &quot;&quot;&quot;</span>
            <span class="s2">),</span>
        <span class="s2">),</span>
        <span class="s2">(</span>
            <span class="s3">&quot;skip-last;data&quot;</span><span class="s2">,</span>
            <span class="s1">dedent</span><span class="s2">(</span>
                <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            \\</span><span class="s3">multirow[c]{2}{*}{A} &amp; X &amp; 1 </span><span class="s0">\\\\</span>
             <span class="s3">&amp; Y &amp; 2 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">cline{1-3} 
            </span><span class="s0">\\</span><span class="s3">multirow[c]{2}{*}{B} &amp; X &amp; 3 </span><span class="s0">\\\\</span>
             <span class="s3">&amp; Y &amp; 4 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">cline{1-3} 
            &quot;&quot;&quot;</span>
            <span class="s2">),</span>
        <span class="s2">),</span>
        <span class="s2">(</span>
            <span class="s3">&quot;all;index&quot;</span><span class="s2">,</span>
            <span class="s1">dedent</span><span class="s2">(</span>
                <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            \\</span><span class="s3">multirow[c]{2}{*}{A} &amp; X &amp; 1 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">cline{2-2} 
             &amp; Y &amp; 2 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">cline{1-2} </span><span class="s0">\\</span><span class="s3">cline{2-2} 
            </span><span class="s0">\\</span><span class="s3">multirow[c]{2}{*}{B} &amp; X &amp; 3 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">cline{2-2} 
             &amp; Y &amp; 4 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">cline{1-2} </span><span class="s0">\\</span><span class="s3">cline{2-2} 
            &quot;&quot;&quot;</span>
            <span class="s2">),</span>
        <span class="s2">),</span>
        <span class="s2">(</span>
            <span class="s3">&quot;all;data&quot;</span><span class="s2">,</span>
            <span class="s1">dedent</span><span class="s2">(</span>
                <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            \\</span><span class="s3">multirow[c]{2}{*}{A} &amp; X &amp; 1 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">cline{2-3} 
             &amp; Y &amp; 2 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">cline{1-3} </span><span class="s0">\\</span><span class="s3">cline{2-3} 
            </span><span class="s0">\\</span><span class="s3">multirow[c]{2}{*}{B} &amp; X &amp; 3 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">cline{2-3} 
             &amp; Y &amp; 4 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">cline{1-3} </span><span class="s0">\\</span><span class="s3">cline{2-3} 
            &quot;&quot;&quot;</span>
            <span class="s2">),</span>
        <span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;env&quot;</span><span class="s2">, [</span><span class="s3">&quot;table&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_clines_multiindex</span><span class="s2">(</span><span class="s1">clines</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">env</span><span class="s2">):</span>
    <span class="s5"># also tests simultaneously with hidden rows and a hidden multiindex level</span>
    <span class="s1">midx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;-&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">], [</span><span class="s3">&quot;X&quot;</span><span class="s2">, </span><span class="s3">&quot;Y&quot;</span><span class="s2">]])</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">], [</span><span class="s4">99</span><span class="s2">], [</span><span class="s4">99</span><span class="s2">], [</span><span class="s4">3</span><span class="s2">], [</span><span class="s4">4</span><span class="s2">]], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">midx</span><span class="s2">)</span>
    <span class="s1">styler </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">style</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">([(</span><span class="s3">&quot;-&quot;</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s3">&quot;X&quot;</span><span class="s2">), (</span><span class="s3">&quot;-&quot;</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s3">&quot;Y&quot;</span><span class="s2">)])</span>
    <span class="s1">styler</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">(</span><span class="s1">level</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">clines</span><span class="s2">=</span><span class="s1">clines</span><span class="s2">, </span><span class="s1">environment</span><span class="s2">=</span><span class="s1">env</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">test_col_format_len</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s5"># gh 46037</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">environment</span><span class="s2">=</span><span class="s3">&quot;longtable&quot;</span><span class="s2">, </span><span class="s1">column_format</span><span class="s2">=</span><span class="s3">&quot;lrr{10cm}&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s3">r&quot;\multicolumn{4}{r}{Continued on next page} \\&quot;</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">test_concat</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">):</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">styler</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">agg</span><span class="s2">([</span><span class="s3">&quot;sum&quot;</span><span class="s2">]).</span><span class="s1">style</span><span class="s2">).</span><span class="s1">to_latex</span><span class="s2">()</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
    \\</span><span class="s3">begin{tabular}{lrrl} 
     &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
    <span class="s3">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
    <span class="s3">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
    <span class="s3">sum &amp; 1 &amp; -1.830000 &amp; abcd </span><span class="s0">\\\\</span>
    <span class="s0">\\</span><span class="s3">end{tabular} 
    &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_concat_recursion</span><span class="s2">():</span>
    <span class="s5"># tests hidden row recursion and applied styles</span>
    <span class="s1">styler1 </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">], [</span><span class="s4">9</span><span class="s2">]]).</span><span class="s1">style</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">([</span><span class="s4">1</span><span class="s2">]).</span><span class="s1">highlight_min</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">&quot;red&quot;</span><span class="s2">)</span>
    <span class="s1">styler2 </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s4">9</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">]]).</span><span class="s1">style</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">([</span><span class="s4">0</span><span class="s2">]).</span><span class="s1">highlight_min</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">&quot;green&quot;</span><span class="s2">)</span>
    <span class="s1">styler3 </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s4">3</span><span class="s2">], [</span><span class="s4">9</span><span class="s2">]]).</span><span class="s1">style</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">([</span><span class="s4">1</span><span class="s2">]).</span><span class="s1">highlight_min</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">&quot;blue&quot;</span><span class="s2">)</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler1</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">styler2</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">styler3</span><span class="s2">)).</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">convert_css</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
    \\</span><span class="s3">begin{tabular}{lr} 
     &amp; 0 </span><span class="s0">\\\\</span>
    <span class="s3">0 &amp; {</span><span class="s0">\\</span><span class="s3">cellcolor{red}} 1 </span><span class="s0">\\\\</span>
    <span class="s3">1 &amp; {</span><span class="s0">\\</span><span class="s3">cellcolor{green}} 2 </span><span class="s0">\\\\</span>
    <span class="s3">0 &amp; {</span><span class="s0">\\</span><span class="s3">cellcolor{blue}} 3 </span><span class="s0">\\\\</span>
    <span class="s0">\\</span><span class="s3">end{tabular} 
    &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_concat_chain</span><span class="s2">():</span>
    <span class="s5"># tests hidden row recursion and applied styles</span>
    <span class="s1">styler1 </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">], [</span><span class="s4">9</span><span class="s2">]]).</span><span class="s1">style</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">([</span><span class="s4">1</span><span class="s2">]).</span><span class="s1">highlight_min</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">&quot;red&quot;</span><span class="s2">)</span>
    <span class="s1">styler2 </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s4">9</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">]]).</span><span class="s1">style</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">([</span><span class="s4">0</span><span class="s2">]).</span><span class="s1">highlight_min</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">&quot;green&quot;</span><span class="s2">)</span>
    <span class="s1">styler3 </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s4">3</span><span class="s2">], [</span><span class="s4">9</span><span class="s2">]]).</span><span class="s1">style</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">([</span><span class="s4">1</span><span class="s2">]).</span><span class="s1">highlight_min</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s3">&quot;blue&quot;</span><span class="s2">)</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">styler1</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">styler2</span><span class="s2">).</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">styler3</span><span class="s2">).</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">convert_css</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
    \\</span><span class="s3">begin{tabular}{lr} 
     &amp; 0 </span><span class="s0">\\\\</span>
    <span class="s3">0 &amp; {</span><span class="s0">\\</span><span class="s3">cellcolor{red}} 1 </span><span class="s0">\\\\</span>
    <span class="s3">1 &amp; {</span><span class="s0">\\</span><span class="s3">cellcolor{green}} 2 </span><span class="s0">\\\\</span>
    <span class="s3">0 &amp; {</span><span class="s0">\\</span><span class="s3">cellcolor{blue}} 3 </span><span class="s0">\\\\</span>
    <span class="s0">\\</span><span class="s3">end{tabular} 
    &quot;&quot;&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;df, expected&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span>
            <span class="s1">DataFrame</span><span class="s2">(),</span>
            <span class="s1">dedent</span><span class="s2">(</span>
                <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            \\</span><span class="s3">begin{tabular}{l} 
            </span><span class="s0">\\</span><span class="s3">end{tabular} 
            &quot;&quot;&quot;</span>
            <span class="s2">),</span>
        <span class="s2">),</span>
        <span class="s2">(</span>
            <span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">]),</span>
            <span class="s1">dedent</span><span class="s2">(</span>
                <span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            \\</span><span class="s3">begin{tabular}{llll} 
             &amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s3">end{tabular} 
            &quot;&quot;&quot;</span>
            <span class="s2">),</span>
        <span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;clines&quot;</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;all;data&quot;</span><span class="s2">, </span><span class="s3">&quot;all;index&quot;</span><span class="s2">, </span><span class="s3">&quot;skip-last;data&quot;</span><span class="s2">, </span><span class="s3">&quot;skip-last;index&quot;</span><span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_empty_clines</span><span class="s2">(</span><span class="s1">df</span><span class="s2">: </span><span class="s1">DataFrame</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">clines</span><span class="s2">: </span><span class="s1">str</span><span class="s2">):</span>
    <span class="s5"># GH 47203</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">to_latex</span><span class="s2">(</span><span class="s1">clines</span><span class="s2">=</span><span class="s1">clines</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>
</pre>
</body>
</html>