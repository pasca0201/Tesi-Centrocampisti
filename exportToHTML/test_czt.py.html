<html>
<head>
<title>test_czt.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #2aacb8;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_czt.py</font>
</center></td></tr></table>
<pre><span class="s0"># This program is public domain</span>
<span class="s0"># Authors: Paul Kienzle, Nadav Horesh</span>
<span class="s2">''' 
A unit test module for czt.py 
'''</span>
<span class="s3">import </span><span class="s1">pytest</span>
<span class="s3">from </span><span class="s1">numpy</span><span class="s4">.</span><span class="s1">testing </span><span class="s3">import </span><span class="s1">assert_allclose</span>
<span class="s3">from </span><span class="s1">scipy</span><span class="s4">.</span><span class="s1">fft </span><span class="s3">import </span><span class="s1">fft</span>
<span class="s3">from </span><span class="s1">scipy</span><span class="s4">.</span><span class="s1">signal </span><span class="s3">import </span><span class="s4">(</span><span class="s1">czt</span><span class="s4">, </span><span class="s1">zoom_fft</span><span class="s4">, </span><span class="s1">czt_points</span><span class="s4">, </span><span class="s1">CZT</span><span class="s4">, </span><span class="s1">ZoomFFT</span><span class="s4">)</span>
<span class="s3">import </span><span class="s1">numpy </span><span class="s3">as </span><span class="s1">np</span>


<span class="s3">def </span><span class="s1">check_czt</span><span class="s4">(</span><span class="s1">x</span><span class="s4">):</span>
    <span class="s0"># Check that czt is the equivalent of normal fft</span>
    <span class="s1">y </span><span class="s4">= </span><span class="s1">fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>
    <span class="s1">y1 </span><span class="s4">= </span><span class="s1">czt</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">y1</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-13</span><span class="s4">)</span>

    <span class="s0"># Check that interpolated czt is the equivalent of normal fft</span>
    <span class="s1">y </span><span class="s4">= </span><span class="s1">fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, </span><span class="s5">100</span><span class="s4">*</span><span class="s1">len</span><span class="s4">(</span><span class="s1">x</span><span class="s4">))</span>
    <span class="s1">y1 </span><span class="s4">= </span><span class="s1">czt</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, </span><span class="s5">100</span><span class="s4">*</span><span class="s1">len</span><span class="s4">(</span><span class="s1">x</span><span class="s4">))</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">y1</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-12</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">):</span>
    <span class="s0"># Check that zoom_fft is the equivalent of normal fft</span>
    <span class="s1">y </span><span class="s4">= </span><span class="s1">fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>
    <span class="s1">y1 </span><span class="s4">= </span><span class="s1">zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, [</span><span class="s5">0</span><span class="s4">, </span><span class="s5">2</span><span class="s4">-</span><span class="s5">2.</span><span class="s4">/</span><span class="s1">len</span><span class="s4">(</span><span class="s1">y</span><span class="s4">)], </span><span class="s1">endpoint</span><span class="s4">=</span><span class="s3">True</span><span class="s4">)</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">y1</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-11</span><span class="s4">, </span><span class="s1">atol</span><span class="s4">=</span><span class="s5">1e-14</span><span class="s4">)</span>
    <span class="s1">y1 </span><span class="s4">= </span><span class="s1">zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, [</span><span class="s5">0</span><span class="s4">, </span><span class="s5">2</span><span class="s4">])</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">y1</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-11</span><span class="s4">, </span><span class="s1">atol</span><span class="s4">=</span><span class="s5">1e-14</span><span class="s4">)</span>

    <span class="s0"># Test fn scalar</span>
    <span class="s1">y1 </span><span class="s4">= </span><span class="s1">zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, </span><span class="s5">2</span><span class="s4">-</span><span class="s5">2.</span><span class="s4">/</span><span class="s1">len</span><span class="s4">(</span><span class="s1">y</span><span class="s4">), </span><span class="s1">endpoint</span><span class="s4">=</span><span class="s3">True</span><span class="s4">)</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">y1</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-11</span><span class="s4">, </span><span class="s1">atol</span><span class="s4">=</span><span class="s5">1e-14</span><span class="s4">)</span>
    <span class="s1">y1 </span><span class="s4">= </span><span class="s1">zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, </span><span class="s5">2</span><span class="s4">)</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">y1</span><span class="s4">, </span><span class="s1">y</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-11</span><span class="s4">, </span><span class="s1">atol</span><span class="s4">=</span><span class="s5">1e-14</span><span class="s4">)</span>

    <span class="s0"># Check that zoom_fft with oversampling is equivalent to zero padding</span>
    <span class="s1">over </span><span class="s4">= </span><span class="s5">10</span>
    <span class="s1">yover </span><span class="s4">= </span><span class="s1">fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, </span><span class="s1">over</span><span class="s4">*</span><span class="s1">len</span><span class="s4">(</span><span class="s1">x</span><span class="s4">))</span>
    <span class="s1">y2 </span><span class="s4">= </span><span class="s1">zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, [</span><span class="s5">0</span><span class="s4">, </span><span class="s5">2</span><span class="s4">-</span><span class="s5">2.</span><span class="s4">/</span><span class="s1">len</span><span class="s4">(</span><span class="s1">yover</span><span class="s4">)], </span><span class="s1">m</span><span class="s4">=</span><span class="s1">len</span><span class="s4">(</span><span class="s1">yover</span><span class="s4">), </span><span class="s1">endpoint</span><span class="s4">=</span><span class="s3">True</span><span class="s4">)</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">y2</span><span class="s4">, </span><span class="s1">yover</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-12</span><span class="s4">, </span><span class="s1">atol</span><span class="s4">=</span><span class="s5">1e-10</span><span class="s4">)</span>
    <span class="s1">y2 </span><span class="s4">= </span><span class="s1">zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, [</span><span class="s5">0</span><span class="s4">, </span><span class="s5">2</span><span class="s4">], </span><span class="s1">m</span><span class="s4">=</span><span class="s1">len</span><span class="s4">(</span><span class="s1">yover</span><span class="s4">))</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">y2</span><span class="s4">, </span><span class="s1">yover</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-12</span><span class="s4">, </span><span class="s1">atol</span><span class="s4">=</span><span class="s5">1e-10</span><span class="s4">)</span>

    <span class="s0"># Check that zoom_fft works on a subrange</span>
    <span class="s1">w </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">linspace</span><span class="s4">(</span><span class="s5">0</span><span class="s4">, </span><span class="s5">2</span><span class="s4">-</span><span class="s5">2.</span><span class="s4">/</span><span class="s1">len</span><span class="s4">(</span><span class="s1">x</span><span class="s4">), </span><span class="s1">len</span><span class="s4">(</span><span class="s1">x</span><span class="s4">))</span>
    <span class="s1">f1</span><span class="s4">, </span><span class="s1">f2 </span><span class="s4">= </span><span class="s1">w</span><span class="s4">[</span><span class="s5">3</span><span class="s4">], </span><span class="s1">w</span><span class="s4">[</span><span class="s5">6</span><span class="s4">]</span>
    <span class="s1">y3 </span><span class="s4">= </span><span class="s1">zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, [</span><span class="s1">f1</span><span class="s4">, </span><span class="s1">f2</span><span class="s4">], </span><span class="s1">m</span><span class="s4">=</span><span class="s5">3</span><span class="s4">*</span><span class="s1">over</span><span class="s4">+</span><span class="s5">1</span><span class="s4">, </span><span class="s1">endpoint</span><span class="s4">=</span><span class="s3">True</span><span class="s4">)</span>
    <span class="s1">idx3 </span><span class="s4">= </span><span class="s1">slice</span><span class="s4">(</span><span class="s5">3</span><span class="s4">*</span><span class="s1">over</span><span class="s4">, </span><span class="s5">6</span><span class="s4">*</span><span class="s1">over</span><span class="s4">+</span><span class="s5">1</span><span class="s4">)</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">y3</span><span class="s4">, </span><span class="s1">yover</span><span class="s4">[</span><span class="s1">idx3</span><span class="s4">], </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-13</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">test_1D</span><span class="s4">():</span>
    <span class="s0"># Test of 1D version of the transforms</span>

    <span class="s1">np</span><span class="s4">.</span><span class="s1">random</span><span class="s4">.</span><span class="s1">seed</span><span class="s4">(</span><span class="s5">0</span><span class="s4">)  </span><span class="s0"># Deterministic randomness</span>

    <span class="s0"># Random signals</span>
    <span class="s1">lengths </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">random</span><span class="s4">.</span><span class="s1">randint</span><span class="s4">(</span><span class="s5">8</span><span class="s4">, </span><span class="s5">200</span><span class="s4">, </span><span class="s5">20</span><span class="s4">)</span>
    <span class="s1">np</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span><span class="s1">lengths</span><span class="s4">, </span><span class="s5">1</span><span class="s4">)</span>
    <span class="s3">for </span><span class="s1">length </span><span class="s3">in </span><span class="s1">lengths</span><span class="s4">:</span>
        <span class="s1">x </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">random</span><span class="s4">.</span><span class="s1">random</span><span class="s4">(</span><span class="s1">length</span><span class="s4">)</span>
        <span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>
        <span class="s1">check_czt</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>

    <span class="s0"># Gauss</span>
    <span class="s1">t </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">linspace</span><span class="s4">(-</span><span class="s5">2</span><span class="s4">, </span><span class="s5">2</span><span class="s4">, </span><span class="s5">128</span><span class="s4">)</span>
    <span class="s1">x </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">exp</span><span class="s4">(-</span><span class="s1">t</span><span class="s4">**</span><span class="s5">2</span><span class="s4">/</span><span class="s5">0.01</span><span class="s4">)</span>
    <span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>

    <span class="s0"># Linear</span>
    <span class="s1">x </span><span class="s4">= [</span><span class="s5">1</span><span class="s4">, </span><span class="s5">2</span><span class="s4">, </span><span class="s5">3</span><span class="s4">, </span><span class="s5">4</span><span class="s4">, </span><span class="s5">5</span><span class="s4">, </span><span class="s5">6</span><span class="s4">, </span><span class="s5">7</span><span class="s4">]</span>
    <span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>

    <span class="s0"># Check near powers of two</span>
    <span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">range</span><span class="s4">(</span><span class="s5">126</span><span class="s4">-</span><span class="s5">31</span><span class="s4">))</span>
    <span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">range</span><span class="s4">(</span><span class="s5">127</span><span class="s4">-</span><span class="s5">31</span><span class="s4">))</span>
    <span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">range</span><span class="s4">(</span><span class="s5">128</span><span class="s4">-</span><span class="s5">31</span><span class="s4">))</span>
    <span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">range</span><span class="s4">(</span><span class="s5">129</span><span class="s4">-</span><span class="s5">31</span><span class="s4">))</span>
    <span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">range</span><span class="s4">(</span><span class="s5">130</span><span class="s4">-</span><span class="s5">31</span><span class="s4">))</span>

    <span class="s0"># Check transform on n-D array input</span>
    <span class="s1">x </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">reshape</span><span class="s4">(</span><span class="s1">np</span><span class="s4">.</span><span class="s1">arange</span><span class="s4">(</span><span class="s5">3</span><span class="s4">*</span><span class="s5">2</span><span class="s4">*</span><span class="s5">28</span><span class="s4">), (</span><span class="s5">3</span><span class="s4">, </span><span class="s5">2</span><span class="s4">, </span><span class="s5">28</span><span class="s4">))</span>
    <span class="s1">y1 </span><span class="s4">= </span><span class="s1">zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, [</span><span class="s5">0</span><span class="s4">, </span><span class="s5">2</span><span class="s4">-</span><span class="s5">2.</span><span class="s4">/</span><span class="s5">28</span><span class="s4">])</span>
    <span class="s1">y2 </span><span class="s4">= </span><span class="s1">zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">[</span><span class="s5">2</span><span class="s4">, </span><span class="s5">0</span><span class="s4">, :], [</span><span class="s5">0</span><span class="s4">, </span><span class="s5">2</span><span class="s4">-</span><span class="s5">2.</span><span class="s4">/</span><span class="s5">28</span><span class="s4">])</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">y1</span><span class="s4">[</span><span class="s5">2</span><span class="s4">, </span><span class="s5">0</span><span class="s4">], </span><span class="s1">y2</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-13</span><span class="s4">, </span><span class="s1">atol</span><span class="s4">=</span><span class="s5">1e-12</span><span class="s4">)</span>

    <span class="s1">y1 </span><span class="s4">= </span><span class="s1">zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, [</span><span class="s5">0</span><span class="s4">, </span><span class="s5">2</span><span class="s4">], </span><span class="s1">endpoint</span><span class="s4">=</span><span class="s3">False</span><span class="s4">)</span>
    <span class="s1">y2 </span><span class="s4">= </span><span class="s1">zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">[</span><span class="s5">2</span><span class="s4">, </span><span class="s5">0</span><span class="s4">, :], [</span><span class="s5">0</span><span class="s4">, </span><span class="s5">2</span><span class="s4">], </span><span class="s1">endpoint</span><span class="s4">=</span><span class="s3">False</span><span class="s4">)</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">y1</span><span class="s4">[</span><span class="s5">2</span><span class="s4">, </span><span class="s5">0</span><span class="s4">], </span><span class="s1">y2</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-13</span><span class="s4">, </span><span class="s1">atol</span><span class="s4">=</span><span class="s5">1e-12</span><span class="s4">)</span>

    <span class="s0"># Random (not a test condition)</span>
    <span class="s1">x </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">random</span><span class="s4">.</span><span class="s1">rand</span><span class="s4">(</span><span class="s5">101</span><span class="s4">)</span>
    <span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>

    <span class="s0"># Spikes</span>
    <span class="s1">t </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">linspace</span><span class="s4">(</span><span class="s5">0</span><span class="s4">, </span><span class="s5">1</span><span class="s4">, </span><span class="s5">128</span><span class="s4">)</span>
    <span class="s1">x </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">sin</span><span class="s4">(</span><span class="s5">2</span><span class="s4">*</span><span class="s1">np</span><span class="s4">.</span><span class="s1">pi</span><span class="s4">*</span><span class="s1">t</span><span class="s4">*</span><span class="s5">5</span><span class="s4">)+</span><span class="s1">np</span><span class="s4">.</span><span class="s1">sin</span><span class="s4">(</span><span class="s5">2</span><span class="s4">*</span><span class="s1">np</span><span class="s4">.</span><span class="s1">pi</span><span class="s4">*</span><span class="s1">t</span><span class="s4">*</span><span class="s5">13</span><span class="s4">)</span>
    <span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>

    <span class="s0"># Sines</span>
    <span class="s1">x </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">zeros</span><span class="s4">(</span><span class="s5">100</span><span class="s4">, </span><span class="s1">dtype</span><span class="s4">=</span><span class="s1">complex</span><span class="s4">)</span>
    <span class="s1">x</span><span class="s4">[[</span><span class="s5">1</span><span class="s4">, </span><span class="s5">5</span><span class="s4">, </span><span class="s5">21</span><span class="s4">]] = </span><span class="s5">1</span>
    <span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>

    <span class="s0"># Sines plus complex component</span>
    <span class="s1">x </span><span class="s4">+= </span><span class="s5">1j</span><span class="s4">*</span><span class="s1">np</span><span class="s4">.</span><span class="s1">linspace</span><span class="s4">(</span><span class="s5">0</span><span class="s4">, </span><span class="s5">0.5</span><span class="s4">, </span><span class="s1">x</span><span class="s4">.</span><span class="s1">shape</span><span class="s4">[</span><span class="s5">0</span><span class="s4">])</span>
    <span class="s1">check_zoom_fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">test_large_prime_lengths</span><span class="s4">():</span>
    <span class="s1">np</span><span class="s4">.</span><span class="s1">random</span><span class="s4">.</span><span class="s1">seed</span><span class="s4">(</span><span class="s5">0</span><span class="s4">)  </span><span class="s0"># Deterministic randomness</span>
    <span class="s3">for </span><span class="s1">N </span><span class="s3">in </span><span class="s4">(</span><span class="s5">101</span><span class="s4">, </span><span class="s5">1009</span><span class="s4">, </span><span class="s5">10007</span><span class="s4">):</span>
        <span class="s1">x </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">random</span><span class="s4">.</span><span class="s1">rand</span><span class="s4">(</span><span class="s1">N</span><span class="s4">)</span>
        <span class="s1">y </span><span class="s4">= </span><span class="s1">fft</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>
        <span class="s1">y1 </span><span class="s4">= </span><span class="s1">czt</span><span class="s4">(</span><span class="s1">x</span><span class="s4">)</span>
        <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">y</span><span class="s4">, </span><span class="s1">y1</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-12</span><span class="s4">)</span>


<span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">slow</span>
<span class="s3">def </span><span class="s1">test_czt_vs_fft</span><span class="s4">():</span>
    <span class="s1">np</span><span class="s4">.</span><span class="s1">random</span><span class="s4">.</span><span class="s1">seed</span><span class="s4">(</span><span class="s5">123</span><span class="s4">)</span>
    <span class="s1">random_lengths </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">random</span><span class="s4">.</span><span class="s1">exponential</span><span class="s4">(</span><span class="s5">100000</span><span class="s4">, </span><span class="s1">size</span><span class="s4">=</span><span class="s5">10</span><span class="s4">).</span><span class="s1">astype</span><span class="s4">(</span><span class="s6">'int'</span><span class="s4">)</span>
    <span class="s3">for </span><span class="s1">n </span><span class="s3">in </span><span class="s1">random_lengths</span><span class="s4">:</span>
        <span class="s1">a </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">random</span><span class="s4">.</span><span class="s1">randn</span><span class="s4">(</span><span class="s1">n</span><span class="s4">)</span>
        <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">czt</span><span class="s4">(</span><span class="s1">a</span><span class="s4">), </span><span class="s1">fft</span><span class="s4">(</span><span class="s1">a</span><span class="s4">), </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-11</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">test_empty_input</span><span class="s4">():</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'Invalid number of CZT'</span><span class="s4">):</span>
        <span class="s1">czt</span><span class="s4">([])</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'Invalid number of CZT'</span><span class="s4">):</span>
        <span class="s1">zoom_fft</span><span class="s4">([], </span><span class="s5">0.5</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">test_0_rank_input</span><span class="s4">():</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">IndexError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'tuple index out of range'</span><span class="s4">):</span>
        <span class="s1">czt</span><span class="s4">(</span><span class="s5">5</span><span class="s4">)</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">IndexError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'tuple index out of range'</span><span class="s4">):</span>
        <span class="s1">zoom_fft</span><span class="s4">(</span><span class="s5">5</span><span class="s4">, </span><span class="s5">0.5</span><span class="s4">)</span>


<span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">parametrize</span><span class="s4">(</span><span class="s6">'impulse'</span><span class="s4">, ([</span><span class="s5">0</span><span class="s4">, </span><span class="s5">0</span><span class="s4">, </span><span class="s5">1</span><span class="s4">], [</span><span class="s5">0</span><span class="s4">, </span><span class="s5">0</span><span class="s4">, </span><span class="s5">1</span><span class="s4">, </span><span class="s5">0</span><span class="s4">, </span><span class="s5">0</span><span class="s4">],</span>
                                     <span class="s1">np</span><span class="s4">.</span><span class="s1">concatenate</span><span class="s4">((</span><span class="s1">np</span><span class="s4">.</span><span class="s1">array</span><span class="s4">([</span><span class="s5">0</span><span class="s4">, </span><span class="s5">0</span><span class="s4">, </span><span class="s5">1</span><span class="s4">]),</span>
                                                     <span class="s1">np</span><span class="s4">.</span><span class="s1">zeros</span><span class="s4">(</span><span class="s5">100</span><span class="s4">)))))</span>
<span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">parametrize</span><span class="s4">(</span><span class="s6">'m'</span><span class="s4">, (</span><span class="s5">1</span><span class="s4">, </span><span class="s5">3</span><span class="s4">, </span><span class="s5">5</span><span class="s4">, </span><span class="s5">8</span><span class="s4">, </span><span class="s5">101</span><span class="s4">, </span><span class="s5">1021</span><span class="s4">))</span>
<span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">parametrize</span><span class="s4">(</span><span class="s6">'a'</span><span class="s4">, (</span><span class="s5">1</span><span class="s4">, </span><span class="s5">2</span><span class="s4">, </span><span class="s5">0.5</span><span class="s4">, </span><span class="s5">1.1</span><span class="s4">))</span>
<span class="s0"># Step that tests away from the unit circle, but not so far it explodes from</span>
<span class="s0"># numerical error</span>
<span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">parametrize</span><span class="s4">(</span><span class="s6">'w'</span><span class="s4">, (</span><span class="s3">None</span><span class="s4">, </span><span class="s5">0.98534 </span><span class="s4">+ </span><span class="s5">0.17055j</span><span class="s4">))</span>
<span class="s3">def </span><span class="s1">test_czt_math</span><span class="s4">(</span><span class="s1">impulse</span><span class="s4">, </span><span class="s1">m</span><span class="s4">, </span><span class="s1">w</span><span class="s4">, </span><span class="s1">a</span><span class="s4">):</span>
    <span class="s0"># z-transform of an impulse is 1 everywhere</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">czt</span><span class="s4">(</span><span class="s1">impulse</span><span class="s4">[</span><span class="s5">2</span><span class="s4">:], </span><span class="s1">m</span><span class="s4">=</span><span class="s1">m</span><span class="s4">, </span><span class="s1">w</span><span class="s4">=</span><span class="s1">w</span><span class="s4">, </span><span class="s1">a</span><span class="s4">=</span><span class="s1">a</span><span class="s4">),</span>
                    <span class="s1">np</span><span class="s4">.</span><span class="s1">ones</span><span class="s4">(</span><span class="s1">m</span><span class="s4">), </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-10</span><span class="s4">)</span>

    <span class="s0"># z-transform of a delayed impulse is z**-1</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">czt</span><span class="s4">(</span><span class="s1">impulse</span><span class="s4">[</span><span class="s5">1</span><span class="s4">:], </span><span class="s1">m</span><span class="s4">=</span><span class="s1">m</span><span class="s4">, </span><span class="s1">w</span><span class="s4">=</span><span class="s1">w</span><span class="s4">, </span><span class="s1">a</span><span class="s4">=</span><span class="s1">a</span><span class="s4">),</span>
                    <span class="s1">czt_points</span><span class="s4">(</span><span class="s1">m</span><span class="s4">=</span><span class="s1">m</span><span class="s4">, </span><span class="s1">w</span><span class="s4">=</span><span class="s1">w</span><span class="s4">, </span><span class="s1">a</span><span class="s4">=</span><span class="s1">a</span><span class="s4">)**-</span><span class="s5">1</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-10</span><span class="s4">)</span>

    <span class="s0"># z-transform of a 2-delayed impulse is z**-2</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">czt</span><span class="s4">(</span><span class="s1">impulse</span><span class="s4">, </span><span class="s1">m</span><span class="s4">=</span><span class="s1">m</span><span class="s4">, </span><span class="s1">w</span><span class="s4">=</span><span class="s1">w</span><span class="s4">, </span><span class="s1">a</span><span class="s4">=</span><span class="s1">a</span><span class="s4">),</span>
                    <span class="s1">czt_points</span><span class="s4">(</span><span class="s1">m</span><span class="s4">=</span><span class="s1">m</span><span class="s4">, </span><span class="s1">w</span><span class="s4">=</span><span class="s1">w</span><span class="s4">, </span><span class="s1">a</span><span class="s4">=</span><span class="s1">a</span><span class="s4">)**-</span><span class="s5">2</span><span class="s4">, </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-10</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">test_int_args</span><span class="s4">():</span>
    <span class="s0"># Integer argument `a` was producing all 0s</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">abs</span><span class="s4">(</span><span class="s1">czt</span><span class="s4">([</span><span class="s5">0</span><span class="s4">, </span><span class="s5">1</span><span class="s4">], </span><span class="s1">m</span><span class="s4">=</span><span class="s5">10</span><span class="s4">, </span><span class="s1">a</span><span class="s4">=</span><span class="s5">2</span><span class="s4">)), </span><span class="s5">0.5</span><span class="s4">*</span><span class="s1">np</span><span class="s4">.</span><span class="s1">ones</span><span class="s4">(</span><span class="s5">10</span><span class="s4">), </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-15</span><span class="s4">)</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">czt_points</span><span class="s4">(</span><span class="s5">11</span><span class="s4">, </span><span class="s1">w</span><span class="s4">=</span><span class="s5">2</span><span class="s4">), </span><span class="s5">1</span><span class="s4">/(</span><span class="s5">2</span><span class="s4">**</span><span class="s1">np</span><span class="s4">.</span><span class="s1">arange</span><span class="s4">(</span><span class="s5">11</span><span class="s4">)), </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-30</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">test_czt_points</span><span class="s4">():</span>
    <span class="s3">for </span><span class="s1">N </span><span class="s3">in </span><span class="s4">(</span><span class="s5">1</span><span class="s4">, </span><span class="s5">2</span><span class="s4">, </span><span class="s5">3</span><span class="s4">, </span><span class="s5">8</span><span class="s4">, </span><span class="s5">11</span><span class="s4">, </span><span class="s5">100</span><span class="s4">, </span><span class="s5">101</span><span class="s4">, </span><span class="s5">10007</span><span class="s4">):</span>
        <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">czt_points</span><span class="s4">(</span><span class="s1">N</span><span class="s4">), </span><span class="s1">np</span><span class="s4">.</span><span class="s1">exp</span><span class="s4">(</span><span class="s5">2j</span><span class="s4">*</span><span class="s1">np</span><span class="s4">.</span><span class="s1">pi</span><span class="s4">*</span><span class="s1">np</span><span class="s4">.</span><span class="s1">arange</span><span class="s4">(</span><span class="s1">N</span><span class="s4">)/</span><span class="s1">N</span><span class="s4">),</span>
                        <span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-30</span><span class="s4">)</span>

    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">czt_points</span><span class="s4">(</span><span class="s5">7</span><span class="s4">, </span><span class="s1">w</span><span class="s4">=</span><span class="s5">1</span><span class="s4">), </span><span class="s1">np</span><span class="s4">.</span><span class="s1">ones</span><span class="s4">(</span><span class="s5">7</span><span class="s4">), </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-30</span><span class="s4">)</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">czt_points</span><span class="s4">(</span><span class="s5">11</span><span class="s4">, </span><span class="s1">w</span><span class="s4">=</span><span class="s5">2.</span><span class="s4">), </span><span class="s5">1</span><span class="s4">/(</span><span class="s5">2</span><span class="s4">**</span><span class="s1">np</span><span class="s4">.</span><span class="s1">arange</span><span class="s4">(</span><span class="s5">11</span><span class="s4">)), </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-30</span><span class="s4">)</span>

    <span class="s1">func </span><span class="s4">= </span><span class="s1">CZT</span><span class="s4">(</span><span class="s5">12</span><span class="s4">, </span><span class="s1">m</span><span class="s4">=</span><span class="s5">11</span><span class="s4">, </span><span class="s1">w</span><span class="s4">=</span><span class="s5">2.</span><span class="s4">, </span><span class="s1">a</span><span class="s4">=</span><span class="s5">1</span><span class="s4">)</span>
    <span class="s1">assert_allclose</span><span class="s4">(</span><span class="s1">func</span><span class="s4">.</span><span class="s1">points</span><span class="s4">(), </span><span class="s5">1</span><span class="s4">/(</span><span class="s5">2</span><span class="s4">**</span><span class="s1">np</span><span class="s4">.</span><span class="s1">arange</span><span class="s4">(</span><span class="s5">11</span><span class="s4">)), </span><span class="s1">rtol</span><span class="s4">=</span><span class="s5">1e-30</span><span class="s4">)</span>


<span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">parametrize</span><span class="s4">(</span><span class="s6">'cls, args'</span><span class="s4">, [(</span><span class="s1">CZT</span><span class="s4">, (</span><span class="s5">100</span><span class="s4">,)), (</span><span class="s1">ZoomFFT</span><span class="s4">, (</span><span class="s5">100</span><span class="s4">, </span><span class="s5">0.2</span><span class="s4">))])</span>
<span class="s3">def </span><span class="s1">test_CZT_size_mismatch</span><span class="s4">(</span><span class="s1">cls</span><span class="s4">, </span><span class="s1">args</span><span class="s4">):</span>
    <span class="s0"># Data size doesn't match function's expected size</span>
    <span class="s1">myfunc </span><span class="s4">= </span><span class="s1">cls</span><span class="s4">(*</span><span class="s1">args</span><span class="s4">)</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'CZT defined for'</span><span class="s4">):</span>
        <span class="s1">myfunc</span><span class="s4">(</span><span class="s1">np</span><span class="s4">.</span><span class="s1">arange</span><span class="s4">(</span><span class="s5">5</span><span class="s4">))</span>


<span class="s3">def </span><span class="s1">test_invalid_range</span><span class="s4">():</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'2-length sequence'</span><span class="s4">):</span>
        <span class="s1">ZoomFFT</span><span class="s4">(</span><span class="s5">100</span><span class="s4">, [</span><span class="s5">1</span><span class="s4">, </span><span class="s5">2</span><span class="s4">, </span><span class="s5">3</span><span class="s4">])</span>


<span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">parametrize</span><span class="s4">(</span><span class="s6">'m'</span><span class="s4">, [</span><span class="s5">0</span><span class="s4">, -</span><span class="s5">11</span><span class="s4">, </span><span class="s5">5.5</span><span class="s4">, </span><span class="s5">4.0</span><span class="s4">])</span>
<span class="s3">def </span><span class="s1">test_czt_points_errors</span><span class="s4">(</span><span class="s1">m</span><span class="s4">):</span>
    <span class="s0"># Invalid number of points</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'Invalid number of CZT'</span><span class="s4">):</span>
        <span class="s1">czt_points</span><span class="s4">(</span><span class="s1">m</span><span class="s4">)</span>


<span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">parametrize</span><span class="s4">(</span><span class="s6">'size'</span><span class="s4">, [</span><span class="s5">0</span><span class="s4">, -</span><span class="s5">5</span><span class="s4">, </span><span class="s5">3.5</span><span class="s4">, </span><span class="s5">4.0</span><span class="s4">])</span>
<span class="s3">def </span><span class="s1">test_nonsense_size</span><span class="s4">(</span><span class="s1">size</span><span class="s4">):</span>
    <span class="s0"># Numpy and Scipy fft() give ValueError for 0 output size, so we do, too</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'Invalid number of CZT'</span><span class="s4">):</span>
        <span class="s1">CZT</span><span class="s4">(</span><span class="s1">size</span><span class="s4">, </span><span class="s5">3</span><span class="s4">)</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'Invalid number of CZT'</span><span class="s4">):</span>
        <span class="s1">ZoomFFT</span><span class="s4">(</span><span class="s1">size</span><span class="s4">, </span><span class="s5">0.2</span><span class="s4">, </span><span class="s5">3</span><span class="s4">)</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'Invalid number of CZT'</span><span class="s4">):</span>
        <span class="s1">CZT</span><span class="s4">(</span><span class="s5">3</span><span class="s4">, </span><span class="s1">size</span><span class="s4">)</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'Invalid number of CZT'</span><span class="s4">):</span>
        <span class="s1">ZoomFFT</span><span class="s4">(</span><span class="s5">3</span><span class="s4">, </span><span class="s5">0.2</span><span class="s4">, </span><span class="s1">size</span><span class="s4">)</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'Invalid number of CZT'</span><span class="s4">):</span>
        <span class="s1">czt</span><span class="s4">([</span><span class="s5">1</span><span class="s4">, </span><span class="s5">2</span><span class="s4">, </span><span class="s5">3</span><span class="s4">], </span><span class="s1">size</span><span class="s4">)</span>
    <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">, </span><span class="s1">match</span><span class="s4">=</span><span class="s6">'Invalid number of CZT'</span><span class="s4">):</span>
        <span class="s1">zoom_fft</span><span class="s4">([</span><span class="s5">1</span><span class="s4">, </span><span class="s5">2</span><span class="s4">, </span><span class="s5">3</span><span class="s4">], </span><span class="s5">0.2</span><span class="s4">, </span><span class="s1">size</span><span class="s4">)</span>
</pre>
</body>
</html>