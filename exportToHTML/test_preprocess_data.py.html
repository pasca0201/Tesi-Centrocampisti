<html>
<head>
<title>test_preprocess_data.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_preprocess_data.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">re</span>
<span class="s0">import </span><span class="s1">sys</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">_preprocess_data</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">axes </span><span class="s0">import </span><span class="s1">Axes</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">subprocess_run_for_testing</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">check_figures_equal</span>

<span class="s3"># Notes on testing the plotting functions itself</span>
<span class="s3"># *   the individual decorated plotting functions are tested in 'test_axes.py'</span>
<span class="s3"># *   that pyplot functions accept a data kwarg is only tested in</span>
<span class="s3">#     test_axes.test_pie_linewidth_0</span>


<span class="s3"># this gets used in multiple tests, so define it here</span>
<span class="s2">@</span><span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">], </span><span class="s1">label_namer</span><span class="s2">=</span><span class="s4">&quot;y&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">plot_func</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">w</span><span class="s2">=</span><span class="s4">&quot;xyz&quot;</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s4">f&quot;x: </span><span class="s0">{</span><span class="s1">list</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span><span class="s0">}</span><span class="s4">, y: </span><span class="s0">{</span><span class="s1">list</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)</span><span class="s0">}</span><span class="s4">, ls: </span><span class="s0">{</span><span class="s1">ls</span><span class="s0">}</span><span class="s4">, w: </span><span class="s0">{</span><span class="s1">w</span><span class="s0">}</span><span class="s4">, label: </span><span class="s0">{</span><span class="s1">label</span><span class="s0">}</span><span class="s4">&quot;</span>


<span class="s1">all_funcs </span><span class="s2">= [</span><span class="s1">plot_func</span><span class="s2">]</span>
<span class="s1">all_func_ids </span><span class="s2">= [</span><span class="s4">'plot_func'</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">test_compiletime_checks</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test decorator invocations -&gt; no replacements.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">func</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">): </span><span class="s0">pass</span>
    <span class="s0">def </span><span class="s1">func_args</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">): </span><span class="s0">pass</span>
    <span class="s0">def </span><span class="s1">func_kwargs</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">): </span><span class="s0">pass</span>
    <span class="s0">def </span><span class="s1">func_no_ax_args</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">): </span><span class="s0">pass</span>

    <span class="s3"># this is ok</span>
    <span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">])(</span><span class="s1">func</span><span class="s2">)</span>
    <span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">])(</span><span class="s1">func_kwargs</span><span class="s2">)</span>
    <span class="s3"># this has &quot;enough&quot; information to do all the replaces</span>
    <span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">])(</span><span class="s1">func_args</span><span class="s2">)</span>

    <span class="s3"># no positional_parameter_names but needed due to replaces</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">AssertionError</span><span class="s2">):</span>
        <span class="s3"># z is unknown</span>
        <span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s4">&quot;z&quot;</span><span class="s2">])(</span><span class="s1">func_args</span><span class="s2">)</span>

    <span class="s3"># no replacements at all -&gt; all ok...</span>
    <span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[], </span><span class="s1">label_namer</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)(</span><span class="s1">func</span><span class="s2">)</span>
    <span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[], </span><span class="s1">label_namer</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)(</span><span class="s1">func_args</span><span class="s2">)</span>
    <span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[], </span><span class="s1">label_namer</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)(</span><span class="s1">func_kwargs</span><span class="s2">)</span>
    <span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[], </span><span class="s1">label_namer</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)(</span><span class="s1">func_no_ax_args</span><span class="s2">)</span>

    <span class="s3"># label namer is unknown</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">AssertionError</span><span class="s2">):</span>
        <span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">label_namer</span><span class="s2">=</span><span class="s4">&quot;z&quot;</span><span class="s2">)(</span><span class="s1">func</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">AssertionError</span><span class="s2">):</span>
        <span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">label_namer</span><span class="s2">=</span><span class="s4">&quot;z&quot;</span><span class="s2">)(</span><span class="s1">func_args</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'func'</span><span class="s2">, </span><span class="s1">all_funcs</span><span class="s2">, </span><span class="s1">ids</span><span class="s2">=</span><span class="s1">all_func_ids</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_function_call_without_data</span><span class="s2">(</span><span class="s1">func</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Test without data -&gt; no replacements.&quot;&quot;&quot;</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: ['x'], y: ['y'], ls: x, w: xyz, label: None&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;y&quot;</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: ['x'], y: ['y'], ls: x, w: xyz, label: None&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: ['x'], y: ['y'], ls: x, w: xyz, label: &quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;text&quot;</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: ['x'], y: ['y'], ls: x, w: xyz, label: text&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: ['x'], y: ['y'], ls: x, w: xyz, label: &quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;text&quot;</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: ['x'], y: ['y'], ls: x, w: xyz, label: text&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'func'</span><span class="s2">, </span><span class="s1">all_funcs</span><span class="s2">, </span><span class="s1">ids</span><span class="s2">=</span><span class="s1">all_func_ids</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_function_call_with_dict_input</span><span class="s2">(</span><span class="s1">func</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Tests with dict input, unpacking via preprocess_pipeline&quot;&quot;&quot;</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">'a'</span><span class="s2">: </span><span class="s6">1</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">: </span><span class="s6">2</span><span class="s2">}</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">data</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(), </span><span class="s1">data</span><span class="s2">.</span><span class="s1">values</span><span class="s2">()) ==</span>
            <span class="s4">&quot;x: ['a', 'b'], y: [1, 2], ls: x, w: xyz, label: None&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'func'</span><span class="s2">, </span><span class="s1">all_funcs</span><span class="s2">, </span><span class="s1">ids</span><span class="s2">=</span><span class="s1">all_func_ids</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_function_call_with_dict_data</span><span class="s2">(</span><span class="s1">func</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Test with dict data -&gt; label comes from the value of 'x' parameter.&quot;&quot;&quot;</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;a&quot;</span><span class="s2">: [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], </span><span class="s4">&quot;b&quot;</span><span class="s2">: [</span><span class="s6">8</span><span class="s2">, </span><span class="s6">9</span><span class="s2">], </span><span class="s4">&quot;w&quot;</span><span class="s2">: </span><span class="s4">&quot;NOT&quot;</span><span class="s2">}</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: b&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: b&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: &quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;text&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: text&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: &quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;text&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: text&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'func'</span><span class="s2">, </span><span class="s1">all_funcs</span><span class="s2">, </span><span class="s1">ids</span><span class="s2">=</span><span class="s1">all_func_ids</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_function_call_with_dict_data_not_in_data</span><span class="s2">(</span><span class="s1">func</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Test the case that one var is not in data -&gt; half replaces, half kept&quot;&quot;&quot;</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;a&quot;</span><span class="s2">: [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], </span><span class="s4">&quot;w&quot;</span><span class="s2">: </span><span class="s4">&quot;NOT&quot;</span><span class="s2">}</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: ['b'], ls: x, w: xyz, label: b&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: ['b'], ls: x, w: xyz, label: b&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: ['b'], ls: x, w: xyz, label: &quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;text&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: ['b'], ls: x, w: xyz, label: text&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: ['b'], ls: x, w: xyz, label: &quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;text&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: ['b'], ls: x, w: xyz, label: text&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'func'</span><span class="s2">, </span><span class="s1">all_funcs</span><span class="s2">, </span><span class="s1">ids</span><span class="s2">=</span><span class="s1">all_func_ids</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_function_call_with_pandas_data</span><span class="s2">(</span><span class="s1">func</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Test with pandas dataframe -&gt; label comes from ``data[&quot;col&quot;].name``.&quot;&quot;&quot;</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s4">&quot;a&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">),</span>
                         <span class="s4">&quot;b&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">8</span><span class="s2">, </span><span class="s6">9</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">),</span>
                         <span class="s4">&quot;w&quot;</span><span class="s2">: [</span><span class="s4">&quot;NOT&quot;</span><span class="s2">, </span><span class="s4">&quot;NOT&quot;</span><span class="s2">]})</span>

    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: b&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: b&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: &quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;text&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: text&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: &quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;text&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: text&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_function_call_replace_all</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test without a &quot;replace_names&quot; argument, all vars should be replaced.&quot;&quot;&quot;</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;a&quot;</span><span class="s2">: [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], </span><span class="s4">&quot;b&quot;</span><span class="s2">: [</span><span class="s6">8</span><span class="s2">, </span><span class="s6">9</span><span class="s2">], </span><span class="s4">&quot;x&quot;</span><span class="s2">: </span><span class="s4">&quot;xyz&quot;</span><span class="s2">}</span>

    <span class="s2">@</span><span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">label_namer</span><span class="s2">=</span><span class="s4">&quot;y&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">func_replace_all</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">w</span><span class="s2">=</span><span class="s4">&quot;NOT&quot;</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s4">f&quot;x: </span><span class="s0">{</span><span class="s1">list</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span><span class="s0">}</span><span class="s4">, y: </span><span class="s0">{</span><span class="s1">list</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)</span><span class="s0">}</span><span class="s4">, ls: </span><span class="s0">{</span><span class="s1">ls</span><span class="s0">}</span><span class="s4">, w: </span><span class="s0">{</span><span class="s1">w</span><span class="s0">}</span><span class="s4">, label: </span><span class="s0">{</span><span class="s1">label</span><span class="s0">}</span><span class="s4">&quot;</span>

    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func_replace_all</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">w</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: b&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func_replace_all</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">w</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: b&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func_replace_all</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">w</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: &quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span>
        <span class="s1">func_replace_all</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">w</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;text&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
        <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: text&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span>
        <span class="s1">func_replace_all</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">w</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
        <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: &quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span>
        <span class="s1">func_replace_all</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">w</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;text&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
        <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: text&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_no_label_replacements</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test with &quot;label_namer=None&quot; -&gt; no label replacement at all.&quot;&quot;&quot;</span>

    <span class="s2">@</span><span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">], </span><span class="s1">label_namer</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">func_no_label</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">w</span><span class="s2">=</span><span class="s4">&quot;xyz&quot;</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s4">f&quot;x: </span><span class="s0">{</span><span class="s1">list</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span><span class="s0">}</span><span class="s4">, y: </span><span class="s0">{</span><span class="s1">list</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)</span><span class="s0">}</span><span class="s4">, ls: </span><span class="s0">{</span><span class="s1">ls</span><span class="s0">}</span><span class="s4">, w: </span><span class="s0">{</span><span class="s1">w</span><span class="s0">}</span><span class="s4">, label: </span><span class="s0">{</span><span class="s1">label</span><span class="s0">}</span><span class="s4">&quot;</span>

    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;a&quot;</span><span class="s2">: [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], </span><span class="s4">&quot;b&quot;</span><span class="s2">: [</span><span class="s6">8</span><span class="s2">, </span><span class="s6">9</span><span class="s2">], </span><span class="s4">&quot;w&quot;</span><span class="s2">: </span><span class="s4">&quot;NOT&quot;</span><span class="s2">}</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func_no_label</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: None&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func_no_label</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: None&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func_no_label</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: &quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">func_no_label</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;text&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">) ==</span>
            <span class="s4">&quot;x: [1, 2], y: [8, 9], ls: x, w: xyz, label: text&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_more_args_than_pos_parameter</span><span class="s2">():</span>
    <span class="s2">@</span><span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">], </span><span class="s1">label_namer</span><span class="s2">=</span><span class="s4">&quot;y&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">func</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">=</span><span class="s6">1</span><span class="s2">):</span>
        <span class="s0">pass</span>

    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;a&quot;</span><span class="s2">: [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], </span><span class="s4">&quot;b&quot;</span><span class="s2">: [</span><span class="s6">8</span><span class="s2">, </span><span class="s6">9</span><span class="s2">], </span><span class="s4">&quot;w&quot;</span><span class="s2">: </span><span class="s4">&quot;NOT&quot;</span><span class="s2">}</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">func</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;z&quot;</span><span class="s2">, </span><span class="s4">&quot;z&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_docstring_addition</span><span class="s2">():</span>
    <span class="s2">@</span><span class="s1">_preprocess_data</span><span class="s2">()</span>
    <span class="s0">def </span><span class="s1">funcy</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        data : indexable object, optional 
            DATA_PARAMETER_PLACEHOLDER 
        &quot;&quot;&quot;</span>

    <span class="s0">assert </span><span class="s1">re</span><span class="s2">.</span><span class="s1">search</span><span class="s2">(</span><span class="s4">r&quot;all parameters also accept a string&quot;</span><span class="s2">, </span><span class="s1">funcy</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">)</span>
    <span class="s0">assert not </span><span class="s1">re</span><span class="s2">.</span><span class="s1">search</span><span class="s2">(</span><span class="s4">r&quot;the following parameters&quot;</span><span class="s2">, </span><span class="s1">funcy</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[])</span>
    <span class="s0">def </span><span class="s1">funcy</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">bar</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        data : indexable object, optional 
            DATA_PARAMETER_PLACEHOLDER 
        &quot;&quot;&quot;</span>

    <span class="s0">assert not </span><span class="s1">re</span><span class="s2">.</span><span class="s1">search</span><span class="s2">(</span><span class="s4">r&quot;all parameters also accept a string&quot;</span><span class="s2">, </span><span class="s1">funcy</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">)</span>
    <span class="s0">assert not </span><span class="s1">re</span><span class="s2">.</span><span class="s1">search</span><span class="s2">(</span><span class="s4">r&quot;the following parameters&quot;</span><span class="s2">, </span><span class="s1">funcy</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[</span><span class="s4">&quot;bar&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">funcy</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">bar</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        data : indexable object, optional 
            DATA_PARAMETER_PLACEHOLDER 
        &quot;&quot;&quot;</span>

    <span class="s0">assert not </span><span class="s1">re</span><span class="s2">.</span><span class="s1">search</span><span class="s2">(</span><span class="s4">r&quot;all parameters also accept a string&quot;</span><span class="s2">, </span><span class="s1">funcy</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">)</span>
    <span class="s0">assert not </span><span class="s1">re</span><span class="s2">.</span><span class="s1">search</span><span class="s2">(</span><span class="s4">r&quot;the following parameters .*: \*bar\*\.&quot;</span><span class="s2">,</span>
                         <span class="s1">funcy</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">_preprocess_data</span><span class="s2">(</span><span class="s1">replace_names</span><span class="s2">=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;t&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">funcy</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">t</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        data : indexable object, optional 
            DATA_PARAMETER_PLACEHOLDER 
        &quot;&quot;&quot;</span>

    <span class="s0">assert not </span><span class="s1">re</span><span class="s2">.</span><span class="s1">search</span><span class="s2">(</span><span class="s4">r&quot;all parameters also accept a string&quot;</span><span class="s2">, </span><span class="s1">funcy</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">)</span>
    <span class="s0">assert not </span><span class="s1">re</span><span class="s2">.</span><span class="s1">search</span><span class="s2">(</span><span class="s4">r&quot;the following parameters .*: \*x\*, \*t\*\.&quot;</span><span class="s2">,</span>
                         <span class="s1">funcy</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_data_parameter_replacement</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot; 
    Test that the docstring contains the correct *data* parameter stub 
    for all methods that we run _preprocess_data() on. 
    &quot;&quot;&quot;</span>
    <span class="s1">program </span><span class="s2">= (</span>
        <span class="s4">&quot;import logging; &quot;</span>
        <span class="s4">&quot;logging.basicConfig(level=logging.DEBUG); &quot;</span>
        <span class="s4">&quot;import matplotlib.pyplot as plt&quot;</span>
    <span class="s2">)</span>
    <span class="s1">cmd </span><span class="s2">= [</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">executable</span><span class="s2">, </span><span class="s4">&quot;-c&quot;</span><span class="s2">, </span><span class="s1">program</span><span class="s2">]</span>
    <span class="s1">completed_proc </span><span class="s2">= </span><span class="s1">subprocess_run_for_testing</span><span class="s2">(</span>
        <span class="s1">cmd</span><span class="s2">, </span><span class="s1">text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">capture_output</span><span class="s2">=</span><span class="s0">True</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s4">'data parameter docstring error' </span><span class="s0">not in </span><span class="s1">completed_proc</span><span class="s2">.</span><span class="s1">stderr</span>


<span class="s0">class </span><span class="s1">TestPlotTypes</span><span class="s2">:</span>

    <span class="s1">plotters </span><span class="s2">= [</span><span class="s1">Axes</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">, </span><span class="s1">Axes</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">, </span><span class="s1">Axes</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">]</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'plotter'</span><span class="s2">, </span><span class="s1">plotters</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_dict_unpack</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">plotter</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">]</span>
        <span class="s1">y </span><span class="s2">= [</span><span class="s6">4</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">6</span><span class="s2">]</span>
        <span class="s1">ddict </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">zip</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

        <span class="s1">plotter</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(),</span>
                <span class="s1">ddict</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(), </span><span class="s1">ddict</span><span class="s2">.</span><span class="s1">values</span><span class="s2">())</span>
        <span class="s1">plotter</span><span class="s2">(</span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(), </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'plotter'</span><span class="s2">, </span><span class="s1">plotters</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_data_kwarg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">plotter</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">]</span>
        <span class="s1">y </span><span class="s2">= [</span><span class="s6">4</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">6</span><span class="s2">]</span>

        <span class="s1">plotter</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(), </span><span class="s4">'xval'</span><span class="s2">, </span><span class="s4">'yval'</span><span class="s2">,</span>
                <span class="s1">data</span><span class="s2">={</span><span class="s4">'xval'</span><span class="s2">: </span><span class="s1">x</span><span class="s2">, </span><span class="s4">'yval'</span><span class="s2">: </span><span class="s1">y</span><span class="s2">})</span>
        <span class="s1">plotter</span><span class="s2">(</span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(), </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
</pre>
</body>
</html>