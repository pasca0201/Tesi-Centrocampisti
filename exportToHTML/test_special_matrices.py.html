<html>
<head>
<title>test_special_matrices.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #7a7e85;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_special_matrices.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy </span><span class="s0">import </span><span class="s1">arange</span><span class="s2">, </span><span class="s1">array</span><span class="s2">, </span><span class="s1">eye</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">, </span><span class="s1">sqrt</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s2">(</span><span class="s1">assert_equal</span><span class="s2">, </span><span class="s1">assert_array_equal</span><span class="s2">,</span>
                           <span class="s1">assert_array_almost_equal</span><span class="s2">, </span><span class="s1">assert_allclose</span><span class="s2">)</span>
<span class="s0">from </span><span class="s1">pytest </span><span class="s0">import </span><span class="s1">raises </span><span class="s0">as </span><span class="s1">assert_raises</span>

<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">fft </span><span class="s0">import </span><span class="s1">fft</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">special </span><span class="s0">import </span><span class="s1">comb</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">linalg </span><span class="s0">import </span><span class="s2">(</span><span class="s1">toeplitz</span><span class="s2">, </span><span class="s1">hankel</span><span class="s2">, </span><span class="s1">circulant</span><span class="s2">, </span><span class="s1">hadamard</span><span class="s2">, </span><span class="s1">leslie</span><span class="s2">, </span><span class="s1">dft</span><span class="s2">,</span>
                          <span class="s1">companion</span><span class="s2">, </span><span class="s1">kron</span><span class="s2">, </span><span class="s1">block_diag</span><span class="s2">,</span>
                          <span class="s1">helmert</span><span class="s2">, </span><span class="s1">hilbert</span><span class="s2">, </span><span class="s1">invhilbert</span><span class="s2">, </span><span class="s1">pascal</span><span class="s2">, </span><span class="s1">invpascal</span><span class="s2">,</span>
                          <span class="s1">fiedler</span><span class="s2">, </span><span class="s1">fiedler_companion</span><span class="s2">, </span><span class="s1">eigvals</span><span class="s2">,</span>
                          <span class="s1">convolution_matrix</span><span class="s2">)</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">linalg </span><span class="s0">import </span><span class="s1">cond</span>


<span class="s0">class </span><span class="s1">TestToeplitz</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">toeplitz</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">], [</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">]])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">toeplitz</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">], [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">4</span><span class="s2">], [</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">]])</span>

    <span class="s0">def </span><span class="s1">test_complex_01</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">data </span><span class="s2">= (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">arange</span><span class="s2">(</span><span class="s3">3.0</span><span class="s2">)) * (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s3">1.0j</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">copy</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">toeplitz</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s4"># Calling toeplitz should not change x.</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)</span>
        <span class="s4"># According to the docstring, x should be the first column of t.</span>
        <span class="s1">col0 </span><span class="s2">= </span><span class="s1">t</span><span class="s2">[:, </span><span class="s3">0</span><span class="s2">]</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">col0</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">t</span><span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">:], </span><span class="s1">data</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:].</span><span class="s1">conj</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_scalar_00</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot;Scalar arguments still produce a 2D array.&quot;&quot;&quot;</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">toeplitz</span><span class="s2">(</span><span class="s3">10</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, [[</span><span class="s3">10</span><span class="s2">]])</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">toeplitz</span><span class="s2">(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">20</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, [[</span><span class="s3">10</span><span class="s2">]])</span>

    <span class="s0">def </span><span class="s1">test_scalar_01</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">])</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">toeplitz</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">], [</span><span class="s3">3</span><span class="s2">]])</span>

    <span class="s0">def </span><span class="s1">test_scalar_02</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">])</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">toeplitz</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">array</span><span class="s2">(</span><span class="s3">1</span><span class="s2">))</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">], [</span><span class="s3">3</span><span class="s2">]])</span>

    <span class="s0">def </span><span class="s1">test_scalar_03</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">])</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">toeplitz</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">array</span><span class="s2">([</span><span class="s3">1</span><span class="s2">]))</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">], [</span><span class="s3">3</span><span class="s2">]])</span>

    <span class="s0">def </span><span class="s1">test_scalar_04</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">r </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">10</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">])</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">toeplitz</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">]])</span>


<span class="s0">class </span><span class="s1">TestHankel</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">hankel</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">0</span><span class="s2">], [</span><span class="s3">3</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">]])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">hankel</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">], [</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">], [</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">]])</span>


<span class="s0">class </span><span class="s1">TestCirculant</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">circulant</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">], [</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">]])</span>


<span class="s0">class </span><span class="s1">TestHadamard</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">hadamard</span><span class="s2">(</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">]])</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">hadamard</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">float</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [[</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">], [</span><span class="s3">1.0</span><span class="s2">, -</span><span class="s3">1.0</span><span class="s2">]])</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">hadamard</span><span class="s2">(</span><span class="s3">4</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">]])</span>

        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">hadamard</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">hadamard</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestLeslie</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_bad_shapes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">leslie</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">]], [</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">])</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">leslie</span><span class="s2">, [</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">], [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">]])</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">leslie</span><span class="s2">, [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">], [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">])</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">leslie</span><span class="s2">, [</span><span class="s3">1</span><span class="s2">], [])</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">leslie</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">], [</span><span class="s3">0.25</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">])</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">2.0</span><span class="s2">, </span><span class="s3">3.0</span><span class="s2">],</span>
                          <span class="s2">[</span><span class="s3">0.25</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">],</span>
                          <span class="s2">[</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestCompanion</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_bad_shapes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">companion</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">]])</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">companion</span><span class="s2">, [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">])</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">companion</span><span class="s2">, [</span><span class="s3">1</span><span class="s2">])</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">companion</span><span class="s2">, [])</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">companion</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">])</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span>
            <span class="s2">[-</span><span class="s3">2.0</span><span class="s2">, -</span><span class="s3">3.0</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">c </span><span class="s2">= </span><span class="s1">companion</span><span class="s2">([</span><span class="s3">2.0</span><span class="s2">, </span><span class="s3">5.0</span><span class="s2">, -</span><span class="s3">10.0</span><span class="s2">])</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span>
            <span class="s2">[-</span><span class="s3">2.5</span><span class="s2">, </span><span class="s3">5.0</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestBlockDiag</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">block_diag</span><span class="s2">(</span><span class="s1">eye</span><span class="s2">(</span><span class="s3">2</span><span class="s2">), [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">], [</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">], [</span><span class="s3">5</span><span class="s2">, </span><span class="s3">6</span><span class="s2">]], [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">]])</span>

    <span class="s0">def </span><span class="s1">test_dtype</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">block_diag</span><span class="s2">([[</span><span class="s3">1.5</span><span class="s2">]])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">float</span><span class="s2">)</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">block_diag</span><span class="s2">([[</span><span class="s0">True</span><span class="s2">]])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">bool</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_mixed_dtypes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">block_diag</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">]], [[</span><span class="s3">1j</span><span class="s2">]])</span>
        <span class="s1">desired </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">], [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1j</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_scalar_and_1d_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">block_diag</span><span class="s2">(</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">))</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">]])</span>

        <span class="s1">a </span><span class="s2">= </span><span class="s1">block_diag</span><span class="s2">([</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">], </span><span class="s3">4</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">0</span><span class="s2">], [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">4</span><span class="s2">]])</span>

    <span class="s0">def </span><span class="s1">test_bad_arg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">block_diag</span><span class="s2">, [[[</span><span class="s3">1</span><span class="s2">]]])</span>

    <span class="s0">def </span><span class="s1">test_no_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">block_diag</span><span class="s2">()</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">ndim</span><span class="s2">, </span><span class="s3">2</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">nbytes</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_empty_matrix_arg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># regression test for gh-4596: check the shape of the result</span>
        <span class="s4"># for empty matrix inputs. Empty matrices are no longer ignored</span>
        <span class="s4"># (gh-4908) it is viewed as a shape (1, 0) matrix.</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">block_diag</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">], [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">]],</span>
                       <span class="s2">[],</span>
                       <span class="s2">[[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">], [</span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">], [</span><span class="s3">6</span><span class="s2">, </span><span class="s3">7</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">7</span><span class="s2">]])</span>

    <span class="s0">def </span><span class="s1">test_zerosized_matrix_arg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># test for gh-4908: check the shape of the result for</span>
        <span class="s4"># zero-sized matrix inputs, i.e. matrices with shape (0,n) or (n,0).</span>
        <span class="s4"># note that [[]] takes shape (1,0)</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">block_diag</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">], [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">]],</span>
                       <span class="s2">[[]],</span>
                       <span class="s2">[[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">], [</span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">], [</span><span class="s3">6</span><span class="s2">, </span><span class="s3">7</span><span class="s2">]],</span>
                       <span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s6">'int32'</span><span class="s2">))</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                               <span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">]])</span>


<span class="s0">class </span><span class="s1">TestKron</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s1">a </span><span class="s2">= </span><span class="s1">kron</span><span class="s2">(</span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">], [</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">]]), </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">]]))</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">],</span>
                                     <span class="s2">[</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">4</span><span class="s2">]]))</span>

        <span class="s1">m1 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">], [</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">]])</span>
        <span class="s1">m2 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">10</span><span class="s2">], [</span><span class="s3">11</span><span class="s2">]])</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">kron</span><span class="s2">(</span><span class="s1">m1</span><span class="s2">, </span><span class="s1">m2</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">10</span><span class="s2">, </span><span class="s3">20</span><span class="s2">],</span>
                          <span class="s2">[</span><span class="s3">11</span><span class="s2">, </span><span class="s3">22</span><span class="s2">],</span>
                          <span class="s2">[</span><span class="s3">30</span><span class="s2">, </span><span class="s3">40</span><span class="s2">],</span>
                          <span class="s2">[</span><span class="s3">33</span><span class="s2">, </span><span class="s3">44</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_empty</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">m1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">))</span>
        <span class="s1">m2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">))</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">kron</span><span class="s2">(</span><span class="s1">m1</span><span class="s2">, </span><span class="s1">m2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">)))</span>


<span class="s0">class </span><span class="s1">TestHelmert</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_orthogonality</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s2">):</span>
            <span class="s1">H </span><span class="s2">= </span><span class="s1">helmert</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">full</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s1">Id </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">H</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">H</span><span class="s2">.</span><span class="s1">T</span><span class="s2">), </span><span class="s1">Id</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s3">1e-12</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">H</span><span class="s2">.</span><span class="s1">T</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">H</span><span class="s2">), </span><span class="s1">Id</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s3">1e-12</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_subspace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">7</span><span class="s2">):</span>
            <span class="s1">H_full </span><span class="s2">= </span><span class="s1">helmert</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">full</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s1">H_partial </span><span class="s2">= </span><span class="s1">helmert</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">U </span><span class="s0">in </span><span class="s1">H_full</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:, :].</span><span class="s1">T</span><span class="s2">, </span><span class="s1">H_partial</span><span class="s2">.</span><span class="s1">T</span><span class="s2">:</span>
                <span class="s1">C </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s1">n</span><span class="s2">) - </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">((</span><span class="s1">n</span><span class="s2">, </span><span class="s1">n</span><span class="s2">), </span><span class="s3">1 </span><span class="s2">/ </span><span class="s1">n</span><span class="s2">)</span>
                <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">U</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">U</span><span class="s2">.</span><span class="s1">T</span><span class="s2">), </span><span class="s1">C</span><span class="s2">)</span>
                <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">U</span><span class="s2">.</span><span class="s1">T</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">U</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s1">n</span><span class="s2">-</span><span class="s3">1</span><span class="s2">), </span><span class="s1">atol</span><span class="s2">=</span><span class="s3">1e-12</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestHilbert</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">h3 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">/</span><span class="s3">2.</span><span class="s2">, </span><span class="s3">1</span><span class="s2">/</span><span class="s3">3.</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s3">1</span><span class="s2">/</span><span class="s3">2.</span><span class="s2">, </span><span class="s3">1</span><span class="s2">/</span><span class="s3">3.</span><span class="s2">, </span><span class="s3">1</span><span class="s2">/</span><span class="s3">4.</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s3">1</span><span class="s2">/</span><span class="s3">3.</span><span class="s2">, </span><span class="s3">1</span><span class="s2">/</span><span class="s3">4.</span><span class="s2">, </span><span class="s3">1</span><span class="s2">/</span><span class="s3">5.</span><span class="s2">]])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">hilbert</span><span class="s2">(</span><span class="s3">3</span><span class="s2">), </span><span class="s1">h3</span><span class="s2">)</span>

        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">hilbert</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), [[</span><span class="s3">1.0</span><span class="s2">]])</span>

        <span class="s1">h0 </span><span class="s2">= </span><span class="s1">hilbert</span><span class="s2">(</span><span class="s3">0</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h0</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestInvHilbert</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">invh1 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">), </span><span class="s1">invh1</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">invh1</span><span class="s2">)</span>

        <span class="s1">invh2 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">4</span><span class="s2">, -</span><span class="s3">6</span><span class="s2">],</span>
                       <span class="s2">[-</span><span class="s3">6</span><span class="s2">, </span><span class="s3">12</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">), </span><span class="s1">invh2</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s3">2</span><span class="s2">), </span><span class="s1">invh2</span><span class="s2">)</span>

        <span class="s1">invh3 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">9</span><span class="s2">, -</span><span class="s3">36</span><span class="s2">, </span><span class="s3">30</span><span class="s2">],</span>
                       <span class="s2">[-</span><span class="s3">36</span><span class="s2">, </span><span class="s3">192</span><span class="s2">, -</span><span class="s3">180</span><span class="s2">],</span>
                       <span class="s2">[</span><span class="s3">30</span><span class="s2">, -</span><span class="s3">180</span><span class="s2">, </span><span class="s3">180</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s3">3</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">), </span><span class="s1">invh3</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s3">3</span><span class="s2">), </span><span class="s1">invh3</span><span class="s2">)</span>

        <span class="s1">invh4 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">16</span><span class="s2">, -</span><span class="s3">120</span><span class="s2">, </span><span class="s3">240</span><span class="s2">, -</span><span class="s3">140</span><span class="s2">],</span>
                       <span class="s2">[-</span><span class="s3">120</span><span class="s2">, </span><span class="s3">1200</span><span class="s2">, -</span><span class="s3">2700</span><span class="s2">, </span><span class="s3">1680</span><span class="s2">],</span>
                       <span class="s2">[</span><span class="s3">240</span><span class="s2">, -</span><span class="s3">2700</span><span class="s2">, </span><span class="s3">6480</span><span class="s2">, -</span><span class="s3">4200</span><span class="s2">],</span>
                       <span class="s2">[-</span><span class="s3">140</span><span class="s2">, </span><span class="s3">1680</span><span class="s2">, -</span><span class="s3">4200</span><span class="s2">, </span><span class="s3">2800</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">), </span><span class="s1">invh4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s3">4</span><span class="s2">), </span><span class="s1">invh4</span><span class="s2">)</span>

        <span class="s1">invh5 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">25</span><span class="s2">, -</span><span class="s3">300</span><span class="s2">, </span><span class="s3">1050</span><span class="s2">, -</span><span class="s3">1400</span><span class="s2">, </span><span class="s3">630</span><span class="s2">],</span>
                       <span class="s2">[-</span><span class="s3">300</span><span class="s2">, </span><span class="s3">4800</span><span class="s2">, -</span><span class="s3">18900</span><span class="s2">, </span><span class="s3">26880</span><span class="s2">, -</span><span class="s3">12600</span><span class="s2">],</span>
                       <span class="s2">[</span><span class="s3">1050</span><span class="s2">, -</span><span class="s3">18900</span><span class="s2">, </span><span class="s3">79380</span><span class="s2">, -</span><span class="s3">117600</span><span class="s2">, </span><span class="s3">56700</span><span class="s2">],</span>
                       <span class="s2">[-</span><span class="s3">1400</span><span class="s2">, </span><span class="s3">26880</span><span class="s2">, -</span><span class="s3">117600</span><span class="s2">, </span><span class="s3">179200</span><span class="s2">, -</span><span class="s3">88200</span><span class="s2">],</span>
                       <span class="s2">[</span><span class="s3">630</span><span class="s2">, -</span><span class="s3">12600</span><span class="s2">, </span><span class="s3">56700</span><span class="s2">, -</span><span class="s3">88200</span><span class="s2">, </span><span class="s3">44100</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">), </span><span class="s1">invh5</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s3">5</span><span class="s2">), </span><span class="s1">invh5</span><span class="s2">)</span>

        <span class="s1">invh17 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span>
            <span class="s2">[</span><span class="s3">289</span><span class="s2">, -</span><span class="s3">41616</span><span class="s2">, </span><span class="s3">1976760</span><span class="s2">, -</span><span class="s3">46124400</span><span class="s2">, </span><span class="s3">629598060</span><span class="s2">, -</span><span class="s3">5540462928</span><span class="s2">,</span>
             <span class="s3">33374693352</span><span class="s2">, -</span><span class="s3">143034400080</span><span class="s2">, </span><span class="s3">446982500250</span><span class="s2">, -</span><span class="s3">1033026222800</span><span class="s2">,</span>
             <span class="s3">1774926873720</span><span class="s2">, -</span><span class="s3">2258997839280</span><span class="s2">, </span><span class="s3">2099709530100</span><span class="s2">, -</span><span class="s3">1384423866000</span><span class="s2">,</span>
             <span class="s3">613101997800</span><span class="s2">, -</span><span class="s3">163493866080</span><span class="s2">, </span><span class="s3">19835652870</span><span class="s2">],</span>
            <span class="s2">[-</span><span class="s3">41616</span><span class="s2">, </span><span class="s3">7990272</span><span class="s2">, -</span><span class="s3">426980160</span><span class="s2">, </span><span class="s3">10627061760</span><span class="s2">, -</span><span class="s3">151103534400</span><span class="s2">,</span>
             <span class="s3">1367702848512</span><span class="s2">, -</span><span class="s3">8410422724704</span><span class="s2">, </span><span class="s3">36616806420480</span><span class="s2">, -</span><span class="s3">115857864064800</span><span class="s2">,</span>
             <span class="s3">270465047424000</span><span class="s2">, -</span><span class="s3">468580694662080</span><span class="s2">, </span><span class="s3">600545887119360</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">561522320049600</span><span class="s2">, </span><span class="s3">372133135180800</span><span class="s2">, -</span><span class="s3">165537539406000</span><span class="s2">,</span>
             <span class="s3">44316454993920</span><span class="s2">, -</span><span class="s3">5395297580640</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s3">1976760</span><span class="s2">, -</span><span class="s3">426980160</span><span class="s2">, </span><span class="s3">24337869120</span><span class="s2">, -</span><span class="s3">630981792000</span><span class="s2">, </span><span class="s3">9228108708000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">85267724461920</span><span class="s2">, </span><span class="s3">532660105897920</span><span class="s2">, -</span><span class="s3">2348052711713280</span><span class="s2">,</span>
             <span class="s3">7504429831470000</span><span class="s2">, -</span><span class="s3">17664748409880000</span><span class="s2">, </span><span class="s3">30818191841236800</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">39732544853164800</span><span class="s2">, </span><span class="s3">37341234283298400</span><span class="s2">, -</span><span class="s3">24857330514030000</span><span class="s2">,</span>
             <span class="s3">11100752642520000</span><span class="s2">, -</span><span class="s3">2982128117299200</span><span class="s2">, </span><span class="s3">364182586693200</span><span class="s2">],</span>
            <span class="s2">[-</span><span class="s3">46124400</span><span class="s2">, </span><span class="s3">10627061760</span><span class="s2">, -</span><span class="s3">630981792000</span><span class="s2">, </span><span class="s3">16826181120000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">251209625940000</span><span class="s2">, </span><span class="s3">2358021022156800</span><span class="s2">, -</span><span class="s3">14914482965141760</span><span class="s2">,</span>
             <span class="s3">66409571644416000</span><span class="s2">, -</span><span class="s3">214015221119700000</span><span class="s2">, </span><span class="s3">507295338950400000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">890303319857952000</span><span class="s2">, </span><span class="s3">1153715376477081600</span><span class="s2">, -</span><span class="s3">1089119333262870000</span><span class="s2">,</span>
             <span class="s3">727848632044800000</span><span class="s2">, -</span><span class="s3">326170262829600000</span><span class="s2">, </span><span class="s3">87894302404608000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">10763618673376800</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s3">629598060</span><span class="s2">, -</span><span class="s3">151103534400</span><span class="s2">, </span><span class="s3">9228108708000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">251209625940000</span><span class="s2">, </span><span class="s3">3810012660090000</span><span class="s2">, -</span><span class="s3">36210360321495360</span><span class="s2">,</span>
             <span class="s3">231343968720664800</span><span class="s2">, -</span><span class="s3">1038687206500944000</span><span class="s2">, </span><span class="s3">3370739732635275000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">8037460526495400000</span><span class="s2">, </span><span class="s3">14178080368737885600</span><span class="s2">, -</span><span class="s3">18454939322943942000</span><span class="s2">,</span>
             <span class="s3">17489975175339030000</span><span class="s2">, -</span><span class="s3">11728977435138600000</span><span class="s2">, </span><span class="s3">5272370630081100000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">1424711708039692800</span><span class="s2">, </span><span class="s3">174908803442373000</span><span class="s2">],</span>
            <span class="s2">[-</span><span class="s3">5540462928</span><span class="s2">, </span><span class="s3">1367702848512</span><span class="s2">, -</span><span class="s3">85267724461920</span><span class="s2">, </span><span class="s3">2358021022156800</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">36210360321495360</span><span class="s2">, </span><span class="s3">347619459086355456</span><span class="s2">, -</span><span class="s3">2239409617216035264</span><span class="s2">,</span>
             <span class="s3">10124803292907663360</span><span class="s2">, -</span><span class="s3">33052510749726468000</span><span class="s2">,</span>
             <span class="s3">79217210949138662400</span><span class="s2">, -</span><span class="s3">140362995650505067440</span><span class="s2">,</span>
             <span class="s3">183420385176741672960</span><span class="s2">, -</span><span class="s3">174433352415381259200</span><span class="s2">,</span>
             <span class="s3">117339159519533952000</span><span class="s2">, -</span><span class="s3">52892422160973595200</span><span class="s2">,</span>
             <span class="s3">14328529177999196160</span><span class="s2">, -</span><span class="s3">1763080738699119840</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s3">33374693352</span><span class="s2">, -</span><span class="s3">8410422724704</span><span class="s2">, </span><span class="s3">532660105897920</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">14914482965141760</span><span class="s2">, </span><span class="s3">231343968720664800</span><span class="s2">, -</span><span class="s3">2239409617216035264</span><span class="s2">,</span>
             <span class="s3">14527452132196331328</span><span class="s2">, -</span><span class="s3">66072377044391477760</span><span class="s2">,</span>
             <span class="s3">216799987176909536400</span><span class="s2">, -</span><span class="s3">521925895055522958000</span><span class="s2">,</span>
             <span class="s3">928414062734059661760</span><span class="s2">, -</span><span class="s3">1217424500995626443520</span><span class="s2">,</span>
             <span class="s3">1161358898976091015200</span><span class="s2">, -</span><span class="s3">783401860847777371200</span><span class="s2">,</span>
             <span class="s3">354015418167362952000</span><span class="s2">, -</span><span class="s3">96120549902411274240</span><span class="s2">,</span>
             <span class="s3">11851820521255194480</span><span class="s2">],</span>
            <span class="s2">[-</span><span class="s3">143034400080</span><span class="s2">, </span><span class="s3">36616806420480</span><span class="s2">, -</span><span class="s3">2348052711713280</span><span class="s2">,</span>
             <span class="s3">66409571644416000</span><span class="s2">, -</span><span class="s3">1038687206500944000</span><span class="s2">, </span><span class="s3">10124803292907663360</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">66072377044391477760</span><span class="s2">, </span><span class="s3">302045152202932469760</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">995510145200094810000</span><span class="s2">, </span><span class="s3">2405996923185123840000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">4294704507885446054400</span><span class="s2">, </span><span class="s3">5649058909023744614400</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">5403874060541811254400</span><span class="s2">, </span><span class="s3">3654352703663101440000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">1655137020003255360000</span><span class="s2">, </span><span class="s3">450325202737117593600</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">55630994283442749600</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s3">446982500250</span><span class="s2">, -</span><span class="s3">115857864064800</span><span class="s2">, </span><span class="s3">7504429831470000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">214015221119700000</span><span class="s2">, </span><span class="s3">3370739732635275000</span><span class="s2">, -</span><span class="s3">33052510749726468000</span><span class="s2">,</span>
             <span class="s3">216799987176909536400</span><span class="s2">, -</span><span class="s3">995510145200094810000</span><span class="s2">,</span>
             <span class="s3">3293967392206196062500</span><span class="s2">, -</span><span class="s3">7988661659013106500000</span><span class="s2">,</span>
             <span class="s3">14303908928401362270000</span><span class="s2">, -</span><span class="s3">18866974090684772052000</span><span class="s2">,</span>
             <span class="s3">18093328327706957325000</span><span class="s2">, -</span><span class="s3">12263364009096700500000</span><span class="s2">,</span>
             <span class="s3">5565847995255512250000</span><span class="s2">, -</span><span class="s3">1517208935002984080000</span><span class="s2">,</span>
             <span class="s3">187754605706619279900</span><span class="s2">],</span>
            <span class="s2">[-</span><span class="s3">1033026222800</span><span class="s2">, </span><span class="s3">270465047424000</span><span class="s2">, -</span><span class="s3">17664748409880000</span><span class="s2">,</span>
             <span class="s3">507295338950400000</span><span class="s2">, -</span><span class="s3">8037460526495400000</span><span class="s2">, </span><span class="s3">79217210949138662400</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">521925895055522958000</span><span class="s2">, </span><span class="s3">2405996923185123840000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">7988661659013106500000</span><span class="s2">, </span><span class="s3">19434404971634224000000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">34894474126569249192000</span><span class="s2">, </span><span class="s3">46141453390504792320000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">44349976506971935800000</span><span class="s2">, </span><span class="s3">30121928988527376000000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">13697025107665828500000</span><span class="s2">, </span><span class="s3">3740200989399948902400</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">463591619028689580000</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s3">1774926873720</span><span class="s2">, -</span><span class="s3">468580694662080</span><span class="s2">,</span>
             <span class="s3">30818191841236800</span><span class="s2">, -</span><span class="s3">890303319857952000</span><span class="s2">, </span><span class="s3">14178080368737885600</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">140362995650505067440</span><span class="s2">, </span><span class="s3">928414062734059661760</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">4294704507885446054400</span><span class="s2">, </span><span class="s3">14303908928401362270000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">34894474126569249192000</span><span class="s2">, </span><span class="s3">62810053427824648545600</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">83243376594051600326400</span><span class="s2">, </span><span class="s3">80177044485212743068000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">54558343880470209780000</span><span class="s2">, </span><span class="s3">24851882355348879230400</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">6797096028813368678400</span><span class="s2">, </span><span class="s3">843736746632215035600</span><span class="s2">],</span>
            <span class="s2">[-</span><span class="s3">2258997839280</span><span class="s2">, </span><span class="s3">600545887119360</span><span class="s2">, -</span><span class="s3">39732544853164800</span><span class="s2">,</span>
             <span class="s3">1153715376477081600</span><span class="s2">, -</span><span class="s3">18454939322943942000</span><span class="s2">, </span><span class="s3">183420385176741672960</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">1217424500995626443520</span><span class="s2">, </span><span class="s3">5649058909023744614400</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">18866974090684772052000</span><span class="s2">, </span><span class="s3">46141453390504792320000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">83243376594051600326400</span><span class="s2">, </span><span class="s3">110552468520163390156800</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">106681852579497947388000</span><span class="s2">, </span><span class="s3">72720410752415168870400</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">33177973900974346080000</span><span class="s2">, </span><span class="s3">9087761081682520473600</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">1129631016152221783200</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s3">2099709530100</span><span class="s2">, -</span><span class="s3">561522320049600</span><span class="s2">, </span><span class="s3">37341234283298400</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">1089119333262870000</span><span class="s2">, </span><span class="s3">17489975175339030000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">174433352415381259200</span><span class="s2">, </span><span class="s3">1161358898976091015200</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">5403874060541811254400</span><span class="s2">, </span><span class="s3">18093328327706957325000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">44349976506971935800000</span><span class="s2">, </span><span class="s3">80177044485212743068000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">106681852579497947388000</span><span class="s2">, </span><span class="s3">103125790826848015808400</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">70409051543137015800000</span><span class="s2">, </span><span class="s3">32171029219823375700000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">8824053728865840192000</span><span class="s2">, </span><span class="s3">1098252376814660067000</span><span class="s2">],</span>
            <span class="s2">[-</span><span class="s3">1384423866000</span><span class="s2">, </span><span class="s3">372133135180800</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">24857330514030000</span><span class="s2">, </span><span class="s3">727848632044800000</span><span class="s2">, -</span><span class="s3">11728977435138600000</span><span class="s2">,</span>
             <span class="s3">117339159519533952000</span><span class="s2">, -</span><span class="s3">783401860847777371200</span><span class="s2">,</span>
             <span class="s3">3654352703663101440000</span><span class="s2">, -</span><span class="s3">12263364009096700500000</span><span class="s2">,</span>
             <span class="s3">30121928988527376000000</span><span class="s2">, -</span><span class="s3">54558343880470209780000</span><span class="s2">,</span>
             <span class="s3">72720410752415168870400</span><span class="s2">, -</span><span class="s3">70409051543137015800000</span><span class="s2">,</span>
             <span class="s3">48142941226076592000000</span><span class="s2">, -</span><span class="s3">22027500987368499000000</span><span class="s2">,</span>
             <span class="s3">6049545098753157120000</span><span class="s2">, -</span><span class="s3">753830033789944188000</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s3">613101997800</span><span class="s2">, -</span><span class="s3">165537539406000</span><span class="s2">,</span>
             <span class="s3">11100752642520000</span><span class="s2">, -</span><span class="s3">326170262829600000</span><span class="s2">, </span><span class="s3">5272370630081100000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">52892422160973595200</span><span class="s2">, </span><span class="s3">354015418167362952000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">1655137020003255360000</span><span class="s2">, </span><span class="s3">5565847995255512250000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">13697025107665828500000</span><span class="s2">, </span><span class="s3">24851882355348879230400</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">33177973900974346080000</span><span class="s2">, </span><span class="s3">32171029219823375700000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">22027500987368499000000</span><span class="s2">, </span><span class="s3">10091416708498869000000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">2774765838662800128000</span><span class="s2">, </span><span class="s3">346146444087219270000</span><span class="s2">],</span>
            <span class="s2">[-</span><span class="s3">163493866080</span><span class="s2">, </span><span class="s3">44316454993920</span><span class="s2">, -</span><span class="s3">2982128117299200</span><span class="s2">,</span>
             <span class="s3">87894302404608000</span><span class="s2">, -</span><span class="s3">1424711708039692800</span><span class="s2">,</span>
             <span class="s3">14328529177999196160</span><span class="s2">, -</span><span class="s3">96120549902411274240</span><span class="s2">,</span>
             <span class="s3">450325202737117593600</span><span class="s2">, -</span><span class="s3">1517208935002984080000</span><span class="s2">,</span>
             <span class="s3">3740200989399948902400</span><span class="s2">, -</span><span class="s3">6797096028813368678400</span><span class="s2">,</span>
             <span class="s3">9087761081682520473600</span><span class="s2">, -</span><span class="s3">8824053728865840192000</span><span class="s2">,</span>
             <span class="s3">6049545098753157120000</span><span class="s2">, -</span><span class="s3">2774765838662800128000</span><span class="s2">,</span>
             <span class="s3">763806510427609497600</span><span class="s2">, -</span><span class="s3">95382575704033754400</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s3">19835652870</span><span class="s2">, -</span><span class="s3">5395297580640</span><span class="s2">, </span><span class="s3">364182586693200</span><span class="s2">, -</span><span class="s3">10763618673376800</span><span class="s2">,</span>
             <span class="s3">174908803442373000</span><span class="s2">, -</span><span class="s3">1763080738699119840</span><span class="s2">, </span><span class="s3">11851820521255194480</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">55630994283442749600</span><span class="s2">, </span><span class="s3">187754605706619279900</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">463591619028689580000</span><span class="s2">, </span><span class="s3">843736746632215035600</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">1129631016152221783200</span><span class="s2">, </span><span class="s3">1098252376814660067000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">753830033789944188000</span><span class="s2">, </span><span class="s3">346146444087219270000</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s3">95382575704033754400</span><span class="s2">, </span><span class="s3">11922821963004219300</span><span class="s2">]</span>
        <span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s3">17</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">), </span><span class="s1">invh17</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s3">17</span><span class="s2">), </span><span class="s1">invh17</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">float</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s3">1e-12</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_inverse</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s2">):</span>
            <span class="s1">a </span><span class="s2">= </span><span class="s1">hilbert</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>
            <span class="s1">b </span><span class="s2">= </span><span class="s1">invhilbert</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>
            <span class="s4"># The Hilbert matrix is increasingly badly conditioned,</span>
            <span class="s4"># so take that into account in the test</span>
            <span class="s1">c </span><span class="s2">= </span><span class="s1">cond</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s1">eye</span><span class="s2">(</span><span class="s1">n</span><span class="s2">), </span><span class="s1">atol</span><span class="s2">=</span><span class="s3">1e-15</span><span class="s2">*</span><span class="s1">c</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s3">1e-15</span><span class="s2">*</span><span class="s1">c</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestPascal</span><span class="s2">:</span>

    <span class="s1">cases </span><span class="s2">= [</span>
        <span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">]]), </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">]])),</span>
        <span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">]]),</span>
            <span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">]])),</span>
        <span class="s2">(</span><span class="s3">3</span><span class="s2">, </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">6</span><span class="s2">]]),</span>
            <span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">]])),</span>
        <span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">10</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">20</span><span class="s2">]]),</span>
            <span class="s1">array</span><span class="s2">([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s2">]])),</span>
    <span class="s2">]</span>

    <span class="s0">def </span><span class="s1">check_case</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">sym</span><span class="s2">, </span><span class="s1">low</span><span class="s2">):</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">pascal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">), </span><span class="s1">sym</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">pascal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s6">'lower'</span><span class="s2">), </span><span class="s1">low</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">pascal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s6">'upper'</span><span class="s2">), </span><span class="s1">low</span><span class="s2">.</span><span class="s1">T</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">pascal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">False</span><span class="s2">), </span><span class="s1">sym</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">pascal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s6">'lower'</span><span class="s2">), </span><span class="s1">low</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">pascal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s6">'upper'</span><span class="s2">), </span><span class="s1">low</span><span class="s2">.</span><span class="s1">T</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_cases</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">n</span><span class="s2">, </span><span class="s1">sym</span><span class="s2">, </span><span class="s1">low </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cases</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_case</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">sym</span><span class="s2">, </span><span class="s1">low</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_big</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">p </span><span class="s2">= </span><span class="s1">pascal</span><span class="s2">(</span><span class="s3">50</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">p</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">] == </span><span class="s1">comb</span><span class="s2">(</span><span class="s3">98</span><span class="s2">, </span><span class="s3">49</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_threshold</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Regression test.  An early version of `pascal` returned an</span>
        <span class="s4"># array of type np.uint64 for n=35, but that data type is too small</span>
        <span class="s4"># to hold p[-1, -1].  The second assert_equal below would fail</span>
        <span class="s4"># because p[-1, -1] overflowed.</span>
        <span class="s1">p </span><span class="s2">= </span><span class="s1">pascal</span><span class="s2">(</span><span class="s3">34</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s3">2</span><span class="s2">*</span><span class="s1">p</span><span class="s2">.</span><span class="s1">item</span><span class="s2">(-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">2</span><span class="s2">), </span><span class="s1">p</span><span class="s2">.</span><span class="s1">item</span><span class="s2">(-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">), </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s6">&quot;n = 34&quot;</span><span class="s2">)</span>
        <span class="s1">p </span><span class="s2">= </span><span class="s1">pascal</span><span class="s2">(</span><span class="s3">35</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s3">2.</span><span class="s2">*</span><span class="s1">p</span><span class="s2">.</span><span class="s1">item</span><span class="s2">(-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">2</span><span class="s2">), </span><span class="s3">1.</span><span class="s2">*</span><span class="s1">p</span><span class="s2">.</span><span class="s1">item</span><span class="s2">(-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">), </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s6">&quot;n = 35&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_invpascal</span><span class="s2">():</span>

    <span class="s0">def </span><span class="s1">check_invpascal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">):</span>
        <span class="s1">ip </span><span class="s2">= </span><span class="s1">invpascal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s1">kind</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s1">exact</span><span class="s2">)</span>
        <span class="s1">p </span><span class="s2">= </span><span class="s1">pascal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s1">kind</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s1">exact</span><span class="s2">)</span>
        <span class="s4"># Matrix-multiply ip and p, and check that we get the identity matrix.</span>
        <span class="s4"># We can't use the simple expression e = ip.dot(p), because when</span>
        <span class="s4"># n &lt; 35 and exact is True, p.dtype is np.uint64 and ip.dtype is</span>
        <span class="s4"># np.int64. The product of those dtypes is np.float64, which loses</span>
        <span class="s4"># precision when n is greater than 18.  Instead we'll cast both to</span>
        <span class="s4"># object arrays, and then multiply.</span>
        <span class="s1">e </span><span class="s2">= </span><span class="s1">ip</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">object</span><span class="s2">).</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">p</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">object</span><span class="s2">))</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">e</span><span class="s2">, </span><span class="s1">eye</span><span class="s2">(</span><span class="s1">n</span><span class="s2">), </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s6">&quot;n=%d  kind=%r exact=%r&quot; </span><span class="s2">%</span>
                                              <span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">))</span>

    <span class="s1">kinds </span><span class="s2">= [</span><span class="s6">'symmetric'</span><span class="s2">, </span><span class="s6">'lower'</span><span class="s2">, </span><span class="s6">'upper'</span><span class="s2">]</span>

    <span class="s1">ns </span><span class="s2">= [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">18</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">ns</span><span class="s2">:</span>
        <span class="s0">for </span><span class="s1">kind </span><span class="s0">in </span><span class="s1">kinds</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">exact </span><span class="s0">in </span><span class="s2">[</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">]:</span>
                <span class="s1">check_invpascal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">)</span>

    <span class="s1">ns </span><span class="s2">= [</span><span class="s3">19</span><span class="s2">, </span><span class="s3">34</span><span class="s2">, </span><span class="s3">35</span><span class="s2">, </span><span class="s3">50</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">ns</span><span class="s2">:</span>
        <span class="s0">for </span><span class="s1">kind </span><span class="s0">in </span><span class="s1">kinds</span><span class="s2">:</span>
            <span class="s1">check_invpascal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_dft</span><span class="s2">():</span>
    <span class="s1">m </span><span class="s2">= </span><span class="s1">dft</span><span class="s2">(</span><span class="s3">2</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">], [</span><span class="s3">1.0</span><span class="s2">, -</span><span class="s3">1.0</span><span class="s2">]])</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">m</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
    <span class="s1">m </span><span class="s2">= </span><span class="s1">dft</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s6">'n'</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">m</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">/</span><span class="s3">2.0</span><span class="s2">)</span>
    <span class="s1">m </span><span class="s2">= </span><span class="s1">dft</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s6">'sqrtn'</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">m</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">/</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s3">2.0</span><span class="s2">))</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">])</span>
    <span class="s1">m </span><span class="s2">= </span><span class="s1">dft</span><span class="s2">(</span><span class="s3">8</span><span class="s2">)</span>
    <span class="s1">mx </span><span class="s2">= </span><span class="s1">m</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">fx </span><span class="s2">= </span><span class="s1">fft</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">mx</span><span class="s2">, </span><span class="s1">fx</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_fiedler</span><span class="s2">():</span>
    <span class="s1">f </span><span class="s2">= </span><span class="s1">fiedler</span><span class="s2">([])</span>
    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">f</span><span class="s2">.</span><span class="s1">size</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>
    <span class="s1">f </span><span class="s2">= </span><span class="s1">fiedler</span><span class="s2">([</span><span class="s3">123.</span><span class="s2">])</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s3">0.</span><span class="s2">]]))</span>
    <span class="s1">f </span><span class="s2">= </span><span class="s1">fiedler</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s2">))</span>
    <span class="s1">des </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s3">4</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s3">5</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">]])</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">des</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_fiedler_companion</span><span class="s2">():</span>
    <span class="s1">fc </span><span class="s2">= </span><span class="s1">fiedler_companion</span><span class="s2">([])</span>
    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">fc</span><span class="s2">.</span><span class="s1">size</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>
    <span class="s1">fc </span><span class="s2">= </span><span class="s1">fiedler_companion</span><span class="s2">([</span><span class="s3">1.</span><span class="s2">])</span>
    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">fc</span><span class="s2">.</span><span class="s1">size</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>
    <span class="s1">fc </span><span class="s2">= </span><span class="s1">fiedler_companion</span><span class="s2">([</span><span class="s3">1.</span><span class="s2">, </span><span class="s3">2.</span><span class="s2">])</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">fc</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s3">2.</span><span class="s2">]]))</span>
    <span class="s1">fc </span><span class="s2">= </span><span class="s1">fiedler_companion</span><span class="s2">([</span><span class="s3">1e-12</span><span class="s2">, </span><span class="s3">2.</span><span class="s2">, </span><span class="s3">3.</span><span class="s2">])</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">fc</span><span class="s2">, </span><span class="s1">companion</span><span class="s2">([</span><span class="s3">1e-12</span><span class="s2">, </span><span class="s3">2.</span><span class="s2">, </span><span class="s3">3.</span><span class="s2">]))</span>
    <span class="s0">with </span><span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">fiedler_companion</span><span class="s2">([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">])</span>
    <span class="s1">fc </span><span class="s2">= </span><span class="s1">fiedler_companion</span><span class="s2">([</span><span class="s3">1.</span><span class="s2">, -</span><span class="s3">16.</span><span class="s2">, </span><span class="s3">86.</span><span class="s2">, -</span><span class="s3">176.</span><span class="s2">, </span><span class="s3">105.</span><span class="s2">])</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">eigvals</span><span class="s2">(</span><span class="s1">fc</span><span class="s2">),</span>
                              <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">7.</span><span class="s2">, </span><span class="s3">5.</span><span class="s2">, </span><span class="s3">3.</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">]))</span>


<span class="s0">class </span><span class="s1">TestConvolutionMatrix</span><span class="s2">:</span>
    <span class="s5">&quot;&quot;&quot; 
    Test convolution_matrix vs. numpy.convolve for various parameters. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">create_vector</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">cpx</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot;Make a complex or real test vector of length n.&quot;&quot;&quot;</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s3">2.5</span><span class="s2">, </span><span class="s3">2.2</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">cpx</span><span class="s2">:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">x </span><span class="s2">+ </span><span class="s3">1j</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">3.1</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">x</span>

    <span class="s0">def </span><span class="s1">test_bad_n</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># n must be a positive integer</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s6">'n must be a positive integer'</span><span class="s2">):</span>
            <span class="s1">convolution_matrix</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">], </span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bad_first_arg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># first arg must be a 1d array, otherwise ValueError</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s6">'one-dimensional'</span><span class="s2">):</span>
            <span class="s1">convolution_matrix</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">4</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_empty_first_arg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># first arg must have at least one value</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s6">r'len\(a\)'</span><span class="s2">):</span>
            <span class="s1">convolution_matrix</span><span class="s2">([], </span><span class="s3">4</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bad_mode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># mode must be in ('full', 'valid', 'same')</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s6">'mode.*must be one of'</span><span class="s2">):</span>
            <span class="s1">convolution_matrix</span><span class="s2">((</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">), </span><span class="s3">4</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s6">'invalid argument'</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s6">'cpx'</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s6">'na'</span><span class="s2">, [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">9</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s6">'nv'</span><span class="s2">, [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">9</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s6">'mode'</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">, </span><span class="s6">'full'</span><span class="s2">, </span><span class="s6">'valid'</span><span class="s2">, </span><span class="s6">'same'</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_against_numpy_convolve</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">cpx</span><span class="s2">, </span><span class="s1">na</span><span class="s2">, </span><span class="s1">nv</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">create_vector</span><span class="s2">(</span><span class="s1">na</span><span class="s2">, </span><span class="s1">cpx</span><span class="s2">)</span>
        <span class="s1">v </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">create_vector</span><span class="s2">(</span><span class="s1">nv</span><span class="s2">, </span><span class="s1">cpx</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">mode </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">y1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">convolve</span><span class="s2">(</span><span class="s1">v</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
            <span class="s1">A </span><span class="s2">= </span><span class="s1">convolution_matrix</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">nv</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">y1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">convolve</span><span class="s2">(</span><span class="s1">v</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">)</span>
            <span class="s1">A </span><span class="s2">= </span><span class="s1">convolution_matrix</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">nv</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">)</span>
        <span class="s1">y2 </span><span class="s2">= </span><span class="s1">A </span><span class="s2">@ </span><span class="s1">v</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">)</span>
</pre>
</body>
</html>