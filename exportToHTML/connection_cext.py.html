<html>
<head>
<title>connection_cext.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
connection_cext.py</font>
</center></td></tr></table>
<pre><span class="s0"># Copyright (c) 2014, 2024, Oracle and/or its affiliates.</span>
<span class="s0">#</span>
<span class="s0"># This program is free software; you can redistribute it and/or modify</span>
<span class="s0"># it under the terms of the GNU General Public License, version 2.0, as</span>
<span class="s0"># published by the Free Software Foundation.</span>
<span class="s0">#</span>
<span class="s0"># This program is designed to work with certain software (including</span>
<span class="s0"># but not limited to OpenSSL) that is licensed under separate terms,</span>
<span class="s0"># as designated in a particular file or component or in included license</span>
<span class="s0"># documentation. The authors of MySQL hereby grant you an</span>
<span class="s0"># additional permission to link the program and your derivative works</span>
<span class="s0"># with the separately licensed software that they have either included with</span>
<span class="s0"># the program or referenced in the documentation.</span>
<span class="s0">#</span>
<span class="s0"># Without limiting anything contained in the foregoing, this file,</span>
<span class="s0"># which is part of MySQL Connector/Python, is also subject to the</span>
<span class="s0"># Universal FOSS Exception, version 1.0, a copy of which can be found at</span>
<span class="s0"># http://oss.oracle.com/licenses/universal-foss-exception.</span>
<span class="s0">#</span>
<span class="s0"># This program is distributed in the hope that it will be useful, but</span>
<span class="s0"># WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="s0"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<span class="s0"># See the GNU General Public License, version 2.0, for more details.</span>
<span class="s0">#</span>
<span class="s0"># You should have received a copy of the GNU General Public License</span>
<span class="s0"># along with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="s0"># 51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA</span>

<span class="s0"># mypy: disable-error-code=&quot;arg-type&quot;</span>

<span class="s2">&quot;&quot;&quot;Connection class using the C Extension.&quot;&quot;&quot;</span>

<span class="s3">import </span><span class="s1">os</span>
<span class="s3">import </span><span class="s1">platform</span>
<span class="s3">import </span><span class="s1">socket</span>
<span class="s3">import </span><span class="s1">sys</span>

<span class="s3">from </span><span class="s1">typing </span><span class="s3">import </span><span class="s4">(</span>
    <span class="s1">Any</span><span class="s4">,</span>
    <span class="s1">BinaryIO</span><span class="s4">,</span>
    <span class="s1">Dict</span><span class="s4">,</span>
    <span class="s1">List</span><span class="s4">,</span>
    <span class="s1">NoReturn</span><span class="s4">,</span>
    <span class="s1">Optional</span><span class="s4">,</span>
    <span class="s1">Sequence</span><span class="s4">,</span>
    <span class="s1">Tuple</span><span class="s4">,</span>
    <span class="s1">Type</span><span class="s4">,</span>
    <span class="s1">Union</span><span class="s4">,</span>
<span class="s4">)</span>

<span class="s3">from </span><span class="s4">. </span><span class="s3">import </span><span class="s1">version</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">abstracts </span><span class="s3">import </span><span class="s1">CMySQLPrepStmt</span><span class="s4">, </span><span class="s1">MySQLConnectionAbstract</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">constants </span><span class="s3">import </span><span class="s4">(</span>
    <span class="s1">ClientFlag</span><span class="s4">,</span>
    <span class="s1">FieldFlag</span><span class="s4">,</span>
    <span class="s1">FieldType</span><span class="s4">,</span>
    <span class="s1">ServerFlag</span><span class="s4">,</span>
    <span class="s1">ShutdownType</span><span class="s4">,</span>
    <span class="s1">raise_warning_against_deprecated_cursor_class</span><span class="s4">,</span>
<span class="s4">)</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">conversion </span><span class="s3">import </span><span class="s1">MySQLConverter</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">errors </span><span class="s3">import </span><span class="s4">(</span>
    <span class="s1">InterfaceError</span><span class="s4">,</span>
    <span class="s1">InternalError</span><span class="s4">,</span>
    <span class="s1">OperationalError</span><span class="s4">,</span>
    <span class="s1">ProgrammingError</span><span class="s4">,</span>
    <span class="s1">get_mysql_exception</span><span class="s4">,</span>
<span class="s4">)</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">protocol </span><span class="s3">import </span><span class="s1">MySQLProtocol</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">types </span><span class="s3">import </span><span class="s4">(</span>
    <span class="s1">CextEofPacketType</span><span class="s4">,</span>
    <span class="s1">CextResultType</span><span class="s4">,</span>
    <span class="s1">DescriptionType</span><span class="s4">,</span>
    <span class="s1">ParamsSequenceOrDictType</span><span class="s4">,</span>
    <span class="s1">RowType</span><span class="s4">,</span>
    <span class="s1">StatsPacketType</span><span class="s4">,</span>
    <span class="s1">StrOrBytes</span><span class="s4">,</span>
<span class="s4">)</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">utils </span><span class="s3">import </span><span class="s4">(</span>
    <span class="s1">import_object</span><span class="s4">,</span>
    <span class="s1">warn_ciphersuites_deprecated</span><span class="s4">,</span>
    <span class="s1">warn_tls_version_deprecated</span><span class="s4">,</span>
<span class="s4">)</span>

<span class="s1">HAVE_CMYSQL </span><span class="s4">= </span><span class="s3">False</span>

<span class="s3">try</span><span class="s4">:</span>
    <span class="s3">import </span><span class="s1">_mysql_connector</span>

    <span class="s3">from </span><span class="s1">_mysql_connector </span><span class="s3">import </span><span class="s1">MySQLInterfaceError</span>

    <span class="s3">from </span><span class="s4">.</span><span class="s1">cursor_cext </span><span class="s3">import </span><span class="s4">(</span>
        <span class="s1">CMySQLCursor</span><span class="s4">,</span>
        <span class="s1">CMySQLCursorBuffered</span><span class="s4">,</span>
        <span class="s1">CMySQLCursorBufferedDict</span><span class="s4">,</span>
        <span class="s1">CMySQLCursorBufferedNamedTuple</span><span class="s4">,</span>
        <span class="s1">CMySQLCursorBufferedRaw</span><span class="s4">,</span>
        <span class="s1">CMySQLCursorDict</span><span class="s4">,</span>
        <span class="s1">CMySQLCursorNamedTuple</span><span class="s4">,</span>
        <span class="s1">CMySQLCursorPrepared</span><span class="s4">,</span>
        <span class="s1">CMySQLCursorPreparedDict</span><span class="s4">,</span>
        <span class="s1">CMySQLCursorPreparedNamedTuple</span><span class="s4">,</span>
        <span class="s1">CMySQLCursorPreparedRaw</span><span class="s4">,</span>
        <span class="s1">CMySQLCursorRaw</span><span class="s4">,</span>
    <span class="s4">)</span>

    <span class="s1">HAVE_CMYSQL </span><span class="s4">= </span><span class="s3">True</span>
<span class="s3">except </span><span class="s1">ImportError </span><span class="s3">as </span><span class="s1">exc</span><span class="s4">:</span>
    <span class="s3">raise </span><span class="s1">ImportError</span><span class="s4">(</span>
        <span class="s5">f&quot;MySQL Connector/Python C Extension not available (</span><span class="s3">{</span><span class="s1">exc</span><span class="s3">}</span><span class="s5">)&quot;</span>
    <span class="s4">) </span><span class="s3">from </span><span class="s1">exc</span>

<span class="s3">from </span><span class="s4">.</span><span class="s1">opentelemetry</span><span class="s4">.</span><span class="s1">constants </span><span class="s3">import </span><span class="s1">OTEL_ENABLED</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">opentelemetry</span><span class="s4">.</span><span class="s1">context_propagation </span><span class="s3">import </span><span class="s1">with_context_propagation</span>

<span class="s3">if </span><span class="s1">OTEL_ENABLED</span><span class="s4">:</span>
    <span class="s3">from </span><span class="s4">.</span><span class="s1">opentelemetry</span><span class="s4">.</span><span class="s1">instrumentation </span><span class="s3">import </span><span class="s1">end_span</span><span class="s4">, </span><span class="s1">record_exception_event</span>


<span class="s3">class </span><span class="s1">CMySQLConnection</span><span class="s4">(</span><span class="s1">MySQLConnectionAbstract</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Class initiating a MySQL Connection using Connector/C.&quot;&quot;&quot;</span>

    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">: </span><span class="s1">Any</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Initialization&quot;&quot;&quot;</span>
        <span class="s3">if not </span><span class="s1">HAVE_CMYSQL</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">RuntimeError</span><span class="s4">(</span><span class="s5">&quot;MySQL Connector/Python C Extension not available&quot;</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span>
            <span class="s1">_mysql_connector</span><span class="s4">.</span><span class="s1">MySQL  </span><span class="s0"># pylint: disable=c-extension-no-member</span>
        <span class="s4">] = </span><span class="s3">None</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_columns</span><span class="s4">: </span><span class="s1">List</span><span class="s4">[</span><span class="s1">DescriptionType</span><span class="s4">] = []</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_plugin_dir</span><span class="s4">: </span><span class="s1">str </span><span class="s4">= </span><span class="s1">os</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span>
            <span class="s1">os</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">dirname</span><span class="s4">(</span><span class="s1">os</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">abspath</span><span class="s4">(</span><span class="s1">_mysql_connector</span><span class="s4">.</span><span class="s1">__file__</span><span class="s4">)),</span>
            <span class="s5">&quot;mysql&quot;</span><span class="s4">,</span>
            <span class="s5">&quot;vendor&quot;</span><span class="s4">,</span>
            <span class="s5">&quot;plugin&quot;</span><span class="s4">,</span>
        <span class="s4">)</span>
        <span class="s3">if </span><span class="s1">platform</span><span class="s4">.</span><span class="s1">system</span><span class="s4">() == </span><span class="s5">&quot;Linux&quot;</span><span class="s4">:</span>
            <span class="s0"># Use the authentication plugins from system if they aren't bundled</span>
            <span class="s3">if not </span><span class="s1">os</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">exists</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_plugin_dir</span><span class="s4">):</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">_plugin_dir </span><span class="s4">= (</span>
                    <span class="s5">&quot;/usr/lib64/mysql/plugin&quot;</span>
                    <span class="s3">if </span><span class="s1">os</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">exists</span><span class="s4">(</span><span class="s5">&quot;/usr/lib64/mysql/plugin&quot;</span><span class="s4">)</span>
                    <span class="s3">else </span><span class="s5">&quot;/usr/lib/mysql/plugin&quot;</span>
                <span class="s4">)</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">MySQLConverter</span><span class="s4">] = </span><span class="s3">None</span>
        <span class="s1">super</span><span class="s4">().</span><span class="s1">__init__</span><span class="s4">()</span>

        <span class="s3">if </span><span class="s1">kwargs</span><span class="s4">:</span>
            <span class="s3">try</span><span class="s4">:</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">connect</span><span class="s4">(**</span><span class="s1">kwargs</span><span class="s4">)</span>
            <span class="s3">except </span><span class="s1">Exception</span><span class="s4">:</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">close</span><span class="s4">()</span>
                <span class="s3">raise</span>

    <span class="s3">def </span><span class="s1">_add_default_conn_attrs</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Add default connection attributes&quot;&quot;&quot;</span>
        <span class="s1">license_chunks </span><span class="s4">= </span><span class="s1">version</span><span class="s4">.</span><span class="s1">LICENSE</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s5">&quot; &quot;</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">license_chunks</span><span class="s4">[</span><span class="s6">0</span><span class="s4">] == </span><span class="s5">&quot;GPLv2&quot;</span><span class="s4">:</span>
            <span class="s1">client_license </span><span class="s4">= </span><span class="s5">&quot;GPL-2.0&quot;</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">client_license </span><span class="s4">= </span><span class="s5">&quot;Commercial&quot;</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">_conn_attrs</span><span class="s4">.</span><span class="s1">update</span><span class="s4">(</span>
            <span class="s4">{</span>
                <span class="s5">&quot;_connector_name&quot;</span><span class="s4">: </span><span class="s5">&quot;mysql-connector-python&quot;</span><span class="s4">,</span>
                <span class="s5">&quot;_connector_license&quot;</span><span class="s4">: </span><span class="s1">client_license</span><span class="s4">,</span>
                <span class="s5">&quot;_connector_version&quot;</span><span class="s4">: </span><span class="s5">&quot;.&quot;</span><span class="s4">.</span><span class="s1">join</span><span class="s4">([</span><span class="s1">str</span><span class="s4">(</span><span class="s1">x</span><span class="s4">) </span><span class="s3">for </span><span class="s1">x </span><span class="s3">in </span><span class="s1">version</span><span class="s4">.</span><span class="s1">VERSION</span><span class="s4">[</span><span class="s6">0</span><span class="s4">:</span><span class="s6">3</span><span class="s4">]]),</span>
                <span class="s5">&quot;_source_host&quot;</span><span class="s4">: </span><span class="s1">socket</span><span class="s4">.</span><span class="s1">gethostname</span><span class="s4">(),</span>
            <span class="s4">}</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">_do_handshake</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Gather information of the MySQL server before authentication&quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_handshake </span><span class="s4">= {</span>
            <span class="s5">&quot;protocol&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">get_proto_info</span><span class="s4">(),</span>
            <span class="s5">&quot;server_version_original&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">get_server_info</span><span class="s4">(),</span>
            <span class="s5">&quot;server_threadid&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">thread_id</span><span class="s4">(),</span>
            <span class="s5">&quot;charset&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
            <span class="s5">&quot;server_status&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
            <span class="s5">&quot;auth_plugin&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
            <span class="s5">&quot;auth_data&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
            <span class="s5">&quot;capabilities&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">st_server_capabilities</span><span class="s4">(),</span>
        <span class="s4">}</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">_server_version </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_check_server_version</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_handshake</span><span class="s4">[</span><span class="s5">&quot;server_version_original&quot;</span><span class="s4">]</span>
        <span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_character_set</span><span class="s4">.</span><span class="s1">set_mysql_version</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_server_version</span><span class="s4">)</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">_server_status</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; int</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Returns the server status attribute of MYSQL structure&quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">st_server_status</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">set_allow_local_infile_in_path</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">path</span><span class="s4">: </span><span class="s1">str</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;set local_infile_in_path 
 
        Set allow_local_infile_in_path. 
        &quot;&quot;&quot;</span>

        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">set_load_data_local_infile_option</span><span class="s4">(</span><span class="s1">path</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">set_unicode</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">value</span><span class="s4">: </span><span class="s1">bool </span><span class="s4">= </span><span class="s3">True</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Toggle unicode mode 
 
        Set whether we return string fields as unicode or not. 
        Default is True. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_use_unicode </span><span class="s4">= </span><span class="s1">value</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">use_unicode</span><span class="s4">(</span><span class="s1">value</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">.</span><span class="s1">set_unicode</span><span class="s4">(</span><span class="s1">value</span><span class="s4">)</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">autocommit</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; bool</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Get whether autocommit is on or off&quot;&quot;&quot;</span>
        <span class="s1">value </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">info_query</span><span class="s4">(</span><span class="s5">&quot;SELECT @@session.autocommit&quot;</span><span class="s4">)[</span><span class="s6">0</span><span class="s4">]</span>
        <span class="s3">return </span><span class="s1">value </span><span class="s4">== </span><span class="s6">1</span>

    <span class="s4">@</span><span class="s1">autocommit</span><span class="s4">.</span><span class="s1">setter</span>
    <span class="s3">def </span><span class="s1">autocommit</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">value</span><span class="s4">: </span><span class="s1">bool</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Toggle autocommit&quot;&quot;&quot;</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">autocommit</span><span class="s4">(</span><span class="s1">value</span><span class="s4">)</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_autocommit </span><span class="s4">= </span><span class="s1">value</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">get_mysql_exception</span><span class="s4">(</span>
                <span class="s1">msg</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">errno</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">errno</span><span class="s4">, </span><span class="s1">sqlstate</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">sqlstate</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">database</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; str</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Get the current database&quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">info_query</span><span class="s4">(</span><span class="s5">&quot;SELECT DATABASE()&quot;</span><span class="s4">)[</span><span class="s6">0</span><span class="s4">]  </span><span class="s0"># type: ignore[return-value]</span>

    <span class="s4">@</span><span class="s1">database</span><span class="s4">.</span><span class="s1">setter</span>
    <span class="s3">def </span><span class="s1">database</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">value</span><span class="s4">: </span><span class="s1">str</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Set the current database&quot;&quot;&quot;</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">select_db</span><span class="s4">(</span><span class="s1">value</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">get_mysql_exception</span><span class="s4">(</span>
                <span class="s1">msg</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">errno</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">errno</span><span class="s4">, </span><span class="s1">sqlstate</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">sqlstate</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">in_transaction</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; bool</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;MySQL session has started a transaction&quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">bool</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_server_status </span><span class="s4">&amp; </span><span class="s1">ServerFlag</span><span class="s4">.</span><span class="s1">STATUS_IN_TRANS</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">_open_connection</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s1">charset_name </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_character_set</span><span class="s4">.</span><span class="s1">get_info</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_charset_id</span><span class="s4">)[</span><span class="s6">0</span><span class="s4">]</span>
        <span class="s0"># pylint: disable=c-extension-no-member</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql </span><span class="s4">= </span><span class="s1">_mysql_connector</span><span class="s4">.</span><span class="s1">MySQL</span><span class="s4">(</span>
            <span class="s1">buffered</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_buffered</span><span class="s4">,</span>
            <span class="s1">raw</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_raw</span><span class="s4">,</span>
            <span class="s1">charset_name</span><span class="s4">=</span><span class="s1">charset_name</span><span class="s4">,</span>
            <span class="s1">connection_timeout</span><span class="s4">=(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_connection_timeout </span><span class="s3">or </span><span class="s6">0</span><span class="s4">),</span>
            <span class="s1">use_unicode</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_use_unicode</span><span class="s4">,</span>
            <span class="s1">auth_plugin</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_auth_plugin</span><span class="s4">,</span>
            <span class="s1">plugin_dir</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_plugin_dir</span><span class="s4">,</span>
        <span class="s4">)</span>
        <span class="s0"># pylint: enable=c-extension-no-member</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">isset_client_flag</span><span class="s4">(</span><span class="s1">ClientFlag</span><span class="s4">.</span><span class="s1">CONNECT_ARGS</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_conn_attrs </span><span class="s4">= {}</span>

        <span class="s1">cnx_kwargs </span><span class="s4">= {</span>
            <span class="s5">&quot;host&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_host</span><span class="s4">,</span>
            <span class="s5">&quot;user&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_user</span><span class="s4">,</span>
            <span class="s5">&quot;password&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_password</span><span class="s4">,</span>
            <span class="s5">&quot;password1&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_password1</span><span class="s4">,</span>
            <span class="s5">&quot;password2&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_password2</span><span class="s4">,</span>
            <span class="s5">&quot;password3&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_password3</span><span class="s4">,</span>
            <span class="s5">&quot;database&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_database</span><span class="s4">,</span>
            <span class="s5">&quot;port&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_port</span><span class="s4">,</span>
            <span class="s5">&quot;client_flags&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_client_flags</span><span class="s4">,</span>
            <span class="s5">&quot;unix_socket&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_unix_socket</span><span class="s4">,</span>
            <span class="s5">&quot;compress&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_compress</span><span class="s4">,</span>
            <span class="s5">&quot;ssl_disabled&quot;</span><span class="s4">: </span><span class="s3">True</span><span class="s4">,</span>
            <span class="s5">&quot;conn_attrs&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_conn_attrs</span><span class="s4">,</span>
            <span class="s5">&quot;local_infile&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_allow_local_infile</span><span class="s4">,</span>
            <span class="s5">&quot;load_data_local_dir&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_allow_local_infile_in_path</span><span class="s4">,</span>
            <span class="s5">&quot;oci_config_file&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_oci_config_file</span><span class="s4">,</span>
            <span class="s5">&quot;oci_config_profile&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_oci_config_profile</span><span class="s4">,</span>
            <span class="s5">&quot;webauthn_callback&quot;</span><span class="s4">: (</span>
                <span class="s1">import_object</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_webauthn_callback</span><span class="s4">)</span>
                <span class="s3">if </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_webauthn_callback</span><span class="s4">, </span><span class="s1">str</span><span class="s4">)</span>
                <span class="s3">else </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_webauthn_callback</span>
            <span class="s4">),</span>
        <span class="s4">}</span>

        <span class="s1">tls_versions </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;tls_versions&quot;</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">tls_versions </span><span class="s3">is not None</span><span class="s4">:</span>
            <span class="s1">tls_versions</span><span class="s4">.</span><span class="s1">sort</span><span class="s4">(</span><span class="s1">reverse</span><span class="s4">=</span><span class="s3">True</span><span class="s4">)  </span><span class="s0"># type: ignore[union-attr]</span>
            <span class="s1">tls_versions </span><span class="s4">= </span><span class="s5">&quot;,&quot;</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">tls_versions</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;tls_ciphersuites&quot;</span><span class="s4">) </span><span class="s3">is not None</span><span class="s4">:</span>
            <span class="s1">ssl_ciphersuites </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;tls_ciphersuites&quot;</span><span class="s4">)[  </span><span class="s0"># type: ignore[index]</span>
                <span class="s6">0</span>
            <span class="s4">]</span>
            <span class="s1">tls_ciphersuites </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;tls_ciphersuites&quot;</span><span class="s4">)[  </span><span class="s0"># type: ignore[index]</span>
                <span class="s6">1</span>
            <span class="s4">]</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">ssl_ciphersuites </span><span class="s4">= </span><span class="s3">None</span>
            <span class="s1">tls_ciphersuites </span><span class="s4">= </span><span class="s3">None</span>
        <span class="s3">if </span><span class="s4">(</span>
            <span class="s1">tls_versions </span><span class="s3">is not None</span>
            <span class="s3">and </span><span class="s5">&quot;TLSv1.3&quot; </span><span class="s3">in </span><span class="s1">tls_versions</span>
            <span class="s3">and not </span><span class="s1">tls_ciphersuites</span>
        <span class="s4">):</span>
            <span class="s1">tls_ciphersuites </span><span class="s4">= </span><span class="s5">&quot;TLS_AES_256_GCM_SHA384&quot;</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl_disabled</span><span class="s4">:</span>
            <span class="s1">cnx_kwargs</span><span class="s4">.</span><span class="s1">update</span><span class="s4">(</span>
                <span class="s4">{</span>
                    <span class="s5">&quot;ssl_ca&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;ca&quot;</span><span class="s4">),</span>
                    <span class="s5">&quot;ssl_cert&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;cert&quot;</span><span class="s4">),</span>
                    <span class="s5">&quot;ssl_key&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;key&quot;</span><span class="s4">),</span>
                    <span class="s5">&quot;ssl_cipher_suites&quot;</span><span class="s4">: </span><span class="s1">ssl_ciphersuites</span><span class="s4">,</span>
                    <span class="s5">&quot;tls_versions&quot;</span><span class="s4">: </span><span class="s1">tls_versions</span><span class="s4">,</span>
                    <span class="s5">&quot;tls_cipher_suites&quot;</span><span class="s4">: </span><span class="s1">tls_ciphersuites</span><span class="s4">,</span>
                    <span class="s5">&quot;ssl_verify_cert&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;verify_cert&quot;</span><span class="s4">) </span><span class="s3">or False</span><span class="s4">,</span>
                    <span class="s5">&quot;ssl_verify_identity&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;verify_identity&quot;</span><span class="s4">) </span><span class="s3">or False</span><span class="s4">,</span>
                    <span class="s5">&quot;ssl_disabled&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl_disabled</span><span class="s4">,</span>
                <span class="s4">}</span>
            <span class="s4">)</span>

        <span class="s3">if </span><span class="s1">os</span><span class="s4">.</span><span class="s1">name </span><span class="s4">== </span><span class="s5">&quot;nt&quot; </span><span class="s3">and </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_auth_plugin_class </span><span class="s4">== </span><span class="s5">&quot;MySQLKerberosAuthPlugin&quot;</span><span class="s4">:</span>
            <span class="s1">cnx_kwargs</span><span class="s4">[</span><span class="s5">&quot;use_kerberos_gssapi&quot;</span><span class="s4">] = </span><span class="s3">True</span>

        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">connect</span><span class="s4">(**</span><span class="s1">cnx_kwargs</span><span class="s4">)</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">converter_str_fallback </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_converter_str_fallback</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">:</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">.</span><span class="s1">str_fallback </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_converter_str_fallback</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">get_mysql_exception</span><span class="s4">(</span>
                <span class="s1">msg</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">errno</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">errno</span><span class="s4">, </span><span class="s1">sqlstate</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">sqlstate</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">_do_handshake</span><span class="s4">()</span>

        <span class="s3">if </span><span class="s4">(</span>
            <span class="s3">not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl_disabled</span>
            <span class="s3">and </span><span class="s1">hasattr</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">, </span><span class="s5">&quot;get_ssl_cipher&quot;</span><span class="s4">)</span>
            <span class="s3">and </span><span class="s1">callable</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">get_ssl_cipher</span><span class="s4">)</span>
        <span class="s4">):</span>
            <span class="s0"># Raise a deprecation warning if deprecated TLS version</span>
            <span class="s0"># or cipher is being used.</span>

            <span class="s0"># `get_ssl_cipher()` returns the name of the cipher being used.</span>
            <span class="s1">cipher </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">get_ssl_cipher</span><span class="s4">()</span>
            <span class="s3">for </span><span class="s1">tls_version </span><span class="s3">in </span><span class="s1">set</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_ssl</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;tls_versions&quot;</span><span class="s4">, [])):</span>
                <span class="s1">warn_tls_version_deprecated</span><span class="s4">(</span><span class="s1">tls_version</span><span class="s4">)</span>
                <span class="s1">warn_ciphersuites_deprecated</span><span class="s4">(</span><span class="s1">cipher</span><span class="s4">, </span><span class="s1">tls_version</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">close</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Disconnect from the MySQL server&quot;&quot;&quot;</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_span </span><span class="s3">and </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_span</span><span class="s4">.</span><span class="s1">is_recording</span><span class="s4">():</span>
            <span class="s0"># pylint: disable=possibly-used-before-assignment</span>
            <span class="s1">record_exception_event</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_span</span><span class="s4">, </span><span class="s1">sys</span><span class="s4">.</span><span class="s1">exc_info</span><span class="s4">()[</span><span class="s6">1</span><span class="s4">])</span>

        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s3">return</span>

        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">free_result</span><span class="s4">()</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">close</span><span class="s4">()</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s1">OTEL_ENABLED</span><span class="s4">:</span>
                <span class="s1">record_exception_event</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_span</span><span class="s4">, </span><span class="s1">err</span><span class="s4">)</span>
            <span class="s3">raise </span><span class="s1">get_mysql_exception</span><span class="s4">(</span>
                <span class="s1">msg</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">errno</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">errno</span><span class="s4">, </span><span class="s1">sqlstate</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">sqlstate</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>
        <span class="s3">finally</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s1">OTEL_ENABLED</span><span class="s4">:</span>
                <span class="s1">end_span</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_span</span><span class="s4">)</span>

    <span class="s1">disconnect </span><span class="s4">= </span><span class="s1">close</span>

    <span class="s3">def </span><span class="s1">is_closed</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; bool</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Return True if the connection to MySQL Server is closed.&quot;&quot;&quot;</span>
        <span class="s3">return not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">connected</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">is_connected</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; bool</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Reports whether the connection to MySQL Server is available&quot;&quot;&quot;</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">handle_unread_result</span><span class="s4">()</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">ping</span><span class="s4">()</span>

        <span class="s3">return False</span>

    <span class="s3">def </span><span class="s1">ping</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">reconnect</span><span class="s4">: </span><span class="s1">bool </span><span class="s4">= </span><span class="s3">False</span><span class="s4">, </span><span class="s1">attempts</span><span class="s4">: </span><span class="s1">int </span><span class="s4">= </span><span class="s6">1</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">: </span><span class="s1">int </span><span class="s4">= </span><span class="s6">0</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Check availability of the MySQL server 
 
        When reconnect is set to True, one or more attempts are made to try 
        to reconnect to the MySQL server using the reconnect()-method. 
 
        delay is the number of seconds to wait between each retry. 
 
        When the connection is not available, an InterfaceError is raised. Use 
        the is_connected()-method if you just want to check the connection 
        without raising an error. 
 
        Raises InterfaceError on errors. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">handle_unread_result</span><span class="s4">()</span>

        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">connected </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">ping</span><span class="s4">()</span>
        <span class="s3">except </span><span class="s1">AttributeError</span><span class="s4">:</span>
            <span class="s3">pass  </span><span class="s0"># Raise or reconnect later</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s1">connected</span><span class="s4">:</span>
                <span class="s3">return</span>

        <span class="s3">if </span><span class="s1">reconnect</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">reconnect</span><span class="s4">(</span><span class="s1">attempts</span><span class="s4">=</span><span class="s1">attempts</span><span class="s4">, </span><span class="s1">delay</span><span class="s4">=</span><span class="s1">delay</span><span class="s4">)</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">InterfaceError</span><span class="s4">(</span><span class="s5">&quot;Connection to MySQL is not available&quot;</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">set_character_set_name</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">charset</span><span class="s4">: </span><span class="s1">str</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Sets the default character set name for current connection.&quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">set_character_set</span><span class="s4">(</span><span class="s1">charset</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">info_query</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">query</span><span class="s4">: </span><span class="s1">StrOrBytes</span><span class="s4">) </span><span class="s1">-&gt; Optional</span><span class="s4">[</span><span class="s1">RowType</span><span class="s4">]:</span>
        <span class="s2">&quot;&quot;&quot;Send a query which only returns 1 row&quot;&quot;&quot;</span>
        <span class="s1">first_row </span><span class="s4">= ()</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">query</span><span class="s4">(</span><span class="s1">query</span><span class="s4">)</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">have_result_set</span><span class="s4">:</span>
                <span class="s1">first_row </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">fetch_row</span><span class="s4">()</span>
                <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">fetch_row</span><span class="s4">():</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">free_result</span><span class="s4">()</span>
                    <span class="s3">raise </span><span class="s1">InterfaceError</span><span class="s4">(</span><span class="s5">&quot;Query should not return more than 1 row&quot;</span><span class="s4">)</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">free_result</span><span class="s4">()</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">get_mysql_exception</span><span class="s4">(</span>
                <span class="s1">msg</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">errno</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">errno</span><span class="s4">, </span><span class="s1">sqlstate</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">sqlstate</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>

        <span class="s3">return </span><span class="s1">first_row</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">connection_id</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; Optional</span><span class="s4">[</span><span class="s1">int</span><span class="s4">]:</span>
        <span class="s2">&quot;&quot;&quot;MySQL connection ID&quot;&quot;&quot;</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">thread_id</span><span class="s4">()</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError</span><span class="s4">:</span>
            <span class="s3">pass  </span><span class="s0"># Just return None</span>

        <span class="s3">return None</span>

    <span class="s3">def </span><span class="s1">get_rows</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">count</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">int</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">binary</span><span class="s4">: </span><span class="s1">bool </span><span class="s4">= </span><span class="s3">False</span><span class="s4">,</span>
        <span class="s1">columns</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">List</span><span class="s4">[</span><span class="s1">DescriptionType</span><span class="s4">]] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">raw</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">bool</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">prep_stmt</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">CMySQLPrepStmt</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">) </span><span class="s1">-&gt; Tuple</span><span class="s4">[</span><span class="s1">List</span><span class="s4">[</span><span class="s1">RowType</span><span class="s4">], </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">CextEofPacketType</span><span class="s4">]]:</span>
        <span class="s2">&quot;&quot;&quot;Get all or a subset of rows returned by the MySQL server&quot;&quot;&quot;</span>
        <span class="s1">unread_result </span><span class="s4">= </span><span class="s1">prep_stmt</span><span class="s4">.</span><span class="s1">have_result_set </span><span class="s3">if </span><span class="s1">prep_stmt </span><span class="s3">else </span><span class="s1">self</span><span class="s4">.</span><span class="s1">unread_result</span>
        <span class="s3">if not </span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql </span><span class="s3">and </span><span class="s1">unread_result</span><span class="s4">):</span>
            <span class="s3">raise </span><span class="s1">InternalError</span><span class="s4">(</span><span class="s5">&quot;No result set available&quot;</span><span class="s4">)</span>

        <span class="s3">if </span><span class="s1">raw </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s1">raw </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_raw</span>

        <span class="s1">rows</span><span class="s4">: </span><span class="s1">List</span><span class="s4">[</span><span class="s1">Tuple</span><span class="s4">] = []</span>
        <span class="s3">if </span><span class="s1">count </span><span class="s3">is not None and </span><span class="s1">count </span><span class="s4">&lt;= </span><span class="s6">0</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">AttributeError</span><span class="s4">(</span><span class="s5">&quot;count should be 1 or higher, or None&quot;</span><span class="s4">)</span>

        <span class="s1">counter </span><span class="s4">= </span><span class="s6">0</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">fetch_row </span><span class="s4">= </span><span class="s1">prep_stmt</span><span class="s4">.</span><span class="s1">fetch_row </span><span class="s3">if </span><span class="s1">prep_stmt </span><span class="s3">else </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">fetch_row</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">:</span>
                <span class="s0"># When using a converter class, the C extension should not</span>
                <span class="s0"># convert the values. This can be accomplished by setting</span>
                <span class="s0"># the raw option to True.</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">raw</span><span class="s4">(</span><span class="s3">True</span><span class="s4">)</span>

            <span class="s1">row </span><span class="s4">= </span><span class="s1">fetch_row</span><span class="s4">()</span>
            <span class="s3">while </span><span class="s1">row</span><span class="s4">:</span>
                <span class="s1">row </span><span class="s4">= </span><span class="s1">list</span><span class="s4">(</span><span class="s1">row</span><span class="s4">)</span>

                <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">raw</span><span class="s4">() </span><span class="s3">and not </span><span class="s1">raw</span><span class="s4">:</span>
                    <span class="s0"># `not _cmysql.raw()` means the c-ext conversion layer will happen.</span>
                    <span class="s0"># `not raw` means the caller wants conversion to happen.</span>
                    <span class="s0"># For a VECTOR type, the c-ext conversion layer cannot return</span>
                    <span class="s0"># an array.array type since such a type isn't part of the Python/C</span>
                    <span class="s0"># API. Therefore, the c-ext will treat VECTOR types as if they</span>
                    <span class="s0"># were BLOB types - be returned as `bytes` always.</span>
                    <span class="s0"># Hence, a VECTOR type must be cast to an array.array type using the</span>
                    <span class="s0"># built-in python conversion layer.</span>
                    <span class="s0"># pylint: disable=protected-access</span>
                    <span class="s3">for </span><span class="s1">i</span><span class="s4">, </span><span class="s1">dsc </span><span class="s3">in </span><span class="s1">enumerate</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_columns</span><span class="s4">):</span>
                        <span class="s3">if </span><span class="s1">dsc</span><span class="s4">[</span><span class="s6">1</span><span class="s4">] == </span><span class="s1">FieldType</span><span class="s4">.</span><span class="s1">VECTOR</span><span class="s4">:</span>
                            <span class="s1">row</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] = </span><span class="s1">MySQLConverter</span><span class="s4">.</span><span class="s1">_vector_to_python</span><span class="s4">(</span><span class="s1">row</span><span class="s4">[</span><span class="s1">i</span><span class="s4">])</span>

                <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_raw </span><span class="s3">and </span><span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">:</span>
                    <span class="s3">for </span><span class="s1">i</span><span class="s4">, </span><span class="s1">_ </span><span class="s3">in </span><span class="s1">enumerate</span><span class="s4">(</span><span class="s1">row</span><span class="s4">):</span>
                        <span class="s3">if not </span><span class="s1">raw</span><span class="s4">:</span>
                            <span class="s1">row</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] = </span><span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">.</span><span class="s1">to_python</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_columns</span><span class="s4">[</span><span class="s1">i</span><span class="s4">], </span><span class="s1">row</span><span class="s4">[</span><span class="s1">i</span><span class="s4">])</span>

                <span class="s1">rows</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span><span class="s1">tuple</span><span class="s4">(</span><span class="s1">row</span><span class="s4">))</span>
                <span class="s1">counter </span><span class="s4">+= </span><span class="s6">1</span>

                <span class="s3">if </span><span class="s1">count </span><span class="s3">and </span><span class="s1">counter </span><span class="s4">== </span><span class="s1">count</span><span class="s4">:</span>
                    <span class="s3">break</span>

                <span class="s1">row </span><span class="s4">= </span><span class="s1">fetch_row</span><span class="s4">()</span>
            <span class="s3">if not </span><span class="s1">row</span><span class="s4">:</span>
                <span class="s1">_eof</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">CextEofPacketType</span><span class="s4">] = </span><span class="s1">self</span><span class="s4">.</span><span class="s1">fetch_eof_columns</span><span class="s4">(</span><span class="s1">prep_stmt</span><span class="s4">)[</span>
                    <span class="s5">&quot;eof&quot;</span>
                <span class="s4">]  </span><span class="s0"># type: ignore[assignment]</span>
                <span class="s3">if </span><span class="s1">prep_stmt</span><span class="s4">:</span>
                    <span class="s1">prep_stmt</span><span class="s4">.</span><span class="s1">free_result</span><span class="s4">()</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_unread_result </span><span class="s4">= </span><span class="s3">False</span>
                <span class="s3">else</span><span class="s4">:</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">free_result</span><span class="s4">()</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s1">_eof </span><span class="s4">= </span><span class="s3">None</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s1">prep_stmt</span><span class="s4">:</span>
                <span class="s1">prep_stmt</span><span class="s4">.</span><span class="s1">free_result</span><span class="s4">()</span>
                <span class="s3">raise </span><span class="s1">InterfaceError</span><span class="s4">(</span><span class="s1">str</span><span class="s4">(</span><span class="s1">err</span><span class="s4">)) </span><span class="s3">from </span><span class="s1">err</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">free_result</span><span class="s4">()</span>
            <span class="s3">raise </span><span class="s1">get_mysql_exception</span><span class="s4">(</span>
                <span class="s1">msg</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">errno</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">errno</span><span class="s4">, </span><span class="s1">sqlstate</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">sqlstate</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>

        <span class="s3">return </span><span class="s1">rows</span><span class="s4">, </span><span class="s1">_eof</span>

    <span class="s3">def </span><span class="s1">get_row</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">binary</span><span class="s4">: </span><span class="s1">bool </span><span class="s4">= </span><span class="s3">False</span><span class="s4">,</span>
        <span class="s1">columns</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">List</span><span class="s4">[</span><span class="s1">DescriptionType</span><span class="s4">]] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">raw</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">bool</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">prep_stmt</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">CMySQLPrepStmt</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">) </span><span class="s1">-&gt; Tuple</span><span class="s4">[</span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">RowType</span><span class="s4">], </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">CextEofPacketType</span><span class="s4">]]:</span>
        <span class="s2">&quot;&quot;&quot;Get the next rows returned by the MySQL server&quot;&quot;&quot;</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">rows</span><span class="s4">, </span><span class="s1">eof </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_rows</span><span class="s4">(</span>
                <span class="s1">count</span><span class="s4">=</span><span class="s6">1</span><span class="s4">,</span>
                <span class="s1">binary</span><span class="s4">=</span><span class="s1">binary</span><span class="s4">,</span>
                <span class="s1">columns</span><span class="s4">=</span><span class="s1">columns</span><span class="s4">,</span>
                <span class="s1">raw</span><span class="s4">=</span><span class="s1">raw</span><span class="s4">,</span>
                <span class="s1">prep_stmt</span><span class="s4">=</span><span class="s1">prep_stmt</span><span class="s4">,</span>
            <span class="s4">)</span>
            <span class="s3">if </span><span class="s1">rows</span><span class="s4">:</span>
                <span class="s3">return </span><span class="s4">(</span><span class="s1">rows</span><span class="s4">[</span><span class="s6">0</span><span class="s4">], </span><span class="s1">eof</span><span class="s4">)</span>
            <span class="s3">return </span><span class="s4">(</span><span class="s3">None</span><span class="s4">, </span><span class="s1">eof</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">IndexError</span><span class="s4">:</span>
            <span class="s0"># No row available</span>
            <span class="s3">return </span><span class="s4">(</span><span class="s3">None</span><span class="s4">, </span><span class="s3">None</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">next_result</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; Optional</span><span class="s4">[</span><span class="s1">bool</span><span class="s4">]:</span>
        <span class="s2">&quot;&quot;&quot;Reads the next result&quot;&quot;&quot;</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">consume_result</span><span class="s4">()</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">next_result</span><span class="s4">()</span>
        <span class="s3">return None</span>

    <span class="s3">def </span><span class="s1">free_result</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Frees the result&quot;&quot;&quot;</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">free_result</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">commit</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Commit current transaction&quot;&quot;&quot;</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">handle_unread_result</span><span class="s4">()</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">commit</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">rollback</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Rollback current transaction&quot;&quot;&quot;</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">consume_result</span><span class="s4">()</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">rollback</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">cmd_init_db</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">database</span><span class="s4">: </span><span class="s1">str</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Change the current database&quot;&quot;&quot;</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">select_db</span><span class="s4">(</span><span class="s1">database</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">get_mysql_exception</span><span class="s4">(</span>
                <span class="s1">msg</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">errno</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">errno</span><span class="s4">, </span><span class="s1">sqlstate</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">sqlstate</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>

    <span class="s3">def </span><span class="s1">fetch_eof_columns</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">, </span><span class="s1">prep_stmt</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">CMySQLPrepStmt</span><span class="s4">] = </span><span class="s3">None</span>
    <span class="s4">) </span><span class="s1">-&gt; CextResultType</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Fetch EOF and column information&quot;&quot;&quot;</span>
        <span class="s1">have_result_set </span><span class="s4">= (</span>
            <span class="s1">prep_stmt</span><span class="s4">.</span><span class="s1">have_result_set </span><span class="s3">if </span><span class="s1">prep_stmt </span><span class="s3">else </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">have_result_set</span>
        <span class="s4">)</span>
        <span class="s3">if not </span><span class="s1">have_result_set</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">InterfaceError</span><span class="s4">(</span><span class="s5">&quot;No result set&quot;</span><span class="s4">)</span>

        <span class="s1">fields </span><span class="s4">= </span><span class="s1">prep_stmt</span><span class="s4">.</span><span class="s1">fetch_fields</span><span class="s4">() </span><span class="s3">if </span><span class="s1">prep_stmt </span><span class="s3">else </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">fetch_fields</span><span class="s4">()</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_columns </span><span class="s4">= []</span>
        <span class="s3">for </span><span class="s1">col </span><span class="s3">in </span><span class="s1">fields</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_columns</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span>
                <span class="s4">(</span>
                    <span class="s1">col</span><span class="s4">[</span><span class="s6">4</span><span class="s4">],</span>
                    <span class="s1">int</span><span class="s4">(</span><span class="s1">col</span><span class="s4">[</span><span class="s6">8</span><span class="s4">]),</span>
                    <span class="s3">None</span><span class="s4">,</span>
                    <span class="s3">None</span><span class="s4">,</span>
                    <span class="s3">None</span><span class="s4">,</span>
                    <span class="s3">None</span><span class="s4">,</span>
                    <span class="s4">~</span><span class="s1">int</span><span class="s4">(</span><span class="s1">col</span><span class="s4">[</span><span class="s6">9</span><span class="s4">]) &amp; </span><span class="s1">FieldFlag</span><span class="s4">.</span><span class="s1">NOT_NULL</span><span class="s4">,</span>
                    <span class="s1">int</span><span class="s4">(</span><span class="s1">col</span><span class="s4">[</span><span class="s6">9</span><span class="s4">]),</span>
                    <span class="s1">int</span><span class="s4">(</span><span class="s1">col</span><span class="s4">[</span><span class="s6">6</span><span class="s4">]),</span>
                <span class="s4">)</span>
            <span class="s4">)</span>

        <span class="s3">return </span><span class="s4">{</span>
            <span class="s5">&quot;eof&quot;</span><span class="s4">: {</span>
                <span class="s5">&quot;status_flag&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_server_status</span><span class="s4">,</span>
                <span class="s5">&quot;warning_count&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">st_warning_count</span><span class="s4">(),</span>
            <span class="s4">},</span>
            <span class="s5">&quot;columns&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_columns</span><span class="s4">,</span>
        <span class="s4">}</span>

    <span class="s3">def </span><span class="s1">fetch_eof_status</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; Optional</span><span class="s4">[</span><span class="s1">CextEofPacketType</span><span class="s4">]:</span>
        <span class="s2">&quot;&quot;&quot;Fetch EOF and status information&quot;&quot;&quot;</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s4">{</span>
                <span class="s5">&quot;warning_count&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">st_warning_count</span><span class="s4">(),</span>
                <span class="s5">&quot;field_count&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">st_field_count</span><span class="s4">(),</span>
                <span class="s5">&quot;insert_id&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">insert_id</span><span class="s4">(),</span>
                <span class="s5">&quot;affected_rows&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">affected_rows</span><span class="s4">(),</span>
                <span class="s5">&quot;server_status&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_server_status</span><span class="s4">,</span>
            <span class="s4">}</span>

        <span class="s3">return None</span>

    <span class="s3">def </span><span class="s1">cmd_stmt_prepare</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">statement</span><span class="s4">: </span><span class="s1">bytes</span><span class="s4">) </span><span class="s1">-&gt; CMySQLPrepStmt</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Prepares the SQL statement&quot;&quot;&quot;</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">OperationalError</span><span class="s4">(</span><span class="s5">&quot;MySQL Connection not available&quot;</span><span class="s4">)</span>

        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">stmt </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">stmt_prepare</span><span class="s4">(</span><span class="s1">statement</span><span class="s4">)</span>
            <span class="s1">stmt</span><span class="s4">.</span><span class="s1">converter_str_fallback </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_converter_str_fallback</span>
            <span class="s3">return </span><span class="s1">CMySQLPrepStmt</span><span class="s4">(</span><span class="s1">stmt</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">InterfaceError</span><span class="s4">(</span><span class="s1">str</span><span class="s4">(</span><span class="s1">err</span><span class="s4">)) </span><span class="s3">from </span><span class="s1">err</span>

    <span class="s4">@</span><span class="s1">with_context_propagation</span>
    <span class="s3">def </span><span class="s1">cmd_stmt_execute</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">, </span><span class="s1">statement_id</span><span class="s4">: </span><span class="s1">CMySQLPrepStmt</span><span class="s4">, *</span><span class="s1">args</span><span class="s4">: </span><span class="s1">Any</span>
    <span class="s4">) </span><span class="s1">-&gt; Optional</span><span class="s4">[</span><span class="s1">Union</span><span class="s4">[</span><span class="s1">CextEofPacketType</span><span class="s4">, </span><span class="s1">CextResultType</span><span class="s4">]]:</span>
        <span class="s2">&quot;&quot;&quot;Executes the prepared statement&quot;&quot;&quot;</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">statement_id</span><span class="s4">.</span><span class="s1">stmt_execute</span><span class="s4">(*</span><span class="s1">args</span><span class="s4">, </span><span class="s1">query_attrs</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">query_attrs</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">InterfaceError</span><span class="s4">(</span><span class="s1">str</span><span class="s4">(</span><span class="s1">err</span><span class="s4">)) </span><span class="s3">from </span><span class="s1">err</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">_columns </span><span class="s4">= []</span>
        <span class="s3">if not </span><span class="s1">statement_id</span><span class="s4">.</span><span class="s1">have_result_set</span><span class="s4">:</span>
            <span class="s0"># No result</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_unread_result </span><span class="s4">= </span><span class="s3">False</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">fetch_eof_status</span><span class="s4">()</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">_unread_result </span><span class="s4">= </span><span class="s3">True</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">fetch_eof_columns</span><span class="s4">(</span><span class="s1">statement_id</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">cmd_stmt_close</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">statement_id</span><span class="s4">: </span><span class="s1">CMySQLPrepStmt</span><span class="s4">,  </span><span class="s0"># type: ignore[override]</span>
    <span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Closes the prepared statement&quot;&quot;&quot;</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_unread_result</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">InternalError</span><span class="s4">(</span><span class="s5">&quot;Unread result found&quot;</span><span class="s4">)</span>
        <span class="s1">statement_id</span><span class="s4">.</span><span class="s1">stmt_close</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">cmd_stmt_reset</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">statement_id</span><span class="s4">: </span><span class="s1">CMySQLPrepStmt</span><span class="s4">,  </span><span class="s0"># type: ignore[override]</span>
    <span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Resets the prepared statement&quot;&quot;&quot;</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_unread_result</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">InternalError</span><span class="s4">(</span><span class="s5">&quot;Unread result found&quot;</span><span class="s4">)</span>
        <span class="s1">statement_id</span><span class="s4">.</span><span class="s1">stmt_reset</span><span class="s4">()</span>

    <span class="s4">@</span><span class="s1">with_context_propagation</span>
    <span class="s3">def </span><span class="s1">cmd_query</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">query</span><span class="s4">: </span><span class="s1">StrOrBytes</span><span class="s4">,</span>
        <span class="s1">raw</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">bool</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">buffered</span><span class="s4">: </span><span class="s1">bool </span><span class="s4">= </span><span class="s3">False</span><span class="s4">,</span>
        <span class="s1">raw_as_string</span><span class="s4">: </span><span class="s1">bool </span><span class="s4">= </span><span class="s3">False</span><span class="s4">,</span>
    <span class="s4">) </span><span class="s1">-&gt; Optional</span><span class="s4">[</span><span class="s1">Union</span><span class="s4">[</span><span class="s1">CextEofPacketType</span><span class="s4">, </span><span class="s1">CextResultType</span><span class="s4">]]:</span>
        <span class="s2">&quot;&quot;&quot;Send a query to the MySQL server&quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">handle_unread_result</span><span class="s4">()</span>
        <span class="s3">if </span><span class="s1">raw </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s1">raw </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_raw</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s3">if not </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">query</span><span class="s4">, </span><span class="s1">bytes</span><span class="s4">):</span>
                <span class="s1">query </span><span class="s4">= </span><span class="s1">query</span><span class="s4">.</span><span class="s1">encode</span><span class="s4">(</span><span class="s5">&quot;utf-8&quot;</span><span class="s4">)</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">query</span><span class="s4">(</span>
                <span class="s1">query</span><span class="s4">,</span>
                <span class="s1">raw</span><span class="s4">=</span><span class="s1">raw</span><span class="s4">,</span>
                <span class="s1">buffered</span><span class="s4">=</span><span class="s1">buffered</span><span class="s4">,</span>
                <span class="s1">raw_as_string</span><span class="s4">=</span><span class="s1">raw_as_string</span><span class="s4">,</span>
                <span class="s1">query_attrs</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">query_attrs</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">get_mysql_exception</span><span class="s4">(</span>
                <span class="s1">err</span><span class="s4">.</span><span class="s1">errno</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">sqlstate</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">sqlstate</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>
        <span class="s3">except </span><span class="s1">AttributeError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s1">addr </span><span class="s4">= (</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">_unix_socket </span><span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_unix_socket </span><span class="s3">else </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_host</span><span class="s3">}</span><span class="s5">:</span><span class="s3">{</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_port</span><span class="s3">}</span><span class="s5">&quot;</span>
            <span class="s4">)</span>
            <span class="s3">raise </span><span class="s1">OperationalError</span><span class="s4">(</span>
                <span class="s1">errno</span><span class="s4">=</span><span class="s6">2055</span><span class="s4">, </span><span class="s1">values</span><span class="s4">=(</span><span class="s1">addr</span><span class="s4">, </span><span class="s5">&quot;Connection not available.&quot;</span><span class="s4">)</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">_columns </span><span class="s4">= []</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">have_result_set</span><span class="s4">:</span>
            <span class="s0"># No result</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">fetch_eof_status</span><span class="s4">()</span>

        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">fetch_eof_columns</span><span class="s4">()</span>

    <span class="s1">_execute_query </span><span class="s4">= </span><span class="s1">cmd_query</span>

    <span class="s3">def </span><span class="s1">cursor</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">buffered</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">bool</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">raw</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">bool</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">prepared</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">bool</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">cursor_class</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">Type</span><span class="s4">[</span><span class="s1">CMySQLCursor</span><span class="s4">]] = </span><span class="s3">None</span><span class="s4">,  </span><span class="s0"># type: ignore[override]</span>
        <span class="s1">dictionary</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">bool</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">named_tuple</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">bool</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">) </span><span class="s1">-&gt; CMySQLCursor</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Instantiates and returns a cursor using C Extension 
 
        By default, CMySQLCursor is returned. Depending on the options 
        while connecting, a buffered and/or raw cursor is instantiated 
        instead. Also depending upon the cursor options, rows can be 
        returned as dictionary or named tuple. 
 
        Dictionary and namedtuple based cursors are available with buffered 
        output but not raw. 
 
        It is possible to also give a custom cursor through the 
        cursor_class parameter, but it needs to be a subclass of 
        mysql.connector.cursor_cext.CMySQLCursor. 
 
        Raises ProgrammingError when cursor_class is not a subclass of 
        CMySQLCursor. Raises ValueError when cursor is not available. 
 
        Returns instance of CMySQLCursor or subclass. 
 
        :param buffered: Return a buffering cursor 
        :param raw: Return a raw cursor 
        :param prepared: Return a cursor which uses prepared statements 
        :param cursor_class: Use a custom cursor class 
        :param dictionary: Rows are returned as dictionary 
        :param named_tuple: Rows are returned as named tuple 
        :return: Subclass of CMySQLCursor 
        :rtype: CMySQLCursor or subclass 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">handle_unread_result</span><span class="s4">(</span><span class="s1">prepared</span><span class="s4">)</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">is_connected</span><span class="s4">():</span>
            <span class="s3">raise </span><span class="s1">OperationalError</span><span class="s4">(</span><span class="s5">&quot;MySQL Connection not available.&quot;</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">cursor_class </span><span class="s3">is not None</span><span class="s4">:</span>
            <span class="s3">if not </span><span class="s1">issubclass</span><span class="s4">(</span><span class="s1">cursor_class</span><span class="s4">, </span><span class="s1">CMySQLCursor</span><span class="s4">):</span>
                <span class="s3">raise </span><span class="s1">ProgrammingError</span><span class="s4">(</span>
                    <span class="s5">&quot;Cursor class needs be to subclass of cursor_cext.CMySQLCursor&quot;</span>
                <span class="s4">)</span>
            <span class="s3">return </span><span class="s4">(</span><span class="s1">cursor_class</span><span class="s4">)(</span><span class="s1">self</span><span class="s4">)</span>

        <span class="s1">buffered </span><span class="s4">= </span><span class="s1">buffered </span><span class="s3">or </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_buffered</span>
        <span class="s1">raw </span><span class="s4">= </span><span class="s1">raw </span><span class="s3">or </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_raw</span>

        <span class="s1">cursor_type </span><span class="s4">= </span><span class="s6">0</span>
        <span class="s3">if </span><span class="s1">buffered </span><span class="s3">is True</span><span class="s4">:</span>
            <span class="s1">cursor_type </span><span class="s4">|= </span><span class="s6">1</span>
        <span class="s3">if </span><span class="s1">raw </span><span class="s3">is True</span><span class="s4">:</span>
            <span class="s1">cursor_type </span><span class="s4">|= </span><span class="s6">2</span>
        <span class="s3">if </span><span class="s1">dictionary </span><span class="s3">is True</span><span class="s4">:</span>
            <span class="s1">cursor_type </span><span class="s4">|= </span><span class="s6">4</span>
        <span class="s3">if </span><span class="s1">named_tuple </span><span class="s3">is True</span><span class="s4">:</span>
            <span class="s1">cursor_type </span><span class="s4">|= </span><span class="s6">8</span>
        <span class="s3">if </span><span class="s1">prepared </span><span class="s3">is True</span><span class="s4">:</span>
            <span class="s1">cursor_type </span><span class="s4">|= </span><span class="s6">16</span>

        <span class="s1">types </span><span class="s4">= {</span>
            <span class="s6">0</span><span class="s4">: </span><span class="s1">CMySQLCursor</span><span class="s4">,  </span><span class="s0"># 0</span>
            <span class="s6">1</span><span class="s4">: </span><span class="s1">CMySQLCursorBuffered</span><span class="s4">,</span>
            <span class="s6">2</span><span class="s4">: </span><span class="s1">CMySQLCursorRaw</span><span class="s4">,</span>
            <span class="s6">3</span><span class="s4">: </span><span class="s1">CMySQLCursorBufferedRaw</span><span class="s4">,</span>
            <span class="s6">4</span><span class="s4">: </span><span class="s1">CMySQLCursorDict</span><span class="s4">,</span>
            <span class="s6">5</span><span class="s4">: </span><span class="s1">CMySQLCursorBufferedDict</span><span class="s4">,</span>
            <span class="s6">8</span><span class="s4">: </span><span class="s1">CMySQLCursorNamedTuple</span><span class="s4">,</span>
            <span class="s6">9</span><span class="s4">: </span><span class="s1">CMySQLCursorBufferedNamedTuple</span><span class="s4">,</span>
            <span class="s6">16</span><span class="s4">: </span><span class="s1">CMySQLCursorPrepared</span><span class="s4">,</span>
            <span class="s6">18</span><span class="s4">: </span><span class="s1">CMySQLCursorPreparedRaw</span><span class="s4">,</span>
            <span class="s6">20</span><span class="s4">: </span><span class="s1">CMySQLCursorPreparedDict</span><span class="s4">,</span>
            <span class="s6">24</span><span class="s4">: </span><span class="s1">CMySQLCursorPreparedNamedTuple</span><span class="s4">,</span>
        <span class="s4">}</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">raise_warning_against_deprecated_cursor_class</span><span class="s4">(</span>
                <span class="s1">cursor_name</span><span class="s4">=</span><span class="s1">types</span><span class="s4">[</span><span class="s1">cursor_type</span><span class="s4">].</span><span class="s1">__name__</span>
            <span class="s4">)</span>
            <span class="s3">return </span><span class="s4">(</span><span class="s1">types</span><span class="s4">[</span><span class="s1">cursor_type</span><span class="s4">])(</span><span class="s1">self</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">KeyError</span><span class="s4">:</span>
            <span class="s1">args </span><span class="s4">= (</span><span class="s5">&quot;buffered&quot;</span><span class="s4">, </span><span class="s5">&quot;raw&quot;</span><span class="s4">, </span><span class="s5">&quot;dictionary&quot;</span><span class="s4">, </span><span class="s5">&quot;named_tuple&quot;</span><span class="s4">, </span><span class="s5">&quot;prepared&quot;</span><span class="s4">)</span>
            <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span>
                <span class="s5">&quot;Cursor not available with given criteria: &quot;</span>
                <span class="s4">+ </span><span class="s5">&quot;, &quot;</span><span class="s4">.</span><span class="s1">join</span><span class="s4">([</span><span class="s1">args</span><span class="s4">[</span><span class="s1">i</span><span class="s4">] </span><span class="s3">for </span><span class="s1">i </span><span class="s3">in </span><span class="s1">range</span><span class="s4">(</span><span class="s6">5</span><span class="s4">) </span><span class="s3">if </span><span class="s1">cursor_type </span><span class="s4">&amp; (</span><span class="s6">1 </span><span class="s4">&lt;&lt; </span><span class="s1">i</span><span class="s4">) != </span><span class="s6">0</span><span class="s4">])</span>
            <span class="s4">) </span><span class="s3">from None</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">num_rows</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; int</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Returns number of rows of current result set&quot;&quot;&quot;</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">have_result_set</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">InterfaceError</span><span class="s4">(</span><span class="s5">&quot;No result set&quot;</span><span class="s4">)</span>

        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">num_rows</span><span class="s4">()</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">warning_count</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; int</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Returns number of warnings&quot;&quot;&quot;</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s6">0</span>

        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">warning_count</span><span class="s4">()</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">result_set_available</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; bool</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Check if a result set is available&quot;&quot;&quot;</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s3">return False</span>

        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">have_result_set</span>

    <span class="s4">@</span><span class="s1">property  </span><span class="s0"># type: ignore[misc]</span>
    <span class="s3">def </span><span class="s1">unread_result</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; bool</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Check if there are unread results or rows&quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">result_set_available</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">more_results</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; bool</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Check if there are more results&quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">more_results</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">prepare_for_mysql</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">, </span><span class="s1">params</span><span class="s4">: </span><span class="s1">ParamsSequenceOrDictType</span>
    <span class="s4">) </span><span class="s1">-&gt; Union</span><span class="s4">[</span><span class="s1">Sequence</span><span class="s4">[</span><span class="s1">bytes</span><span class="s4">], </span><span class="s1">Dict</span><span class="s4">[</span><span class="s1">str</span><span class="s4">, </span><span class="s1">bytes</span><span class="s4">]]:</span>
        <span class="s2">&quot;&quot;&quot;Prepare parameters for statements 
 
        This method is use by cursors to prepared parameters found in the 
        list (or tuple) params. 
 
        Returns dict. 
        &quot;&quot;&quot;</span>
        <span class="s1">result</span><span class="s4">: </span><span class="s1">Union</span><span class="s4">[</span><span class="s1">List</span><span class="s4">[</span><span class="s1">Any</span><span class="s4">], </span><span class="s1">Dict</span><span class="s4">[</span><span class="s1">str</span><span class="s4">, </span><span class="s1">Any</span><span class="s4">]] = []</span>
        <span class="s3">if </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">params</span><span class="s4">, (</span><span class="s1">list</span><span class="s4">, </span><span class="s1">tuple</span><span class="s4">)):</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">:</span>
                <span class="s1">result </span><span class="s4">= [</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">.</span><span class="s1">quote</span><span class="s4">(</span>
                        <span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">.</span><span class="s1">escape</span><span class="s4">(</span>
                            <span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">.</span><span class="s1">to_mysql</span><span class="s4">(</span><span class="s1">value</span><span class="s4">), </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_sql_mode</span>
                        <span class="s4">)</span>
                    <span class="s4">)</span>
                    <span class="s3">for </span><span class="s1">value </span><span class="s3">in </span><span class="s1">params</span>
                <span class="s4">]</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s1">result </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">convert_to_mysql</span><span class="s4">(*</span><span class="s1">params</span><span class="s4">)</span>
        <span class="s3">elif </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">params</span><span class="s4">, </span><span class="s1">dict</span><span class="s4">):</span>
            <span class="s1">result </span><span class="s4">= {}</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">:</span>
                <span class="s3">for </span><span class="s1">key</span><span class="s4">, </span><span class="s1">value </span><span class="s3">in </span><span class="s1">params</span><span class="s4">.</span><span class="s1">items</span><span class="s4">():</span>
                    <span class="s1">result</span><span class="s4">[</span><span class="s1">key</span><span class="s4">] = </span><span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">.</span><span class="s1">quote</span><span class="s4">(</span>
                        <span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">.</span><span class="s1">escape</span><span class="s4">(</span>
                            <span class="s1">self</span><span class="s4">.</span><span class="s1">converter</span><span class="s4">.</span><span class="s1">to_mysql</span><span class="s4">(</span><span class="s1">value</span><span class="s4">), </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_sql_mode</span>
                        <span class="s4">)</span>
                    <span class="s4">)</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s3">for </span><span class="s1">key</span><span class="s4">, </span><span class="s1">value </span><span class="s3">in </span><span class="s1">params</span><span class="s4">.</span><span class="s1">items</span><span class="s4">():</span>
                    <span class="s1">result</span><span class="s4">[</span><span class="s1">key</span><span class="s4">] = </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">convert_to_mysql</span><span class="s4">(</span><span class="s1">value</span><span class="s4">)[</span><span class="s6">0</span><span class="s4">]</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">ProgrammingError</span><span class="s4">(</span>
                <span class="s5">f&quot;Could not process parameters: </span><span class="s3">{</span><span class="s1">type</span><span class="s4">(</span><span class="s1">params</span><span class="s4">).</span><span class="s1">__name__</span><span class="s3">}</span><span class="s5">(</span><span class="s3">{</span><span class="s1">params</span><span class="s3">}</span><span class="s5">),&quot;</span>
                <span class="s5">&quot; it must be of type list, tuple or dict&quot;</span>
            <span class="s4">)</span>

        <span class="s3">return </span><span class="s1">result</span>

    <span class="s3">def </span><span class="s1">consume_results</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Consume the current result 
 
        This method consume the result by reading (consuming) all rows. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">consume_result</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">cmd_change_user</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">username</span><span class="s4">: </span><span class="s1">str </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
        <span class="s1">password</span><span class="s4">: </span><span class="s1">str </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
        <span class="s1">database</span><span class="s4">: </span><span class="s1">str </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
        <span class="s1">charset</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">int</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">password1</span><span class="s4">: </span><span class="s1">str </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
        <span class="s1">password2</span><span class="s4">: </span><span class="s1">str </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
        <span class="s1">password3</span><span class="s4">: </span><span class="s1">str </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
        <span class="s1">oci_config_file</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">str</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">oci_config_profile</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">str</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Change the current logged in user&quot;&quot;&quot;</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">change_user</span><span class="s4">(</span>
                <span class="s1">username</span><span class="s4">,</span>
                <span class="s1">password</span><span class="s4">,</span>
                <span class="s1">database</span><span class="s4">,</span>
                <span class="s1">password1</span><span class="s4">,</span>
                <span class="s1">password2</span><span class="s4">,</span>
                <span class="s1">password3</span><span class="s4">,</span>
                <span class="s1">oci_config_file</span><span class="s4">,</span>
                <span class="s1">oci_config_profile</span><span class="s4">,</span>
            <span class="s4">)</span>

        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">get_mysql_exception</span><span class="s4">(</span>
                <span class="s1">msg</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">errno</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">errno</span><span class="s4">, </span><span class="s1">sqlstate</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">sqlstate</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>

        <span class="s0"># If charset isn't defined, we use the same charset ID defined previously,</span>
        <span class="s0"># otherwise, we run a verification and update the charset ID.</span>
        <span class="s3">if </span><span class="s1">charset </span><span class="s3">is not None</span><span class="s4">:</span>
            <span class="s3">if not </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">charset</span><span class="s4">, </span><span class="s1">int</span><span class="s4">):</span>
                <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s5">&quot;charset must be an integer&quot;</span><span class="s4">)</span>
            <span class="s3">if </span><span class="s1">charset </span><span class="s4">&lt; </span><span class="s6">0</span><span class="s4">:</span>
                <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s5">&quot;charset should be either zero or a postive integer&quot;</span><span class="s4">)</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_charset_id </span><span class="s4">= </span><span class="s1">charset</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_user </span><span class="s4">= </span><span class="s1">username  </span><span class="s0"># updating user accordingly</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_post_connection</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">cmd_reset_connection</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; bool</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Resets the session state without re-authenticating 
 
        Reset command only works on MySQL server 5.7.3 or later. 
        The result is True for a successful reset otherwise False. 
 
        Returns bool 
        &quot;&quot;&quot;</span>
        <span class="s1">res </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">reset_connection</span><span class="s4">()</span>
        <span class="s3">if </span><span class="s1">res</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_post_connection</span><span class="s4">()</span>
        <span class="s3">return </span><span class="s1">res</span>

    <span class="s3">def </span><span class="s1">cmd_refresh</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">options</span><span class="s4">: </span><span class="s1">int</span><span class="s4">) </span><span class="s1">-&gt; Optional</span><span class="s4">[</span><span class="s1">CextEofPacketType</span><span class="s4">]:</span>
        <span class="s2">&quot;&quot;&quot;Send the Refresh command to the MySQL server&quot;&quot;&quot;</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">handle_unread_result</span><span class="s4">()</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">refresh</span><span class="s4">(</span><span class="s1">options</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">get_mysql_exception</span><span class="s4">(</span>
                <span class="s1">msg</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">errno</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">errno</span><span class="s4">, </span><span class="s1">sqlstate</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">sqlstate</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>

        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">fetch_eof_status</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">cmd_quit</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Close the current connection with the server&quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">close</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">cmd_shutdown</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">shutdown_type</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">int</span><span class="s4">] = </span><span class="s3">None</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Shut down the MySQL Server 
 
        This method sends the SHUTDOWN command to the MySQL server. 
        The `shutdown_type` is not used, and it's kept for backward compatibility. 
        &quot;&quot;&quot;</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">OperationalError</span><span class="s4">(</span><span class="s5">&quot;MySQL Connection not available&quot;</span><span class="s4">)</span>

        <span class="s3">if </span><span class="s1">shutdown_type</span><span class="s4">:</span>
            <span class="s3">if not </span><span class="s1">ShutdownType</span><span class="s4">.</span><span class="s1">get_info</span><span class="s4">(</span><span class="s1">shutdown_type</span><span class="s4">):</span>
                <span class="s3">raise </span><span class="s1">InterfaceError</span><span class="s4">(</span><span class="s5">&quot;Invalid shutdown type&quot;</span><span class="s4">)</span>
            <span class="s1">level </span><span class="s4">= </span><span class="s1">shutdown_type</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">level </span><span class="s4">= </span><span class="s1">ShutdownType</span><span class="s4">.</span><span class="s1">SHUTDOWN_DEFAULT</span>

        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">shutdown</span><span class="s4">(</span><span class="s1">level</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">MySQLInterfaceError </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">get_mysql_exception</span><span class="s4">(</span>
                <span class="s1">msg</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">errno</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">errno</span><span class="s4">, </span><span class="s1">sqlstate</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">sqlstate</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">close</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">cmd_statistics</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; StatsPacketType</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Return statistics from the MySQL server&quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">handle_unread_result</span><span class="s4">()</span>

        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">stat </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cmysql</span><span class="s4">.</span><span class="s1">stat</span><span class="s4">()</span>
            <span class="s3">return </span><span class="s1">MySQLProtocol</span><span class="s4">().</span><span class="s1">parse_statistics</span><span class="s4">(</span><span class="s1">stat</span><span class="s4">, </span><span class="s1">with_header</span><span class="s4">=</span><span class="s3">False</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s4">(</span><span class="s1">MySQLInterfaceError</span><span class="s4">, </span><span class="s1">InterfaceError</span><span class="s4">) </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">get_mysql_exception</span><span class="s4">(</span>
                <span class="s1">msg</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">errno</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">errno</span><span class="s4">, </span><span class="s1">sqlstate</span><span class="s4">=</span><span class="s1">err</span><span class="s4">.</span><span class="s1">sqlstate</span>
            <span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>

    <span class="s3">def </span><span class="s1">cmd_process_kill</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">mysql_pid</span><span class="s4">: </span><span class="s1">int</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Kill a MySQL process&quot;&quot;&quot;</span>
        <span class="s3">if not </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">mysql_pid</span><span class="s4">, </span><span class="s1">int</span><span class="s4">):</span>
            <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s5">&quot;MySQL PID must be int&quot;</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">cmd_query</span><span class="s4">(</span><span class="s5">f&quot;KILL </span><span class="s3">{</span><span class="s1">mysql_pid</span><span class="s3">}</span><span class="s5">&quot;</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">cmd_debug</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; NoReturn</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Send the DEBUG command&quot;&quot;&quot;</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span>

    <span class="s3">def </span><span class="s1">cmd_ping</span><span class="s4">(</span><span class="s1">self</span><span class="s4">) </span><span class="s1">-&gt; NoReturn</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Send the PING command&quot;&quot;&quot;</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span>

    <span class="s3">def </span><span class="s1">cmd_query_iter</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">statements</span><span class="s4">: </span><span class="s1">str</span><span class="s4">) </span><span class="s1">-&gt; NoReturn</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Send one or more statements to the MySQL server&quot;&quot;&quot;</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span>

    <span class="s3">def </span><span class="s1">cmd_stmt_send_long_data</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">statement_id</span><span class="s4">: </span><span class="s1">CMySQLPrepStmt</span><span class="s4">,  </span><span class="s0"># type: ignore[override]</span>
        <span class="s1">param_id</span><span class="s4">: </span><span class="s1">int</span><span class="s4">,</span>
        <span class="s1">data</span><span class="s4">: </span><span class="s1">BinaryIO</span><span class="s4">,</span>
    <span class="s4">) </span><span class="s1">-&gt; NoReturn</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Send data for a column&quot;&quot;&quot;</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span>

    <span class="s3">def </span><span class="s1">handle_unread_result</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">prepared</span><span class="s4">: </span><span class="s1">bool </span><span class="s4">= </span><span class="s3">False</span><span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Check whether there is an unread result&quot;&quot;&quot;</span>
        <span class="s1">unread_result </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_unread_result </span><span class="s3">if </span><span class="s1">prepared </span><span class="s3">is True else </span><span class="s1">self</span><span class="s4">.</span><span class="s1">unread_result</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">can_consume_results</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">consume_results</span><span class="s4">()</span>
        <span class="s3">elif </span><span class="s1">unread_result</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">InternalError</span><span class="s4">(</span><span class="s5">&quot;Unread result found&quot;</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">reset_session</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">user_variables</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">Dict</span><span class="s4">[</span><span class="s1">str</span><span class="s4">, </span><span class="s1">Any</span><span class="s4">]] = </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">session_variables</span><span class="s4">: </span><span class="s1">Optional</span><span class="s4">[</span><span class="s1">Dict</span><span class="s4">[</span><span class="s1">str</span><span class="s4">, </span><span class="s1">Any</span><span class="s4">]] = </span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">) </span><span class="s1">-&gt; </span><span class="s3">None</span><span class="s4">:</span>
        <span class="s2">&quot;&quot;&quot;Clears the current active session 
 
        This method resets the session state, if the MySQL server is 5.7.3 
        or later active session will be reset without re-authenticating. 
        For other server versions session will be reset by re-authenticating. 
 
        It is possible to provide a sequence of variables and their values to 
        be set after clearing the session. This is possible for both user 
        defined variables and session variables. 
        This method takes two arguments user_variables and session_variables 
        which are dictionaries. 
 
        Raises OperationalError if not connected, InternalError if there are 
        unread results and InterfaceError on errors. 
        &quot;&quot;&quot;</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">is_connected</span><span class="s4">():</span>
            <span class="s3">raise </span><span class="s1">OperationalError</span><span class="s4">(</span><span class="s5">&quot;MySQL Connection not available.&quot;</span><span class="s4">)</span>

        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">cmd_reset_connection</span><span class="s4">():</span>
            <span class="s3">try</span><span class="s4">:</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">cmd_change_user</span><span class="s4">(</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_user</span><span class="s4">,</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_password</span><span class="s4">,</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_database</span><span class="s4">,</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_charset_id</span><span class="s4">,</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_password1</span><span class="s4">,</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_password2</span><span class="s4">,</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_password3</span><span class="s4">,</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_oci_config_file</span><span class="s4">,</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_oci_config_profile</span><span class="s4">,</span>
                <span class="s4">)</span>
            <span class="s3">except </span><span class="s1">ProgrammingError</span><span class="s4">:</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">reconnect</span><span class="s4">()</span>

        <span class="s3">if </span><span class="s1">user_variables </span><span class="s3">or </span><span class="s1">session_variables</span><span class="s4">:</span>
            <span class="s1">cur </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">cursor</span><span class="s4">()</span>
            <span class="s3">if </span><span class="s1">user_variables</span><span class="s4">:</span>
                <span class="s3">for </span><span class="s1">key</span><span class="s4">, </span><span class="s1">value </span><span class="s3">in </span><span class="s1">user_variables</span><span class="s4">.</span><span class="s1">items</span><span class="s4">():</span>
                    <span class="s1">cur</span><span class="s4">.</span><span class="s1">execute</span><span class="s4">(</span><span class="s5">f&quot;SET @`</span><span class="s3">{</span><span class="s1">key</span><span class="s3">}</span><span class="s5">` = %s&quot;</span><span class="s4">, (</span><span class="s1">value</span><span class="s4">,))</span>
            <span class="s3">if </span><span class="s1">session_variables</span><span class="s4">:</span>
                <span class="s3">for </span><span class="s1">key</span><span class="s4">, </span><span class="s1">value </span><span class="s3">in </span><span class="s1">session_variables</span><span class="s4">.</span><span class="s1">items</span><span class="s4">():</span>
                    <span class="s1">cur</span><span class="s4">.</span><span class="s1">execute</span><span class="s4">(</span><span class="s5">f&quot;SET SESSION `</span><span class="s3">{</span><span class="s1">key</span><span class="s3">}</span><span class="s5">` = %s&quot;</span><span class="s4">, (</span><span class="s1">value</span><span class="s4">,))</span>
            <span class="s1">cur</span><span class="s4">.</span><span class="s1">close</span><span class="s4">()</span>
</pre>
</body>
</html>