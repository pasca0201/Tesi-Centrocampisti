<html>
<head>
<title>test_public_api.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #7a7e85;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_public_api.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
This test script is adopted from: 
    https://github.com/numpy/numpy/blob/main/numpy/tests/test_public_api.py 
&quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">pkgutil</span>
<span class="s2">import </span><span class="s1">types</span>
<span class="s2">import </span><span class="s1">importlib</span>
<span class="s2">import </span><span class="s1">warnings</span>
<span class="s2">from </span><span class="s1">importlib </span><span class="s2">import </span><span class="s1">import_module</span>

<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">import </span><span class="s1">scipy</span>

<span class="s2">from </span><span class="s1">scipy</span><span class="s3">.</span><span class="s1">conftest </span><span class="s2">import </span><span class="s1">xp_available_backends</span>


<span class="s2">def </span><span class="s1">test_dir_testing</span><span class="s3">():</span>
    <span class="s0">&quot;&quot;&quot;Assert that output of dir has only one &quot;testing/tester&quot; 
    attribute without duplicate&quot;&quot;&quot;</span>
    <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">dir</span><span class="s3">(</span><span class="s1">scipy</span><span class="s3">)) == </span><span class="s1">len</span><span class="s3">(</span><span class="s1">set</span><span class="s3">(</span><span class="s1">dir</span><span class="s3">(</span><span class="s1">scipy</span><span class="s3">)))</span>


<span class="s4"># Historically SciPy has not used leading underscores for private submodules</span>
<span class="s4"># much.  This has resulted in lots of things that look like public modules</span>
<span class="s4"># (i.e. things that can be imported as `import scipy.somesubmodule.somefile`),</span>
<span class="s4"># but were never intended to be public.  The PUBLIC_MODULES list contains</span>
<span class="s4"># modules that are either public because they were meant to be, or because they</span>
<span class="s4"># contain public functions/objects that aren't present in any other namespace</span>
<span class="s4"># for whatever reason and therefore should be treated as public.</span>
<span class="s1">PUBLIC_MODULES </span><span class="s3">= [</span><span class="s5">&quot;scipy.&quot; </span><span class="s3">+ </span><span class="s1">s </span><span class="s2">for </span><span class="s1">s </span><span class="s2">in </span><span class="s3">[</span>
    <span class="s5">&quot;cluster&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;cluster.vq&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;cluster.hierarchy&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;constants&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;datasets&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;fft&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;fftpack&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;integrate&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;interpolate&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;io&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;io.arff&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;io.matlab&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;io.wavfile&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;linalg&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;linalg.blas&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;linalg.cython_blas&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;linalg.lapack&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;linalg.cython_lapack&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;linalg.interpolative&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;misc&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;ndimage&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;odr&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;optimize&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;signal&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;signal.windows&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;sparse&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;sparse.linalg&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;sparse.csgraph&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;spatial&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;spatial.distance&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;spatial.transform&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;special&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;stats&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;stats.contingency&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;stats.distributions&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;stats.mstats&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;stats.qmc&quot;</span><span class="s3">,</span>
    <span class="s5">&quot;stats.sampling&quot;</span>
<span class="s3">]]</span>

<span class="s4"># The PRIVATE_BUT_PRESENT_MODULES list contains modules that lacked underscores</span>
<span class="s4"># in their name and hence looked public, but weren't meant to be. All these</span>
<span class="s4"># namespace were deprecated in the 1.8.0 release - see &quot;clear split between</span>
<span class="s4"># public and private API&quot; in the 1.8.0 release notes.</span>
<span class="s4"># These private modules support will be removed in SciPy v2.0.0, as the</span>
<span class="s4"># deprecation messages emitted by each of these modules say.</span>
<span class="s1">PRIVATE_BUT_PRESENT_MODULES </span><span class="s3">= [</span>
    <span class="s5">'scipy.constants.codata'</span><span class="s3">,</span>
    <span class="s5">'scipy.constants.constants'</span><span class="s3">,</span>
    <span class="s5">'scipy.fftpack.basic'</span><span class="s3">,</span>
    <span class="s5">'scipy.fftpack.convolve'</span><span class="s3">,</span>
    <span class="s5">'scipy.fftpack.helper'</span><span class="s3">,</span>
    <span class="s5">'scipy.fftpack.pseudo_diffs'</span><span class="s3">,</span>
    <span class="s5">'scipy.fftpack.realtransforms'</span><span class="s3">,</span>
    <span class="s5">'scipy.integrate.dop'</span><span class="s3">,</span>
    <span class="s5">'scipy.integrate.lsoda'</span><span class="s3">,</span>
    <span class="s5">'scipy.integrate.odepack'</span><span class="s3">,</span>
    <span class="s5">'scipy.integrate.quadpack'</span><span class="s3">,</span>
    <span class="s5">'scipy.integrate.vode'</span><span class="s3">,</span>
    <span class="s5">'scipy.interpolate.dfitpack'</span><span class="s3">,</span>
    <span class="s5">'scipy.interpolate.fitpack'</span><span class="s3">,</span>
    <span class="s5">'scipy.interpolate.fitpack2'</span><span class="s3">,</span>
    <span class="s5">'scipy.interpolate.interpnd'</span><span class="s3">,</span>
    <span class="s5">'scipy.interpolate.interpolate'</span><span class="s3">,</span>
    <span class="s5">'scipy.interpolate.ndgriddata'</span><span class="s3">,</span>
    <span class="s5">'scipy.interpolate.polyint'</span><span class="s3">,</span>
    <span class="s5">'scipy.interpolate.rbf'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.arff.arffread'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.harwell_boeing'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.idl'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.matlab.byteordercodes'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.matlab.mio'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.matlab.mio4'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.matlab.mio5'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.matlab.mio5_params'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.matlab.mio5_utils'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.matlab.mio_utils'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.matlab.miobase'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.matlab.streams'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.mmio'</span><span class="s3">,</span>
    <span class="s5">'scipy.io.netcdf'</span><span class="s3">,</span>
    <span class="s5">'scipy.linalg.basic'</span><span class="s3">,</span>
    <span class="s5">'scipy.linalg.decomp'</span><span class="s3">,</span>
    <span class="s5">'scipy.linalg.decomp_cholesky'</span><span class="s3">,</span>
    <span class="s5">'scipy.linalg.decomp_lu'</span><span class="s3">,</span>
    <span class="s5">'scipy.linalg.decomp_qr'</span><span class="s3">,</span>
    <span class="s5">'scipy.linalg.decomp_schur'</span><span class="s3">,</span>
    <span class="s5">'scipy.linalg.decomp_svd'</span><span class="s3">,</span>
    <span class="s5">'scipy.linalg.matfuncs'</span><span class="s3">,</span>
    <span class="s5">'scipy.linalg.misc'</span><span class="s3">,</span>
    <span class="s5">'scipy.linalg.special_matrices'</span><span class="s3">,</span>
    <span class="s5">'scipy.misc.common'</span><span class="s3">,</span>
    <span class="s5">'scipy.misc.doccer'</span><span class="s3">,</span>
    <span class="s5">'scipy.ndimage.filters'</span><span class="s3">,</span>
    <span class="s5">'scipy.ndimage.fourier'</span><span class="s3">,</span>
    <span class="s5">'scipy.ndimage.interpolation'</span><span class="s3">,</span>
    <span class="s5">'scipy.ndimage.measurements'</span><span class="s3">,</span>
    <span class="s5">'scipy.ndimage.morphology'</span><span class="s3">,</span>
    <span class="s5">'scipy.odr.models'</span><span class="s3">,</span>
    <span class="s5">'scipy.odr.odrpack'</span><span class="s3">,</span>
    <span class="s5">'scipy.optimize.cobyla'</span><span class="s3">,</span>
    <span class="s5">'scipy.optimize.cython_optimize'</span><span class="s3">,</span>
    <span class="s5">'scipy.optimize.lbfgsb'</span><span class="s3">,</span>
    <span class="s5">'scipy.optimize.linesearch'</span><span class="s3">,</span>
    <span class="s5">'scipy.optimize.minpack'</span><span class="s3">,</span>
    <span class="s5">'scipy.optimize.minpack2'</span><span class="s3">,</span>
    <span class="s5">'scipy.optimize.moduleTNC'</span><span class="s3">,</span>
    <span class="s5">'scipy.optimize.nonlin'</span><span class="s3">,</span>
    <span class="s5">'scipy.optimize.optimize'</span><span class="s3">,</span>
    <span class="s5">'scipy.optimize.slsqp'</span><span class="s3">,</span>
    <span class="s5">'scipy.optimize.tnc'</span><span class="s3">,</span>
    <span class="s5">'scipy.optimize.zeros'</span><span class="s3">,</span>
    <span class="s5">'scipy.signal.bsplines'</span><span class="s3">,</span>
    <span class="s5">'scipy.signal.filter_design'</span><span class="s3">,</span>
    <span class="s5">'scipy.signal.fir_filter_design'</span><span class="s3">,</span>
    <span class="s5">'scipy.signal.lti_conversion'</span><span class="s3">,</span>
    <span class="s5">'scipy.signal.ltisys'</span><span class="s3">,</span>
    <span class="s5">'scipy.signal.signaltools'</span><span class="s3">,</span>
    <span class="s5">'scipy.signal.spectral'</span><span class="s3">,</span>
    <span class="s5">'scipy.signal.spline'</span><span class="s3">,</span>
    <span class="s5">'scipy.signal.waveforms'</span><span class="s3">,</span>
    <span class="s5">'scipy.signal.wavelets'</span><span class="s3">,</span>
    <span class="s5">'scipy.signal.windows.windows'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.base'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.bsr'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.compressed'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.construct'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.coo'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.csc'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.csr'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.data'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.dia'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.dok'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.extract'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.lil'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.linalg.dsolve'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.linalg.eigen'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.linalg.interface'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.linalg.isolve'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.linalg.matfuncs'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.sparsetools'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.spfuncs'</span><span class="s3">,</span>
    <span class="s5">'scipy.sparse.sputils'</span><span class="s3">,</span>
    <span class="s5">'scipy.spatial.ckdtree'</span><span class="s3">,</span>
    <span class="s5">'scipy.spatial.kdtree'</span><span class="s3">,</span>
    <span class="s5">'scipy.spatial.qhull'</span><span class="s3">,</span>
    <span class="s5">'scipy.spatial.transform.rotation'</span><span class="s3">,</span>
    <span class="s5">'scipy.special.add_newdocs'</span><span class="s3">,</span>
    <span class="s5">'scipy.special.basic'</span><span class="s3">,</span>
    <span class="s5">'scipy.special.cython_special'</span><span class="s3">,</span>
    <span class="s5">'scipy.special.orthogonal'</span><span class="s3">,</span>
    <span class="s5">'scipy.special.sf_error'</span><span class="s3">,</span>
    <span class="s5">'scipy.special.specfun'</span><span class="s3">,</span>
    <span class="s5">'scipy.special.spfun_stats'</span><span class="s3">,</span>
    <span class="s5">'scipy.stats.biasedurn'</span><span class="s3">,</span>
    <span class="s5">'scipy.stats.kde'</span><span class="s3">,</span>
    <span class="s5">'scipy.stats.morestats'</span><span class="s3">,</span>
    <span class="s5">'scipy.stats.mstats_basic'</span><span class="s3">,</span>
    <span class="s5">'scipy.stats.mstats_extras'</span><span class="s3">,</span>
    <span class="s5">'scipy.stats.mvn'</span><span class="s3">,</span>
    <span class="s5">'scipy.stats.stats'</span><span class="s3">,</span>
<span class="s3">]</span>


<span class="s2">def </span><span class="s1">is_unexpected</span><span class="s3">(</span><span class="s1">name</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Check if this needs to be considered.&quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s5">'._' </span><span class="s2">in </span><span class="s1">name </span><span class="s2">or </span><span class="s5">'.tests' </span><span class="s2">in </span><span class="s1">name </span><span class="s2">or </span><span class="s5">'.setup' </span><span class="s2">in </span><span class="s1">name</span><span class="s3">:</span>
        <span class="s2">return False</span>

    <span class="s2">if </span><span class="s1">name </span><span class="s2">in </span><span class="s1">PUBLIC_MODULES</span><span class="s3">:</span>
        <span class="s2">return False</span>

    <span class="s2">if </span><span class="s1">name </span><span class="s2">in </span><span class="s1">PRIVATE_BUT_PRESENT_MODULES</span><span class="s3">:</span>
        <span class="s2">return False</span>

    <span class="s2">return True</span>


<span class="s1">SKIP_LIST </span><span class="s3">= [</span>
    <span class="s5">'scipy.conftest'</span><span class="s3">,</span>
    <span class="s5">'scipy.version'</span><span class="s3">,</span>
    <span class="s5">'scipy.special.libsf_error_state'</span>
<span class="s3">]</span>


<span class="s4"># XXX: this test does more than it says on the tin - in using `pkgutil.walk_packages`,</span>
<span class="s4"># it will raise if it encounters any exceptions which are not handled by `ignore_errors`</span>
<span class="s4"># while attempting to import each discovered package.</span>
<span class="s4"># For now, `ignore_errors` only ignores what is necessary, but this could be expanded -</span>
<span class="s4"># for example, to all errors from private modules or git subpackages - if desired.</span>
<span class="s2">def </span><span class="s1">test_all_modules_are_expected</span><span class="s3">():</span>
    <span class="s0">&quot;&quot;&quot; 
    Test that we don't add anything that looks like a new public module by 
    accident.  Check is based on filenames. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">ignore_errors</span><span class="s3">(</span><span class="s1">name</span><span class="s3">):</span>
        <span class="s4"># if versions of other array libraries are installed which are incompatible</span>
        <span class="s4"># with the installed NumPy version, there can be errors on importing</span>
        <span class="s4"># `array_api_compat`. This should only raise if SciPy is configured with</span>
        <span class="s4"># that library as an available backend.</span>
        <span class="s1">backends </span><span class="s3">= {</span><span class="s5">'cupy'</span><span class="s3">: </span><span class="s5">'cupy'</span><span class="s3">,</span>
                    <span class="s5">'pytorch'</span><span class="s3">: </span><span class="s5">'torch'</span><span class="s3">,</span>
                    <span class="s5">'dask.array'</span><span class="s3">: </span><span class="s5">'dask.array'</span><span class="s3">}</span>
        <span class="s2">for </span><span class="s1">backend</span><span class="s3">, </span><span class="s1">dir_name </span><span class="s2">in </span><span class="s1">backends</span><span class="s3">.</span><span class="s1">items</span><span class="s3">():</span>
            <span class="s1">path </span><span class="s3">= </span><span class="s5">f'array_api_compat.</span><span class="s2">{</span><span class="s1">dir_name</span><span class="s2">}</span><span class="s5">'</span>
            <span class="s2">if </span><span class="s1">path </span><span class="s2">in </span><span class="s1">name </span><span class="s2">and </span><span class="s1">backend </span><span class="s2">not in </span><span class="s1">xp_available_backends</span><span class="s3">:</span>
                <span class="s2">return</span>
        <span class="s2">raise</span>

    <span class="s1">modnames </span><span class="s3">= []</span>

    <span class="s2">for </span><span class="s1">_</span><span class="s3">, </span><span class="s1">modname</span><span class="s3">, </span><span class="s1">_ </span><span class="s2">in </span><span class="s1">pkgutil</span><span class="s3">.</span><span class="s1">walk_packages</span><span class="s3">(</span><span class="s1">path</span><span class="s3">=</span><span class="s1">scipy</span><span class="s3">.</span><span class="s1">__path__</span><span class="s3">,</span>
                                               <span class="s1">prefix</span><span class="s3">=</span><span class="s1">scipy</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s3">+ </span><span class="s5">'.'</span><span class="s3">,</span>
                                               <span class="s1">onerror</span><span class="s3">=</span><span class="s1">ignore_errors</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">is_unexpected</span><span class="s3">(</span><span class="s1">modname</span><span class="s3">) </span><span class="s2">and </span><span class="s1">modname </span><span class="s2">not in </span><span class="s1">SKIP_LIST</span><span class="s3">:</span>
            <span class="s4"># We have a name that is new.  If that's on purpose, add it to</span>
            <span class="s4"># PUBLIC_MODULES.  We don't expect to have to add anything to</span>
            <span class="s4"># PRIVATE_BUT_PRESENT_MODULES.  Use an underscore in the name!</span>
            <span class="s1">modnames</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">modname</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">modnames</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span><span class="s5">f'Found unexpected modules: </span><span class="s2">{</span><span class="s1">modnames</span><span class="s2">}</span><span class="s5">'</span><span class="s3">)</span>


<span class="s4"># Stuff that clearly shouldn't be in the API and is detected by the next test</span>
<span class="s4"># below</span>
<span class="s1">SKIP_LIST_2 </span><span class="s3">= [</span>
    <span class="s5">'scipy.char'</span><span class="s3">,</span>
    <span class="s5">'scipy.rec'</span><span class="s3">,</span>
    <span class="s5">'scipy.emath'</span><span class="s3">,</span>
    <span class="s5">'scipy.math'</span><span class="s3">,</span>
    <span class="s5">'scipy.random'</span><span class="s3">,</span>
    <span class="s5">'scipy.ctypeslib'</span><span class="s3">,</span>
    <span class="s5">'scipy.ma'</span>
<span class="s3">]</span>


<span class="s2">def </span><span class="s1">test_all_modules_are_expected_2</span><span class="s3">():</span>
    <span class="s0">&quot;&quot;&quot; 
    Method checking all objects. The pkgutil-based method in 
    `test_all_modules_are_expected` does not catch imports into a namespace, 
    only filenames. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">find_unexpected_members</span><span class="s3">(</span><span class="s1">mod_name</span><span class="s3">):</span>
        <span class="s1">members </span><span class="s3">= []</span>
        <span class="s1">module </span><span class="s3">= </span><span class="s1">importlib</span><span class="s3">.</span><span class="s1">import_module</span><span class="s3">(</span><span class="s1">mod_name</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">module</span><span class="s3">, </span><span class="s5">'__all__'</span><span class="s3">):</span>
            <span class="s1">objnames </span><span class="s3">= </span><span class="s1">module</span><span class="s3">.</span><span class="s1">__all__</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">objnames </span><span class="s3">= </span><span class="s1">dir</span><span class="s3">(</span><span class="s1">module</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">objname </span><span class="s2">in </span><span class="s1">objnames</span><span class="s3">:</span>
            <span class="s2">if not </span><span class="s1">objname</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s5">'_'</span><span class="s3">):</span>
                <span class="s1">fullobjname </span><span class="s3">= </span><span class="s1">mod_name </span><span class="s3">+ </span><span class="s5">'.' </span><span class="s3">+ </span><span class="s1">objname</span>
                <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">module</span><span class="s3">, </span><span class="s1">objname</span><span class="s3">), </span><span class="s1">types</span><span class="s3">.</span><span class="s1">ModuleType</span><span class="s3">):</span>
                    <span class="s2">if </span><span class="s1">is_unexpected</span><span class="s3">(</span><span class="s1">fullobjname</span><span class="s3">) </span><span class="s2">and </span><span class="s1">fullobjname </span><span class="s2">not in </span><span class="s1">SKIP_LIST_2</span><span class="s3">:</span>
                        <span class="s1">members</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">fullobjname</span><span class="s3">)</span>

        <span class="s2">return </span><span class="s1">members</span>

    <span class="s1">unexpected_members </span><span class="s3">= </span><span class="s1">find_unexpected_members</span><span class="s3">(</span><span class="s5">&quot;scipy&quot;</span><span class="s3">)</span>
    <span class="s2">for </span><span class="s1">modname </span><span class="s2">in </span><span class="s1">PUBLIC_MODULES</span><span class="s3">:</span>
        <span class="s1">unexpected_members</span><span class="s3">.</span><span class="s1">extend</span><span class="s3">(</span><span class="s1">find_unexpected_members</span><span class="s3">(</span><span class="s1">modname</span><span class="s3">))</span>

    <span class="s2">if </span><span class="s1">unexpected_members</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span><span class="s5">&quot;Found unexpected object(s) that look like &quot;</span>
                             <span class="s5">f&quot;modules: </span><span class="s2">{</span><span class="s1">unexpected_members</span><span class="s2">}</span><span class="s5">&quot;</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_api_importable</span><span class="s3">():</span>
    <span class="s0">&quot;&quot;&quot; 
    Check that all submodules listed higher up in this file can be imported 
    Note that if a PRIVATE_BUT_PRESENT_MODULES entry goes missing, it may 
    simply need to be removed from the list (deprecation may or may not be 
    needed - apply common sense). 
    &quot;&quot;&quot;</span>
    <span class="s2">def </span><span class="s1">check_importable</span><span class="s3">(</span><span class="s1">module_name</span><span class="s3">):</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">importlib</span><span class="s3">.</span><span class="s1">import_module</span><span class="s3">(</span><span class="s1">module_name</span><span class="s3">)</span>
        <span class="s2">except </span><span class="s3">(</span><span class="s1">ImportError</span><span class="s3">, </span><span class="s1">AttributeError</span><span class="s3">):</span>
            <span class="s2">return False</span>

        <span class="s2">return True</span>

    <span class="s1">module_names </span><span class="s3">= []</span>
    <span class="s2">for </span><span class="s1">module_name </span><span class="s2">in </span><span class="s1">PUBLIC_MODULES</span><span class="s3">:</span>
        <span class="s2">if not </span><span class="s1">check_importable</span><span class="s3">(</span><span class="s1">module_name</span><span class="s3">):</span>
            <span class="s1">module_names</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">module_name</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">module_names</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span><span class="s5">&quot;Modules in the public API that cannot be &quot;</span>
                             <span class="s5">f&quot;imported: </span><span class="s2">{</span><span class="s1">module_names</span><span class="s2">}</span><span class="s5">&quot;</span><span class="s3">)</span>

    <span class="s2">with </span><span class="s1">warnings</span><span class="s3">.</span><span class="s1">catch_warnings</span><span class="s3">(</span><span class="s1">record</span><span class="s3">=</span><span class="s2">True</span><span class="s3">):</span>
        <span class="s1">warnings</span><span class="s3">.</span><span class="s1">filterwarnings</span><span class="s3">(</span><span class="s5">'always'</span><span class="s3">, </span><span class="s1">category</span><span class="s3">=</span><span class="s1">DeprecationWarning</span><span class="s3">)</span>
        <span class="s1">warnings</span><span class="s3">.</span><span class="s1">filterwarnings</span><span class="s3">(</span><span class="s5">'always'</span><span class="s3">, </span><span class="s1">category</span><span class="s3">=</span><span class="s1">ImportWarning</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">module_name </span><span class="s2">in </span><span class="s1">PRIVATE_BUT_PRESENT_MODULES</span><span class="s3">:</span>
            <span class="s2">if not </span><span class="s1">check_importable</span><span class="s3">(</span><span class="s1">module_name</span><span class="s3">):</span>
                <span class="s1">module_names</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">module_name</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">module_names</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span><span class="s5">&quot;Modules that are not really public but looked &quot;</span>
                             <span class="s5">&quot;public and can not be imported: &quot;</span>
                             <span class="s5">f&quot;</span><span class="s2">{</span><span class="s1">module_names</span><span class="s2">}</span><span class="s5">&quot;</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">((</span><span class="s5">&quot;module_name&quot;</span><span class="s3">, </span><span class="s5">&quot;correct_module&quot;</span><span class="s3">),</span>
                         <span class="s3">[(</span><span class="s5">'scipy.constants.codata'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.constants.constants'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.fftpack.basic'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.fftpack.helper'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.fftpack.pseudo_diffs'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.fftpack.realtransforms'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.integrate.dop'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.integrate.lsoda'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.integrate.odepack'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.integrate.quadpack'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.integrate.vode'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.interpolate.fitpack'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.interpolate.fitpack2'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.interpolate.interpolate'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.interpolate.ndgriddata'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.interpolate.polyint'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.interpolate.rbf'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.harwell_boeing'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.idl'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.mmio'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.netcdf'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.arff.arffread'</span><span class="s3">, </span><span class="s5">'arff'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.matlab.byteordercodes'</span><span class="s3">, </span><span class="s5">'matlab'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.matlab.mio_utils'</span><span class="s3">, </span><span class="s5">'matlab'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.matlab.mio'</span><span class="s3">, </span><span class="s5">'matlab'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.matlab.mio4'</span><span class="s3">, </span><span class="s5">'matlab'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.matlab.mio5_params'</span><span class="s3">, </span><span class="s5">'matlab'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.matlab.mio5_utils'</span><span class="s3">, </span><span class="s5">'matlab'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.matlab.mio5'</span><span class="s3">, </span><span class="s5">'matlab'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.matlab.miobase'</span><span class="s3">, </span><span class="s5">'matlab'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.io.matlab.streams'</span><span class="s3">, </span><span class="s5">'matlab'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.linalg.basic'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.linalg.decomp'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.linalg.decomp_cholesky'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.linalg.decomp_lu'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.linalg.decomp_qr'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.linalg.decomp_schur'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.linalg.decomp_svd'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.linalg.matfuncs'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.linalg.misc'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.linalg.special_matrices'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.misc.common'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.ndimage.filters'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.ndimage.fourier'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.ndimage.interpolation'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.ndimage.measurements'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.ndimage.morphology'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.odr.models'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.odr.odrpack'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.optimize.cobyla'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.optimize.lbfgsb'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.optimize.linesearch'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.optimize.minpack'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.optimize.minpack2'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.optimize.moduleTNC'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.optimize.nonlin'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.optimize.optimize'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.optimize.slsqp'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.optimize.tnc'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.optimize.zeros'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.signal.bsplines'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.signal.filter_design'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.signal.fir_filter_design'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.signal.lti_conversion'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.signal.ltisys'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.signal.signaltools'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.signal.spectral'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.signal.waveforms'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.signal.wavelets'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.signal.windows.windows'</span><span class="s3">, </span><span class="s5">'windows'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.sparse.lil'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.sparse.linalg.dsolve'</span><span class="s3">, </span><span class="s5">'linalg'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.sparse.linalg.eigen'</span><span class="s3">, </span><span class="s5">'linalg'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.sparse.linalg.interface'</span><span class="s3">, </span><span class="s5">'linalg'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.sparse.linalg.isolve'</span><span class="s3">, </span><span class="s5">'linalg'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.sparse.linalg.matfuncs'</span><span class="s3">, </span><span class="s5">'linalg'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.sparse.sparsetools'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.sparse.spfuncs'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.sparse.sputils'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.spatial.ckdtree'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.spatial.kdtree'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.spatial.qhull'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.spatial.transform.rotation'</span><span class="s3">, </span><span class="s5">'transform'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.special.add_newdocs'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.special.basic'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.special.orthogonal'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.special.sf_error'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.special.specfun'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.special.spfun_stats'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.stats.biasedurn'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.stats.kde'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.stats.morestats'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.stats.mstats_basic'</span><span class="s3">, </span><span class="s5">'mstats'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.stats.mstats_extras'</span><span class="s3">, </span><span class="s5">'mstats'</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.stats.mvn'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
                          <span class="s3">(</span><span class="s5">'scipy.stats.stats'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)])</span>
<span class="s2">def </span><span class="s1">test_private_but_present_deprecation</span><span class="s3">(</span><span class="s1">module_name</span><span class="s3">, </span><span class="s1">correct_module</span><span class="s3">):</span>
    <span class="s4"># gh-18279, gh-17572, gh-17771 noted that deprecation warnings</span>
    <span class="s4"># for imports from private modules</span>
    <span class="s4"># were misleading. Check that this is resolved.</span>
    <span class="s1">module </span><span class="s3">= </span><span class="s1">import_module</span><span class="s3">(</span><span class="s1">module_name</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">correct_module </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s1">import_name </span><span class="s3">= </span><span class="s5">f'scipy.</span><span class="s2">{</span><span class="s1">module_name</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;.&quot;</span><span class="s3">)[</span><span class="s6">1</span><span class="s3">]</span><span class="s2">}</span><span class="s5">'</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">import_name </span><span class="s3">= </span><span class="s5">f'scipy.</span><span class="s2">{</span><span class="s1">module_name</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;.&quot;</span><span class="s3">)[</span><span class="s6">1</span><span class="s3">]</span><span class="s2">}</span><span class="s5">.</span><span class="s2">{</span><span class="s1">correct_module</span><span class="s2">}</span><span class="s5">'</span>

    <span class="s1">correct_import </span><span class="s3">= </span><span class="s1">import_module</span><span class="s3">(</span><span class="s1">import_name</span><span class="s3">)</span>

    <span class="s4"># Attributes that were formerly in `module_name` can still be imported from</span>
    <span class="s4"># `module_name`, albeit with a deprecation warning.</span>
    <span class="s2">for </span><span class="s1">attr_name </span><span class="s2">in </span><span class="s1">module</span><span class="s3">.</span><span class="s1">__all__</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">attr_name </span><span class="s3">== </span><span class="s5">&quot;varmats_from_mat&quot;</span><span class="s3">:</span>
            <span class="s4"># defer handling this case, see</span>
            <span class="s4"># https://github.com/scipy/scipy/issues/19223</span>
            <span class="s2">continue</span>
        <span class="s4"># ensure attribute is present where the warning is pointing</span>
        <span class="s2">assert </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">correct_import</span><span class="s3">, </span><span class="s1">attr_name</span><span class="s3">, </span><span class="s2">None</span><span class="s3">) </span><span class="s2">is not None</span>
        <span class="s1">message </span><span class="s3">= </span><span class="s5">f&quot;Please import `</span><span class="s2">{</span><span class="s1">attr_name</span><span class="s2">}</span><span class="s5">` from the `</span><span class="s2">{</span><span class="s1">import_name</span><span class="s2">}</span><span class="s5">`...&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">deprecated_call</span><span class="s3">(</span><span class="s1">match</span><span class="s3">=</span><span class="s1">message</span><span class="s3">):</span>
            <span class="s1">getattr</span><span class="s3">(</span><span class="s1">module</span><span class="s3">, </span><span class="s1">attr_name</span><span class="s3">)</span>

    <span class="s4"># Attributes that were not in `module_name` get an error notifying the user</span>
    <span class="s4"># that the attribute is not in `module_name` and that `module_name` is deprecated.</span>
    <span class="s1">message </span><span class="s3">= </span><span class="s5">f&quot;`</span><span class="s2">{</span><span class="s1">module_name</span><span class="s2">}</span><span class="s5">` is deprecated...&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">AttributeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">message</span><span class="s3">):</span>
        <span class="s1">getattr</span><span class="s3">(</span><span class="s1">module</span><span class="s3">, </span><span class="s5">&quot;ekki&quot;</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_misc_doccer_deprecation</span><span class="s3">():</span>
    <span class="s4"># gh-18279, gh-17572, gh-17771 noted that deprecation warnings</span>
    <span class="s4"># for imports from private modules were misleading.</span>
    <span class="s4"># Check that this is resolved.</span>
    <span class="s4"># `test_private_but_present_deprecation` cannot be used since `correct_import`</span>
    <span class="s4"># is a different subpackage (`_lib` instead of `misc`).</span>
    <span class="s1">module </span><span class="s3">= </span><span class="s1">import_module</span><span class="s3">(</span><span class="s5">'scipy.misc.doccer'</span><span class="s3">)</span>
    <span class="s1">correct_import </span><span class="s3">= </span><span class="s1">import_module</span><span class="s3">(</span><span class="s5">'scipy._lib.doccer'</span><span class="s3">)</span>

    <span class="s4"># Attributes that were formerly in `scipy.misc.doccer` can still be imported from</span>
    <span class="s4"># `scipy.misc.doccer`, albeit with a deprecation warning. The specific message</span>
    <span class="s4"># depends on whether the attribute is in `scipy._lib.doccer` or not.</span>
    <span class="s2">for </span><span class="s1">attr_name </span><span class="s2">in </span><span class="s1">module</span><span class="s3">.</span><span class="s1">__all__</span><span class="s3">:</span>
        <span class="s1">attr </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">correct_import</span><span class="s3">, </span><span class="s1">attr_name</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">attr </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">message </span><span class="s3">= </span><span class="s5">f&quot;`scipy.misc.</span><span class="s2">{</span><span class="s1">attr_name</span><span class="s2">}</span><span class="s5">` is deprecated...&quot;</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">message </span><span class="s3">= </span><span class="s5">f&quot;Please import `</span><span class="s2">{</span><span class="s1">attr_name</span><span class="s2">}</span><span class="s5">` from the `scipy._lib.doccer`...&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">deprecated_call</span><span class="s3">(</span><span class="s1">match</span><span class="s3">=</span><span class="s1">message</span><span class="s3">):</span>
            <span class="s1">getattr</span><span class="s3">(</span><span class="s1">module</span><span class="s3">, </span><span class="s1">attr_name</span><span class="s3">)</span>

    <span class="s4"># Attributes that were not in `scipy.misc.doccer` get an error</span>
    <span class="s4"># notifying the user that the attribute is not in `scipy.misc.doccer` </span>
    <span class="s4"># and that `scipy.misc.doccer` is deprecated.</span>
    <span class="s1">message </span><span class="s3">= </span><span class="s5">&quot;`scipy.misc.doccer` is deprecated...&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">AttributeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">message</span><span class="s3">):</span>
        <span class="s1">getattr</span><span class="s3">(</span><span class="s1">module</span><span class="s3">, </span><span class="s5">&quot;ekki&quot;</span><span class="s3">)</span>
</pre>
</body>
</html>